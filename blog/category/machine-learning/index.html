<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href="https://suneeta-mall.github.io/blog/category/machine-learning/" rel="canonical"><link href=../llm/ rel=prev><link href=../oom/ rel=next><link rel=alternate type=application/rss+xml title="RSS feed" href=../../../feed_rss_created.xml><link rel=alternate type=application/rss+xml title="RSS feed of updated content" href=../../../feed_rss_updated.xml><link rel=icon href=../../../resources/site/favicon.svg><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.18"><title>Machine Learning - Random Musings - Rambling of a curious engineer & data scientist!</title><link rel=stylesheet href=../../../assets/stylesheets/main.66ac8b77.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel="stylesheet" href="../../../assets/external/fonts.googleapis.com/css.49ea35f2.css"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta property=og:type content=website><meta property=og:title content="Machine Learning - Random Musings - Rambling of a curious engineer & data scientist!"><meta property=og:description content=None><meta property=og:image content=https://suneeta-mall.github.io/assets/images/social/blog/category/machine-learning.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta content=https://suneeta-mall.github.io/blog/category/machine-learning/ property=og:url><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="Machine Learning - Random Musings - Rambling of a curious engineer & data scientist!"><meta name=twitter:description content=None><meta name=twitter:image content=https://suneeta-mall.github.io/assets/images/social/blog/category/machine-learning.png></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=deep-purple data-md-color-accent=deep-purple> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#machine-learning class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> <a href=/projects/oreilly_deep_learning_at_scale/ > <strong>🎉 New Book Release!</strong> Check out "Deep Learning at Scale" - An O'Reilly Book </a> </div> <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script> </aside> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href="https://suneeta-mall.github.io/" title="Random Musings - Rambling of a curious engineer &amp; data scientist!" class="md-header__button md-logo" aria-label="Random Musings - Rambling of a curious engineer &amp; data scientist!" data-md-component="logo"> <img src=../../../resources/site/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Random Musings - Rambling of a curious engineer & data scientist! </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Machine Learning </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=deep-purple data-md-color-accent=deep-purple aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=deep-purple data-md-color-accent=deep-purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 9a3 3 0 0 1 3 3 3 3 0 0 1-3 3 3 3 0 0 1-3-3 3 3 0 0 1 3-3m0-4.5c5 0 9.27 3.11 11 7.5-1.73 4.39-6 7.5-11 7.5S2.73 16.39 1 12c1.73-4.39 6-7.5 11-7.5M3.18 12a9.821 9.821 0 0 0 17.64 0 9.821 9.821 0 0 0-17.64 0Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../projects/oreilly_deep_learning_at_scale/ class=md-tabs__link> Projects </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../ class=md-tabs__link> Blog </a> </li> <li class=md-tabs__item> <a href=../../../tags/ class=md-tabs__link> Tags </a> </li> <li class=md-tabs__item> <a href=../../../talks/KGC_NY_2022/ class=md-tabs__link> Talks </a> </li> <li class=md-tabs__item> <a href=../../../poems/singularity/ class=md-tabs__link> Poems </a> </li> <li class=md-tabs__item> <a href=../../../about/ class=md-tabs__link> About Me </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href="https://suneeta-mall.github.io/" title="Random Musings - Rambling of a curious engineer &amp; data scientist!" class="md-nav__button md-logo" aria-label="Random Musings - Rambling of a curious engineer &amp; data scientist!" data-md-component="logo"> <img src=../../../resources/site/logo.svg alt=logo> </a> Random Musings - Rambling of a curious engineer & data scientist! </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Projects </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Projects </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../projects/oreilly_deep_learning_at_scale/ class=md-nav__link> <span class=md-ellipsis> Deep Learning at Scale </span> </a> </li> <li class=md-nav__item> <a href=../../../projects/curious_cassie/ class=md-nav__link> <span class=md-ellipsis> Curious Cassie - The Children's Books </span> </a> </li> <li class=md-nav__item> <a href=../../../projects/feature_analysis/ class=md-nav__link> <span class=md-ellipsis> Label Noise with Clean Lab </span> </a> </li> <li class=md-nav__item> <a href=../../../projects/feature_analysis/ class=md-nav__link> <span class=md-ellipsis> Feature Analysis </span> </a> </li> <li class=md-nav__item> <a href=../../../projects/oreilly-interactive-katacode-series-for-reproducible-ml/ class=md-nav__link> <span class=md-ellipsis> Oreilly Katacode Series </span> </a> </li> <li class=md-nav__item> <a href=../../../projects/reproducible-ml/ class=md-nav__link> <span class=md-ellipsis> Reproducible-ML </span> </a> </li> <li class=md-nav__item> <a href=../../../projects/KCD/ class=md-nav__link> <span class=md-ellipsis> KCD </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <div class="md-nav__link md-nav__container"> <a href=../../ class="md-nav__link "> <span class=md-ellipsis> Blog </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../archive/2025/ class=md-nav__link> <span class=md-ellipsis> 2025 </span> </a> </li> <li class=md-nav__item> <a href=../../archive/2024/ class=md-nav__link> <span class=md-ellipsis> 2024 </span> </a> </li> <li class=md-nav__item> <a href=../../archive/2023/ class=md-nav__link> <span class=md-ellipsis> 2023 </span> </a> </li> <li class=md-nav__item> <a href=../../archive/2022/ class=md-nav__link> <span class=md-ellipsis> 2022 </span> </a> </li> <li class=md-nav__item> <a href=../../archive/2021/ class=md-nav__link> <span class=md-ellipsis> 2021 </span> </a> </li> <li class=md-nav__item> <a href=../../archive/2019/ class=md-nav__link> <span class=md-ellipsis> 2019 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3 checked> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex> <span class=md-ellipsis> Categories </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Categories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ai/ class=md-nav__link> <span class=md-ellipsis> AI </span> </a> </li> <li class=md-nav__item> <a href=../book/ class=md-nav__link> <span class=md-ellipsis> Book </span> </a> </li> <li class=md-nav__item> <a href=../childrens-books/ class=md-nav__link> <span class=md-ellipsis> Children's Books </span> </a> </li> <li class=md-nav__item> <a href=../confident-learning/ class=md-nav__link> <span class=md-ellipsis> Confident-Learning </span> </a> </li> <li class=md-nav__item> <a href=../curious-cassie/ class=md-nav__link> <span class=md-ellipsis> Curious Cassie </span> </a> </li> <li class=md-nav__item> <a href=../data/ class=md-nav__link> <span class=md-ellipsis> Data </span> </a> </li> <li class=md-nav__item> <a href=../data-centric-ai/ class=md-nav__link> <span class=md-ellipsis> Data-Centric-AI </span> </a> </li> <li class=md-nav__item> <a href=../data-science/ class=md-nav__link> <span class=md-ellipsis> Data-science </span> </a> </li> <li class=md-nav__item> <a href=../deep-learning/ class=md-nav__link> <span class=md-ellipsis> Deep Learning </span> </a> </li> <li class=md-nav__item> <a href=../generative-ai/ class=md-nav__link> <span class=md-ellipsis> Generative AI </span> </a> </li> <li class=md-nav__item> <a href=../kubernetes/ class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> <li class=md-nav__item> <a href=../llm/ class=md-nav__link> <span class=md-ellipsis> LLM </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Machine Learning </span> </a> </li> <li class=md-nav__item> <a href=../oom/ class=md-nav__link> <span class=md-ellipsis> OOM </span> </a> </li> <li class=md-nav__item> <a href=../pytorch/ class=md-nav__link> <span class=md-ellipsis> PyTorch </span> </a> </li> <li class=md-nav__item> <a href=../reproducible-ml/ class=md-nav__link> <span class=md-ellipsis> Reproducible-ml </span> </a> </li> <li class=md-nav__item> <a href=../software/ class=md-nav__link> <span class=md-ellipsis> Software </span> </a> </li> <li class=md-nav__item> <a href=../technology/ class=md-nav__link> <span class=md-ellipsis> Technology </span> </a> </li> <li class=md-nav__item> <a href=../umap/ class=md-nav__link> <span class=md-ellipsis> UMAP </span> </a> </li> <li class=md-nav__item> <a href=../t-sne/ class=md-nav__link> <span class=md-ellipsis> t-SNE </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../tags/ class=md-nav__link> <span class=md-ellipsis> Tags </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Talks </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Talks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../talks/KGC_NY_2022/ class=md-nav__link> <span class=md-ellipsis> Knowledge Graph Conference 2022 </span> </a> </li> <li class=md-nav__item> <a href=../../../talks/KubeCon_NA_2021/ class=md-nav__link> <span class=md-ellipsis> KubeCon NA 2021 </span> </a> </li> <li class=md-nav__item> <a href=../../../talks/Kafka_Summit_APAC_2021/ class=md-nav__link> <span class=md-ellipsis> Kafka Summit APAC 2021 </span> </a> </li> <li class=md-nav__item> <a href=../../../talks/AWS_ANZ_Commuity_day_2020/ class=md-nav__link> <span class=md-ellipsis> AWS Community Day 2020 </span> </a> </li> <li class=md-nav__item> <a href=../../../talks/She_Builds_on_AWS_2020/ class=md-nav__link> <span class=md-ellipsis> AWS She Builds on AWS 2020 </span> </a> </li> <li class=md-nav__item> <a href=../../../talks/KubeCon_US_2019/ class=md-nav__link> <span class=md-ellipsis> KubeCon US 2019 </span> </a> </li> <li class=md-nav__item> <a href=../../../talks/KubernetesSydneyForum_AU_2019/ class=md-nav__link> <span class=md-ellipsis> Kubernetes Sydney 2019 </span> </a> </li> <li class=md-nav__item> <a href=../../../talks/YOW_Data_Syd_2019/ class=md-nav__link> <span class=md-ellipsis> YOW Data 2019 </span> </a> </li> <li class=md-nav__item> <a href=../../../talks/KubeCon-Europe-2018/ class=md-nav__link> <span class=md-ellipsis> KubeCon EU 2018 </span> </a> </li> <li class=md-nav__item> <a href=../../../talks/SPIE-2019/ class=md-nav__link> <span class=md-ellipsis> SPIE 2019 </span> </a> </li> <li class=md-nav__item> <a href=../../../talks/SPIE-2018/ class=md-nav__link> <span class=md-ellipsis> SPIE 2018 </span> </a> </li> <li class=md-nav__item> <a href=../../../talks/SPIE-2015/ class=md-nav__link> <span class=md-ellipsis> SPIE 2015 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Poems </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Poems </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../poems/singularity/ class=md-nav__link> <span class=md-ellipsis> Singularity </span> </a> </li> <li class=md-nav__item> <a href=../../../poems/life-of-ai-engineer/ class=md-nav__link> <span class=md-ellipsis> Life of AI Engineers </span> </a> </li> <li class=md-nav__item> <a href=../../../poems/my-little-butterfly/ class=md-nav__link> <span class=md-ellipsis> My little Butterfly </span> </a> </li> <li class=md-nav__item> <a href=../../../poems/breaking-thy-bias/ class=md-nav__link> <span class=md-ellipsis> Breaking Thy Bias </span> </a> </li> <li class=md-nav__item> <a href=../../../poems/daminis/ class=md-nav__link> <span class=md-ellipsis> Daminis </span> </a> </li> <li class=md-nav__item> <a href=../../../poems/one-bright-dawn/ class=md-nav__link> <span class=md-ellipsis> One Bright Dawn </span> </a> </li> <li class=md-nav__item> <a href=../../../poems/aint-no-dr-seuss/ class=md-nav__link> <span class=md-ellipsis> Aint no Dr. Seuss </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../about/ class=md-nav__link> <span class=md-ellipsis> About Me </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <div class=md-content__inner> <header class=md-typeset> <h1 id=machine-learning>Machine Learning<a class=headerlink href=#machine-learning title="Permanent link">#</a></h1> </header> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=/resources/me.png alt="Suneeta Mall"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-05-30 00:00:00">May 30, 2024</time></li> <li class=md-meta__item> in <a href=./ class=md-meta__link>Machine Learning</a>, <a href=../ai/ class=md-meta__link>AI</a>, <a href=../deep-learning/ class=md-meta__link>Deep Learning</a>, <a href=../book/ class=md-meta__link>Book</a></li> <li class=md-meta__item> 1 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=launch-of-deep-learning-at-scale-an-oreilly-book><a href=../../2024/05/30/deep-learning-at-scale/ class=toclink>Launch of Deep Learning at Scale - An O'Reilly Book</a></h2> <p>I am thrilled to announce the release of "Deep Learning at Scale: At the Intersection of Hardware, Software, and Data" - an O'Reilly Book"! I have been working on this project for over 2 years.</p> <blockquote> <p>"Deep Learning at Scale: At the Intersection of Hardware, Software, and Data" (O'Reilly) illustrates complex concepts of full-stack deep learning and reinforces them through hands-on exercises to equip you with tools and techniques to scale your project. Scaling efforts are only beneficial when they are effective and efficient. To that end, this guide explains the intricate concepts and techniques that will help you scale effectively and efficiently.</p> </blockquote> <p><a href="https://oreillymedia.pxf.io/c/5668688/2121843/15173"><img alt="Deep Learning at Scale - An O'reilly Book" src=../../../resources/books/15173-2121843.jpg></a></p> <h3 id=order-your-copy-today><a class=toclink href=../../2024/05/30/deep-learning-at-scale/#order-your-copy-today><strong>Order your copy today</strong></a></h3> <p>To order your copy, use the following links based on your preferred format:</p> <div class="admonition note kindle"> <p class=admonition-title>Note</p> </div> <p><a href="https://www.amazon.com/dp/B0D7F9KZWC"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M180.41 203.01c-.72 22.65 10.6 32.68 10.88 39.05a8.164 8.164 0 0 1-4.1 6.27l-12.8 8.96a10.66 10.66 0 0 1-5.63 1.92c-.43-.02-8.19 1.83-20.48-25.61a78.608 78.608 0 0 1-62.61 29.45c-16.28.89-60.4-9.24-58.13-56.21-1.59-38.28 34.06-62.06 70.93-60.05 7.1.02 21.6.37 46.99 6.27v-15.62c2.69-26.46-14.7-46.99-44.81-43.91-2.4.01-19.4-.5-45.84 10.11-7.36 3.38-8.3 2.82-10.75 2.82-7.41 0-4.36-21.48-2.94-24.2 5.21-6.4 35.86-18.35 65.94-18.18a76.857 76.857 0 0 1 55.69 17.28 70.285 70.285 0 0 1 17.67 52.36l-.01 69.29zM93.99 235.4c32.43-.47 46.16-19.97 49.29-30.47 2.46-10.05 2.05-16.41 2.05-27.4-9.67-2.32-23.59-4.85-39.56-4.87-15.15-1.14-42.82 5.63-41.74 32.26-1.24 16.79 11.12 31.4 29.96 30.48zm170.92 23.05c-7.86.72-11.52-4.86-12.68-10.37l-49.8-164.65c-.97-2.78-1.61-5.65-1.92-8.58a4.61 4.61 0 0 1 3.86-5.25c.24-.04-2.13 0 22.25 0 8.78-.88 11.64 6.03 12.55 10.37l35.72 140.83 33.16-140.83c.53-3.22 2.94-11.07 12.8-10.24h17.16c2.17-.18 11.11-.5 12.68 10.37l33.42 142.63L420.98 80.1c.48-2.18 2.72-11.37 12.68-10.37h19.72c.85-.13 6.15-.81 5.25 8.58-.43 1.85 3.41-10.66-52.75 169.9-1.15 5.51-4.82 11.09-12.68 10.37h-18.69c-10.94 1.15-12.51-9.66-12.68-10.75L328.67 110.7l-32.78 136.99c-.16 1.09-1.73 11.9-12.68 10.75h-18.3zm273.48 5.63c-5.88.01-33.92-.3-57.36-12.29a12.802 12.802 0 0 1-7.81-11.91v-10.75c0-8.45 6.2-6.9 8.83-5.89 10.04 4.06 16.48 7.14 28.81 9.6 36.65 7.53 52.77-2.3 56.72-4.48 13.15-7.81 14.19-25.68 5.25-34.95-10.48-8.79-15.48-9.12-53.13-21-4.64-1.29-43.7-13.61-43.79-52.36-.61-28.24 25.05-56.18 69.52-55.95 12.67-.01 46.43 4.13 55.57 15.62 1.35 2.09 2.02 4.55 1.92 7.04v10.11c0 4.44-1.62 6.66-4.87 6.66-7.71-.86-21.39-11.17-49.16-10.75-6.89-.36-39.89.91-38.41 24.97-.43 18.96 26.61 26.07 29.7 26.89 36.46 10.97 48.65 12.79 63.12 29.58 17.14 22.25 7.9 48.3 4.35 55.44-19.08 37.49-68.42 34.44-69.26 34.42zm40.2 104.86c-70.03 51.72-171.69 79.25-258.49 79.25A469.127 469.127 0 0 1 2.83 327.46c-6.53-5.89-.77-13.96 7.17-9.47a637.37 637.37 0 0 0 316.88 84.12 630.22 630.22 0 0 0 241.59-49.55c11.78-5 21.77 7.8 10.12 16.38zm29.19-33.29c-8.96-11.52-59.28-5.38-81.81-2.69-6.79.77-7.94-5.12-1.79-9.47 40.07-28.17 105.88-20.1 113.44-10.63 7.55 9.47-2.05 75.41-39.56 106.91-5.76 4.87-11.27 2.3-8.71-4.1 8.44-21.25 27.39-68.49 18.43-80.02z"/></svg></span> - Amazon</a> | <a href="https://www.amazon.com.au/dp/B0D7F9KZWC"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M180.41 203.01c-.72 22.65 10.6 32.68 10.88 39.05a8.164 8.164 0 0 1-4.1 6.27l-12.8 8.96a10.66 10.66 0 0 1-5.63 1.92c-.43-.02-8.19 1.83-20.48-25.61a78.608 78.608 0 0 1-62.61 29.45c-16.28.89-60.4-9.24-58.13-56.21-1.59-38.28 34.06-62.06 70.93-60.05 7.1.02 21.6.37 46.99 6.27v-15.62c2.69-26.46-14.7-46.99-44.81-43.91-2.4.01-19.4-.5-45.84 10.11-7.36 3.38-8.3 2.82-10.75 2.82-7.41 0-4.36-21.48-2.94-24.2 5.21-6.4 35.86-18.35 65.94-18.18a76.857 76.857 0 0 1 55.69 17.28 70.285 70.285 0 0 1 17.67 52.36l-.01 69.29zM93.99 235.4c32.43-.47 46.16-19.97 49.29-30.47 2.46-10.05 2.05-16.41 2.05-27.4-9.67-2.32-23.59-4.85-39.56-4.87-15.15-1.14-42.82 5.63-41.74 32.26-1.24 16.79 11.12 31.4 29.96 30.48zm170.92 23.05c-7.86.72-11.52-4.86-12.68-10.37l-49.8-164.65c-.97-2.78-1.61-5.65-1.92-8.58a4.61 4.61 0 0 1 3.86-5.25c.24-.04-2.13 0 22.25 0 8.78-.88 11.64 6.03 12.55 10.37l35.72 140.83 33.16-140.83c.53-3.22 2.94-11.07 12.8-10.24h17.16c2.17-.18 11.11-.5 12.68 10.37l33.42 142.63L420.98 80.1c.48-2.18 2.72-11.37 12.68-10.37h19.72c.85-.13 6.15-.81 5.25 8.58-.43 1.85 3.41-10.66-52.75 169.9-1.15 5.51-4.82 11.09-12.68 10.37h-18.69c-10.94 1.15-12.51-9.66-12.68-10.75L328.67 110.7l-32.78 136.99c-.16 1.09-1.73 11.9-12.68 10.75h-18.3zm273.48 5.63c-5.88.01-33.92-.3-57.36-12.29a12.802 12.802 0 0 1-7.81-11.91v-10.75c0-8.45 6.2-6.9 8.83-5.89 10.04 4.06 16.48 7.14 28.81 9.6 36.65 7.53 52.77-2.3 56.72-4.48 13.15-7.81 14.19-25.68 5.25-34.95-10.48-8.79-15.48-9.12-53.13-21-4.64-1.29-43.7-13.61-43.79-52.36-.61-28.24 25.05-56.18 69.52-55.95 12.67-.01 46.43 4.13 55.57 15.62 1.35 2.09 2.02 4.55 1.92 7.04v10.11c0 4.44-1.62 6.66-4.87 6.66-7.71-.86-21.39-11.17-49.16-10.75-6.89-.36-39.89.91-38.41 24.97-.43 18.96 26.61 26.07 29.7 26.89 36.46 10.97 48.65 12.79 63.12 29.58 17.14 22.25 7.9 48.3 4.35 55.44-19.08 37.49-68.42 34.44-69.26 34.42zm40.2 104.86c-70.03 51.72-171.69 79.25-258.49 79.25A469.127 469.127 0 0 1 2.83 327.46c-6.53-5.89-.77-13.96 7.17-9.47a637.37 637.37 0 0 0 316.88 84.12 630.22 630.22 0 0 0 241.59-49.55c11.78-5 21.77 7.8 10.12 16.38zm29.19-33.29c-8.96-11.52-59.28-5.38-81.81-2.69-6.79.77-7.94-5.12-1.79-9.47 40.07-28.17 105.88-20.1 113.44-10.63 7.55 9.47-2.05 75.41-39.56 106.91-5.76 4.87-11.27 2.3-8.71-4.1 8.44-21.25 27.39-68.49 18.43-80.02z"/></svg></span> - Amazon AU</a></p> <div class="admonition note paperback"> <p class=admonition-title>Note</p> </div> <p><a href="https://www.amazon.com/dp/1098145283"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M180.41 203.01c-.72 22.65 10.6 32.68 10.88 39.05a8.164 8.164 0 0 1-4.1 6.27l-12.8 8.96a10.66 10.66 0 0 1-5.63 1.92c-.43-.02-8.19 1.83-20.48-25.61a78.608 78.608 0 0 1-62.61 29.45c-16.28.89-60.4-9.24-58.13-56.21-1.59-38.28 34.06-62.06 70.93-60.05 7.1.02 21.6.37 46.99 6.27v-15.62c2.69-26.46-14.7-46.99-44.81-43.91-2.4.01-19.4-.5-45.84 10.11-7.36 3.38-8.3 2.82-10.75 2.82-7.41 0-4.36-21.48-2.94-24.2 5.21-6.4 35.86-18.35 65.94-18.18a76.857 76.857 0 0 1 55.69 17.28 70.285 70.285 0 0 1 17.67 52.36l-.01 69.29zM93.99 235.4c32.43-.47 46.16-19.97 49.29-30.47 2.46-10.05 2.05-16.41 2.05-27.4-9.67-2.32-23.59-4.85-39.56-4.87-15.15-1.14-42.82 5.63-41.74 32.26-1.24 16.79 11.12 31.4 29.96 30.48zm170.92 23.05c-7.86.72-11.52-4.86-12.68-10.37l-49.8-164.65c-.97-2.78-1.61-5.65-1.92-8.58a4.61 4.61 0 0 1 3.86-5.25c.24-.04-2.13 0 22.25 0 8.78-.88 11.64 6.03 12.55 10.37l35.72 140.83 33.16-140.83c.53-3.22 2.94-11.07 12.8-10.24h17.16c2.17-.18 11.11-.5 12.68 10.37l33.42 142.63L420.98 80.1c.48-2.18 2.72-11.37 12.68-10.37h19.72c.85-.13 6.15-.81 5.25 8.58-.43 1.85 3.41-10.66-52.75 169.9-1.15 5.51-4.82 11.09-12.68 10.37h-18.69c-10.94 1.15-12.51-9.66-12.68-10.75L328.67 110.7l-32.78 136.99c-.16 1.09-1.73 11.9-12.68 10.75h-18.3zm273.48 5.63c-5.88.01-33.92-.3-57.36-12.29a12.802 12.802 0 0 1-7.81-11.91v-10.75c0-8.45 6.2-6.9 8.83-5.89 10.04 4.06 16.48 7.14 28.81 9.6 36.65 7.53 52.77-2.3 56.72-4.48 13.15-7.81 14.19-25.68 5.25-34.95-10.48-8.79-15.48-9.12-53.13-21-4.64-1.29-43.7-13.61-43.79-52.36-.61-28.24 25.05-56.18 69.52-55.95 12.67-.01 46.43 4.13 55.57 15.62 1.35 2.09 2.02 4.55 1.92 7.04v10.11c0 4.44-1.62 6.66-4.87 6.66-7.71-.86-21.39-11.17-49.16-10.75-6.89-.36-39.89.91-38.41 24.97-.43 18.96 26.61 26.07 29.7 26.89 36.46 10.97 48.65 12.79 63.12 29.58 17.14 22.25 7.9 48.3 4.35 55.44-19.08 37.49-68.42 34.44-69.26 34.42zm40.2 104.86c-70.03 51.72-171.69 79.25-258.49 79.25A469.127 469.127 0 0 1 2.83 327.46c-6.53-5.89-.77-13.96 7.17-9.47a637.37 637.37 0 0 0 316.88 84.12 630.22 630.22 0 0 0 241.59-49.55c11.78-5 21.77 7.8 10.12 16.38zm29.19-33.29c-8.96-11.52-59.28-5.38-81.81-2.69-6.79.77-7.94-5.12-1.79-9.47 40.07-28.17 105.88-20.1 113.44-10.63 7.55 9.47-2.05 75.41-39.56 106.91-5.76 4.87-11.27 2.3-8.71-4.1 8.44-21.25 27.39-68.49 18.43-80.02z"/></svg></span> - Amazon</a> | <a href="https://www.amazon.com.au/dp/1098145283"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M180.41 203.01c-.72 22.65 10.6 32.68 10.88 39.05a8.164 8.164 0 0 1-4.1 6.27l-12.8 8.96a10.66 10.66 0 0 1-5.63 1.92c-.43-.02-8.19 1.83-20.48-25.61a78.608 78.608 0 0 1-62.61 29.45c-16.28.89-60.4-9.24-58.13-56.21-1.59-38.28 34.06-62.06 70.93-60.05 7.1.02 21.6.37 46.99 6.27v-15.62c2.69-26.46-14.7-46.99-44.81-43.91-2.4.01-19.4-.5-45.84 10.11-7.36 3.38-8.3 2.82-10.75 2.82-7.41 0-4.36-21.48-2.94-24.2 5.21-6.4 35.86-18.35 65.94-18.18a76.857 76.857 0 0 1 55.69 17.28 70.285 70.285 0 0 1 17.67 52.36l-.01 69.29zM93.99 235.4c32.43-.47 46.16-19.97 49.29-30.47 2.46-10.05 2.05-16.41 2.05-27.4-9.67-2.32-23.59-4.85-39.56-4.87-15.15-1.14-42.82 5.63-41.74 32.26-1.24 16.79 11.12 31.4 29.96 30.48zm170.92 23.05c-7.86.72-11.52-4.86-12.68-10.37l-49.8-164.65c-.97-2.78-1.61-5.65-1.92-8.58a4.61 4.61 0 0 1 3.86-5.25c.24-.04-2.13 0 22.25 0 8.78-.88 11.64 6.03 12.55 10.37l35.72 140.83 33.16-140.83c.53-3.22 2.94-11.07 12.8-10.24h17.16c2.17-.18 11.11-.5 12.68 10.37l33.42 142.63L420.98 80.1c.48-2.18 2.72-11.37 12.68-10.37h19.72c.85-.13 6.15-.81 5.25 8.58-.43 1.85 3.41-10.66-52.75 169.9-1.15 5.51-4.82 11.09-12.68 10.37h-18.69c-10.94 1.15-12.51-9.66-12.68-10.75L328.67 110.7l-32.78 136.99c-.16 1.09-1.73 11.9-12.68 10.75h-18.3zm273.48 5.63c-5.88.01-33.92-.3-57.36-12.29a12.802 12.802 0 0 1-7.81-11.91v-10.75c0-8.45 6.2-6.9 8.83-5.89 10.04 4.06 16.48 7.14 28.81 9.6 36.65 7.53 52.77-2.3 56.72-4.48 13.15-7.81 14.19-25.68 5.25-34.95-10.48-8.79-15.48-9.12-53.13-21-4.64-1.29-43.7-13.61-43.79-52.36-.61-28.24 25.05-56.18 69.52-55.95 12.67-.01 46.43 4.13 55.57 15.62 1.35 2.09 2.02 4.55 1.92 7.04v10.11c0 4.44-1.62 6.66-4.87 6.66-7.71-.86-21.39-11.17-49.16-10.75-6.89-.36-39.89.91-38.41 24.97-.43 18.96 26.61 26.07 29.7 26.89 36.46 10.97 48.65 12.79 63.12 29.58 17.14 22.25 7.9 48.3 4.35 55.44-19.08 37.49-68.42 34.44-69.26 34.42zm40.2 104.86c-70.03 51.72-171.69 79.25-258.49 79.25A469.127 469.127 0 0 1 2.83 327.46c-6.53-5.89-.77-13.96 7.17-9.47a637.37 637.37 0 0 0 316.88 84.12 630.22 630.22 0 0 0 241.59-49.55c11.78-5 21.77 7.8 10.12 16.38zm29.19-33.29c-8.96-11.52-59.28-5.38-81.81-2.69-6.79.77-7.94-5.12-1.79-9.47 40.07-28.17 105.88-20.1 113.44-10.63 7.55 9.47-2.05 75.41-39.56 106.91-5.76 4.87-11.27 2.3-8.71-4.1 8.44-21.25 27.39-68.49 18.43-80.02z"/></svg></span> - Amazon AU</a></p> <p>Alternatively, you can access the book using the 30-day trial link:</p> <div class="admonition note"> <p class=admonition-title>30 Days trial access by O'Reilly Media</p> </div> <p><a href="https://oreillymedia.pxf.io/c/5668688/2121843/15173">30 days trial - <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M184 48h144c4.4 0 8 3.6 8 8v40H176V56c0-4.4 3.6-8 8-8zm-56 8v40H64c-35.3 0-64 28.7-64 64v96h512v-96c0-35.3-28.7-64-64-64h-64V56c0-30.9-25.1-56-56-56H184c-30.9 0-56 25.1-56 56zm384 232H320v32c0 17.7-14.3 32-32 32h-64c-17.7 0-32-14.3-32-32v-32H0v128c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V288z"/></svg></span></a></p> <h3 id=more-info><a class=toclink href=../../2024/05/30/deep-learning-at-scale/#more-info>More info</a></h3> <p>For more information, see details in the <a href=/projects/oreilly_deep_learning_at_scale/ >project</a></p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=/resources/me.png alt="Suneeta Mall"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-01-07 00:00:00">January 7, 2024</time></li> <li class=md-meta__item> in <a href=./ class=md-meta__link>Machine Learning</a>, <a href=../ai/ class=md-meta__link>AI</a>, <a href=../data-science/ class=md-meta__link>Data-science</a>, <a href=../book/ class=md-meta__link>Book</a>, <a href=../llm/ class=md-meta__link>LLM</a></li> <li class=md-meta__item> 12 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=chatgpt-vs-me-as-a-childrens-authors><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/ class=toclink>ChatGPT vs Me: As a Children's Authors</a></h2> <p>For all the right reasons, large language models have taken the world by storm! It’s pretty impressive what <a href="https://openai.com/blog/chatgpt/">ChatGPT</a> can do - unprecedented coherence, relevance and tone of delivery for a synthetic text generation. Well done OpenAI! </p> <p>I have to admit I have strongly resisted the urge to use it for purposes beyond joy, and exploration. It's been very hard to abstain, especially because I am extremely passionate about AI and also I work in AI. I truly, madly, deeply, utterly fear that we, as a community of carers of young people, are simply NOT ready for it! It’s the infancy state of due diligence to understand the societal implications and governance around it that scares me the most. I fear that while we, the grown-ups, are probably ready and raring to go at it, it’s our younger generations who are not at all ready for it. Once this genie is out of the bottle, out is just the way! And it’s the repeat of our social media fiasco all over again. Perhaps I am coming from a dark place of seeing how exponentially easily our kids are getting social media bullied and exploited with authorities still scrambling even after the fact on how to contain it! </p> <p>On a lighter note, selfishly speaking, I also fear depleting my creative and critical thinking abilities in favour of convenience and productivity. If Darwin’s theory is anything to go by, that’s one human talent we should preserve and reinforce, I think. Did I hear you say “But you can still be critical of the presented text?”? Sure, but we are also a Large Language Model in many ways :) - we get biased and we are lazy. Is not laziness the inspiration for many useful inventions of our times?</p> <p>As a mother of young kids and as someone who believes in lifelong learning, I made a <a href="https://curiouscassie.github.io">tiny effort</a> last year to write chapter books for early readers covering the discoveries of the great scientists of our past and present. In my debut release, I featured Sir Isaac Newton’s discoveries in a book titled “Curious Cassie's beach ride quest: A Celebration of Isaac Newton's Discoveries”. I tested the book on a sample of 5 kids all ranging from 6-7 years and observed extreme enthusiasm and an increased number of questions thereafter. Mission accomplished, eh? </p> <p>I failed this morning! I failed to resist the chatGPT urge to see what it would write instead. So here’s Me vs chatGPT, a debut author vs a stochastic parrot:</p> <ul> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#chatgpt-vs-me-as-a-childrens-authors>ChatGPT vs Me: As a Children's Authors</a></li> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#chatgpt-vs-me-show-me-the-script>ChatGPT vs Me: Show me the script</a><ul> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#chatgpt>ChatGPT</a></li> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#prompt>Prompt</a><ul> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#chatgpts-response>ChatGPT's Response</a></li> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#verdict>Verdict</a></li> </ul> </li> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#prompt-1>Prompt</a><ul> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#chatgpts-response-1>ChatGPT's Response</a></li> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#verdict-1>Verdict</a></li> </ul> </li> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#prompt-2>Prompt</a><ul> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#chatgpts-response-2>ChatGPT's Response</a></li> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#verdict-2>Verdict</a></li> </ul> </li> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#prompt-3>Prompt</a><ul> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#chatgpts-response-3>ChatGPT's Response</a></li> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#verdict-3>Verdict</a></li> </ul> </li> <li><a href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#me-me>Me! Me!</a></li> </ul> </li> </ul> <h3 id=chatgpt-vs-me-show-me-the-script><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#chatgpt-vs-me-show-me-the-script>ChatGPT vs Me: Show me the script</a></h3> <h4 id=chatgpt><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#chatgpt>ChatGPT</a></h4> <h5 id=prompt><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#prompt>Prompt</a></h5> <p><em>Write a chapter book for 6 year old kids</em></p> <h6 id=chatgpts-response><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#chatgpts-response>ChatGPT's Response</a></h6> <div class=highlight><pre><span></span><code>Chapter 1: The Magical Forest

It was a beautiful day in the magical forest. The sun was shining and the birds were singing. The trees were tall and green, and the flowers were blooming.

In the center of the forest was a small cottage, where a young girl named Lily lived with her parents. Lily was six years old, and she loved to explore the forest.

One day, while out on a walk, Lily stumbled upon a strange and magical place. It was a clearing filled with glittering diamonds and sparkling jewels.

&quot;Wow!&quot; exclaimed Lily. &quot;I&#39;ve never seen anything like this before!&quot;
As she reached out to touch one of the diamonds, a bright light shone and a magical fairy appeared before her.

&quot;Hello, Lily,&quot; said the fairy. &quot;I am the guardian of the forest, and I have been waiting for you. You have a very special task to complete.&quot;

&quot;Me?&quot; asked Lily. &quot;What can I do?&quot;

&quot;There is a wicked witch who has been causing trouble in the forest,&quot; explained the fairy. &quot;She has been turning all of the animals into stone, and we need your help to stop her.&quot;

&quot;I&#39;ll do it!&quot; said Lily, determined to help the animals.

Chapter 2: The Wicked Witch

Lily set out on her journey to find the wicked witch. She followed the fairy&#39;s instructions and travelled deep into the forest.
As she walked, she saw that the trees were no longer green and the flowers had withered away. It was clear that the witch had been causing destruction wherever she went.

Finally, Lily came to a dark and gloomy castle. She knew this was where the witch lived.

She tiptoed through the castle, trying not to make a sound. She could hear the witch cackling in the next room.

Lily peeked through the door and saw the witch stirring a bubbling pot. She had a long, crooked nose and sharp, pointed teeth.

&quot;Ah-ha!&quot; shouted the witch, turning to face Lily. &quot;I&#39;ve been expecting you, little girl. You won&#39;t be able to stop me from turning all of the animals into stone!&quot;

But Lily was not afraid. She remembered the fairy&#39;s words and knew she had to be brave.

&quot;I won&#39;t let you harm any more animals!&quot; said Lily, standing up to the witch.

The witch cackled and raised her wand, but Lily was quick. She grabbed a nearby broom and swung it at the witch, knocking the witches wand out of her hand.

The witch let out a cry of rage and fled the castle, leaving Lily to save the animals.

Chapter 3: The Great Celebration

With the witch gone, Lily was able to use her magic to turn the animals back to normal. The forest was filled with joy and celebration.

The fairy thanked Lily for her bravery and offered to grant her one wish.

&quot;I wish for the forest to always be a happy and safe place,&quot; said Lily.

The fairy nodded and waved her wand, granting Lily&#39;s wish. From then on, the magical forest was filled with happiness and peace.
Lily returned home to her parents, who were overjoyed to see her safe and sound. They threw a great celebration in her honour, and the whole forest came to join in the fun.

Lily knew that she would always treasure her adventure in the magical forest, and she hoped to have many more adventures in the future.
</code></pre></div> <h6 id=verdict><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#verdict>Verdict</a></h6> <p>Very impressive choice of theme, tone and word selection. It did not give me a title, so I asked to name the title and it responded with "The Brave Explorer: A Magical Adventure in the Forest." Very cool! </p> <h5 id=prompt_1><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#prompt_1>Prompt</a></h5> <p><em>Write a chapter book for 6 year old kids on STEM</em></p> <h6 id=chatgpts-response_1><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#chatgpts-response_1>ChatGPT's Response</a></h6> <div class=highlight><pre><span></span><code>Chapter 1: The Science Fair

It was a beautiful day in the town of Maplewood, and Lily was excited for the annual science fair at her school. She had been working on her project for weeks, and she couldn&#39;t wait to show it off.

Lily&#39;s project was a model of the solar system, complete with miniature planets made out of clay and a sun made out of papier-mâché. She had worked hard to make sure everything was accurate and to explain the orbits of the planets in a way that other kids could understand.

As the science fair began, Lily set up her project at her table and waited for the judges to come by. She was a little nervous, but she knew she had done her best.

The judges were impressed by Lily&#39;s project and asked her lots of questions about the solar system. Lily was happy to answer and explain what she had learned.

In the end, Lily&#39;s project won first place in the science fair! She was so proud of herself and couldn&#39;t wait to show her parents.

Chapter 2: The Technology Club

After the science fair, Lily&#39;s teacher, Mrs. Kim, asked her if she would like to join the Technology Club at school. Lily was excited at the chance to learn more about science and technology, and she eagerly accepted.

In the Technology Club, Lily and her friends learned about all sorts of different topics, from coding and robotics to engineering and renewable energy. They built and programmed robots, designed and tested bridges, and learned about how solar panels work.

Lily loved the Technology Club and couldn&#39;t wait to go each week. She learned so much and had a lot of fun doing it.

Chapter 3: The Engineering Competition

One day, Mrs. Kim announced that the Technology Club was going to participate in an engineering competition. The students would have to design and build a Rube Goldberg machine, a complicated contraption that could perform a simple task in a creative and convoluted way.

Lily and her friends were up for the challenge and set to work planning and building their machine. They worked together as a team, using their knowledge of physics, engineering, and problem-solving to make their machine work.

Finally, the day of the competition arrived. Lily and her friends were nervous but excited to see how their machine would perform.

As they presented their machine to the judges, it worked perfectly, performing the simple task with a series of intricate steps. Lily and her friends were thrilled when they were announced as the winners of the competition!

Chapter 4: The Future Scientists

After the engineering competition, Lily and her friends in the Technology Club knew that they wanted to continue exploring science and technology in the future. They were already thinking about new projects and competitions they could participate in.

Lily knew that she wanted to be a scientist when she grew up, and she was grateful for all of the opportunities she had had to learn and explore in the Technology Club.

She knew that no matter what she did in the future, she would always have a passion for science and technology and the desire to learn more.
</code></pre></div> <h6 id=verdict_1><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#verdict_1>Verdict</a></h6> <p>Nice plot setting, nice choice of theme, and context. Nice job. I find it's very peripheral, explaining a lot about the setting but nothing about science. Maybe it’s my prompt. Let's give it another go.</p> <h5 id=prompt_2><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#prompt_2>Prompt</a></h5> <p><em>Write a 6-7 year old kids’ book on Sir Isaac Newton's discoveries with Cassie as a protagonist</em></p> <h6 id=chatgpts-response_2><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#chatgpts-response_2>ChatGPT's Response</a></h6> <div class=highlight><pre><span></span><code>Cassie and the Apple Tree

Cassie was a curious little girl who loved to learn about the world around her. One day, she was walking through her backyard when she saw an apple fall from a tree.

&quot;Hmm, I wonder why that happened?&quot; Cassie thought to herself. She climbed up the tree to see if she could find out more.

As she reached the top, she saw a man standing under the tree. It was Sir Isaac Newton! Cassie had heard of him before. He was a very smart man who had made many important discoveries.
&quot;Hello, Cassie,&quot; Sir Isaac said. &quot;I see you&#39;re curious about the apple.&quot;

&quot;Yes, I am,&quot; Cassie replied. &quot;Why did it fall to the ground?&quot;
&quot;Ah, that&#39;s a good question,&quot; Sir Isaac said. &quot;I figured out that there is a force called gravity that pulls objects towards the ground. That&#39;s why the apple fell.&quot;

Cassie was amazed. &quot;Wow, that&#39;s so cool!&quot; she exclaimed.
Sir Isaac smiled. &quot;I also made many other discoveries,&quot; he told Cassie. &quot;Like the laws of motion, which explain how objects move and change speed. And I invented calculus, which helps us understand how things change over time.&quot;

Cassie&#39;s head was spinning with all this new information. She couldn&#39;t wait to learn more about Sir Isaac&#39;s discoveries.

&quot;Thank you for telling me all about this, Sir Isaac,&quot; Cassie said. &quot;I can&#39;t wait to learn more!&quot;

&quot;You&#39;re welcome, Cassie,&quot; Sir Isaac replied. &quot;I&#39;m glad you&#39;re interested in learning. Remember, the more you learn, the more you&#39;ll discover about the world around you.&quot;

Cassie smiled and climbed back down the tree, excited to keep learning and discovering new things.
</code></pre></div> <h6 id=verdict_2><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#verdict_2>Verdict</a></h6> <p>Nice choice of words, context is spot on, and tone of delivery is nice too. Some of the phrases are spot on. "Wow, that's so cool!" she exclaimed.” is something I have used too. </p> <p>Apple and Newton are joined together forever. Cliché, my dear parrot! Cliché! Well done still. Maybe I like more challenges given to the kids, but I still feel it’s too shallow and lacks details. Let’s give it more work and see what ChatGPT does. </p> <h5 id=prompt_3><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#prompt_3>Prompt</a></h5> <p><em>Write a 6-7 year old kids chapter book on Sir Isaac Newton's discoveries with Cassie as the protagonist with illustrations</em></p> <h6 id=chatgpts-response_3><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#chatgpts-response_3>ChatGPT's Response</a></h6> <div class=highlight><pre><span></span><code>Chapter 1: Cassie and the Apple Tree

[Illustration: Cassie is standing in her backyard, looking up at an apple falling from a tree.]

Cassie was a curious little girl who loved to learn about the world around her. One day, she was walking through her backyard when she saw an apple fall from a tree.

&quot;Hmm, I wonder why that happened?&quot; Cassie thought to herself. She climbed up the tree to see if she could find out more.

[Illustration: Cassie is climbing up the tree, with a determined look on her face.]

As she reached the top, she saw a man standing under the tree. It was Sir Isaac Newton! Cassie had heard of him before. He was a very smart man who had made many important discoveries.

&quot;Hello, Cassie,&quot; Sir Isaac said. &quot;I see you&#39;re curious about the apple.&quot;

&quot;Yes, I am,&quot; Cassie replied. &quot;Why did it fall to the ground?&quot;

&quot;Ah, that&#39;s a good question,&quot; Sir Isaac said. &quot;I figured out that there is a force called gravity that pulls objects towards the ground. That&#39;s why the apple fell.&quot;

[Illustration: Sir Isaac is pointing to a diagram of the earth and the apple, with an arrow labeled &quot;gravity&quot; pointing from the earth to the apple.]

Cassie was amazed. &quot;Wow, that&#39;s so cool!&quot; she exclaimed.

Chapter 2: The Laws of Motion

After learning about gravity, Cassie couldn&#39;t wait to find out more about Sir Isaac&#39;s discoveries. She asked him to tell her more.

&quot;I also made many other discoveries,&quot; Sir Isaac said. &quot;Like the laws of motion, which explain how objects move and change speed.&quot;

[Illustration: Sir Isaac is holding a book labeled &quot;Laws of Motion,&quot; with diagrams of moving objects in the background.]

Cassie was fascinated. Sir Isaac explained that there are three laws of motion:

    Objects at rest stay at rest, and objects in motion stay in motion with the same speed and direction, unless acted upon by a force.
    The force needed to change the motion of an object is equal to the mass of the object times its acceleration.
    For every action, there is an equal and opposite reaction.

[Illustration: Sir Isaac is pointing to a chalkboard with the three laws of motion written on it, with illustrations of objects in motion on either side.]

&quot;These laws help us understand how objects move and behave in the world around us,&quot; Sir Isaac said.

Chapter 3: Calculus

Cassie couldn&#39;t believe how much she was learning from Sir Isaac. She asked him if there was anything else he had discovered.

&quot;Yes, I also invented calculus,&quot; Sir Isaac said. &quot;It helps us understand how things change over time.&quot;

[Illustration: Sir Isaac is holding a book labeled &quot;Calculus,&quot; with a diagram of a curve on the cover.]

Cassie was a little confused. &quot;What do you mean?&quot; she asked.

Sir Isaac explained that calculus is a way of studying how things change. &quot;For example, we can use calculus to understand how fast a ball is rolling down a hill, or how fast a plant is growing,&quot; he said.
[Illustration: Sir Isaac is pointing to a graph with a curve on it, with a ball rolling down a hill in the background.]
Cassie was amazed. &quot;That&#39;s so cool!&quot; she exclaimed.
Chapter 4: The End
After learning all about Sir Isaac&#39;s discoveries, Cassie was even more excited to keep learning and discovering new things. She thanked Sir Isaac for all of his help and said goodbye.
&quot;Remember, Cassie,&quot; Sir Isaac said as she walked away. &quot;The more you learn, the more you&#39;ll discover about the world around you.&quot;
[Illustration: Cassie is waving goodbye to Sir Isaac, with a big smile on her face.]
Cassie smiled and waved, excited to keep exploring and learning. She knew that there were so many more mysteries to solve and discoveries to be made.
</code></pre></div> <h6 id=verdict_3><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#verdict_3>Verdict</a></h6> <p>I love this line "The more you learn, the more you'll discover about the world around you." ChatGPT, You can be nice if not exploited! I liked the mention of calculus. It’s a brilliant thought but I stopped at algebra in my book! </p> <p>However, I remain unsatisfied given the lack of detail and meat around the topic. I feel, for now, human writing is more creative, rich and informative! I am glad that’s the way it is! </p> <h4 id=me-me><a class=toclink href=../../2024/01/07/chatgpt-vs-me-as-a-childrens-authors/#me-me>Me! Me!</a></h4> <p><em>Title</em>: Curious Cassie's beach ride quest: A Celebration of Isaac Newton's Discoveries</p> <p>[Illustration: Cassie is riding in a car with her family! She is buzzing with interesting curious keywords like Wow, What, How, When, Where! Sir Isaac is featured in the book.]</p> <p>Here's a sample of <a href=../../../resources/curious_cassie/Curious%20Cassie%27s%20beach%20ride%20quest-%20A%20Celebration%20of%20Isaac%20Newton%27s%20Discoveries.pdf>my book</a>. It shows 1<sup>st</sup> chapter of the 3-chapter book. </p> <blockquote> <p><img alt src=../../../resources/curious_cassie/cover.jpg></p> </blockquote> <p>I am just a debut author, writing out of hobby. I am profoundly impressed by authors who have written brilliant books to teach, guide and shape our children. I hope we will continue to create far-enriched content to shape ourselves and our future with or without AI - just as long as we are in control. </p> <p>Thanks a lot for reading! If you ever see any value in spreading the word about my book or procuring it for your loved ones then please do so, I would be thrilled! </p> <p><em>Disclaimer</em>: This is a personal post. Views shared are my own and do not represent my employers.</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=/resources/me.png alt="Suneeta Mall"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2023-11-12 00:00:00">November 12, 2023</time></li> <li class=md-meta__item> in <a href=./ class=md-meta__link>Machine Learning</a>, <a href=../ai/ class=md-meta__link>AI</a>, <a href=../software/ class=md-meta__link>Software</a></li> <li class=md-meta__item> 17 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=pydra-pydantic-and-hydra-for-configuration-management-of-model-training-experiments><a href=../../2023/11/12/hydra-pydantic-config-management/ class=toclink>Pydra - Pydantic and Hydra for configuration management of model training experiments</a></h2> <p>How do you manage the configurations of your model training experiments? Having good configuration management in place improves the user experience and simplifies experiment management. Some of the indirect advantages of having a good config solution are clean, reliable, and simple application code. This is true for any software application however some applications demand higher investment on the config piece than others. One key differentiator perhaps here is how many config fields one has and how each of these relates to the other. This can get real messy real quick with deep learning experiments where the list of config and hyperparameters can rapidly grow out of hand as soon as one breaks out of adhoc experimentations.</p> <ul> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#pydra---pydantic-and-hydra-for-configuration-management-of-model-training-experiments>Pydra - Pydantic and Hydra for configuration management of model training experiments</a></li> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#context>Context</a></li> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#hydra>Hydra</a><ul> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#a-simple-non-structured-config-example>A simple non-structured config example</a></li> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#an-extension-using-structured-config>An extension using structured config</a></li> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#some-other-interesting-features-of-hydra>Some other interesting features of hydra</a></li> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#interpolation>Interpolation</a></li> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#hydra-directives>Hydra Directives</a></li> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#where-hydra-falls-short>Where Hydra falls short?</a></li> </ul> </li> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#pydantic>Pydantic</a><ul> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#an-few-interesting-notes>An few interesting notes</a></li> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#can-pydantic-bridge-the-gaps-in-hydra>Can Pydantic bridge the gaps in hydra</a></li> </ul> </li> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#how-well-does-this-integrate-with-other-ecosystem-tools>How well does this integrate with other ecosystem tools</a></li> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#version-config>Version config</a></li> <li><a href=../../2023/11/12/hydra-pydantic-config-management/#conclusion>Conclusion</a></li> </ul> <h3 id=context><a class=toclink href=../../2023/11/12/hydra-pydantic-config-management/#context>Context</a></h3> <p>By definition model training configurations are hierarchial. For example, an experiment configuration can be broken down into data and model specifications. While these are loosely coupled specifications, they may enforce some degree of restrictions on each other e.g. model's output specification needs to be in line with data specification. A classifier network needs to output a 10 length vector if the data source is MNIST and 20 if it's PASCAL VOC. </p> <p>Overall, configuration solution for training experiments has following requirements:</p> <ol> <li>Ability to easily templatize configurations of various components of your training experiments.</li> <li>Ability to organize the configuration of training in a hierarchical fashion acknowledging the dependency and hierarchy of participating components.</li> <li>Without duplication, reuse configurations across modules wherever needed by means such as interpolation, expressions.</li> <li>Ability to compose config using templates and applying customization through overrides, environments etc.</li> <li>Being able to store and reuse the final assembled/compiled config and reproduce the experiments reliably.</li> <li>Support structured config consisting of potentially complex, canonical python types with strong validation support beyond type hint. This perhaps is optional if one is not interested in dynamic domain-specific validations - something that can not be achieved in serialized formats like yaml/json.</li> <li>Ability to version config and enforce a schema on the config specification for reliability and robustness.</li> <li>Ability to integrate easily into complex distributed launcher frameworks for both local and remote launch.</li> <li>A configuration management that nicely integrates into your echo-system of tools and is not very dictative.</li> </ol> <p>With that in mind, I evaluated a bunch of tools combination of <a href="https://hydra.cc/">Hydra</a> and <a href="https://pydantic-docs.helpmanual.io/">Pydantic</a> stood out as a good choice. In this post, I will go over my learnings of both the tools and also talk about gaps I still see present. Lastly, put forth a tentative solution for this gap. The structure of this post is as follows:</p> <ol> <li><a href="https://hydra.cc/">Hydra</a> - its strengths and also, what I think are its weakness.</li> <li><a href="https://pydantic-docs.helpmanual.io/">Pydantic</a> - how it can be used to fill in the void of Hydra</li> <li>The missing bits of config management from Pydra i.e. both <a href="https://hydra.cc/">Hydra</a> &amp; <a href="https://pydantic-docs.helpmanual.io/">Pydantic</a></li> <li>The solution to bridging the gap</li> <li>Conclusion</li> </ol> <p><em>Note:</em> The samples and code shared in this post are available <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management">here</a>.</p> <h3 id=hydra><a class=toclink href=../../2023/11/12/hydra-pydantic-config-management/#hydra>Hydra</a></h3> <p><a href="https://hydra.cc/">Hydra</a> is a dynamic hierarchical config management tool with the ability to override parts of the config and also to compose the config through various sources (eg command line args, environment variables). It offers a nice solution to templated configurations that can be repurposed dynamically based on your objectives. Beyond rewriting rules, compositions, and interpolations to re-config templates, it also provides a mechanism to represent the config in plain old python object style and can take care of serialization and deserialization itself. On some noteworthy features side - with hydra you can fire multi-process workload on multiple instances of configurations derived from the same template source. This can be a really handy feature for many use cases including side-by-side comparisons. </p> <p>It is also extensible in a way that one can write their plugins to launch local or remote workload. Some other nice noteworthy features are runner config and callbacks. All in all, powered by <a href="https://github.com/omry/omegaconf">OmegaConf</a> this is a great tool for config management. </p> <h4 id=a-simple-non-structured-config-example><a class=toclink href=../../2023/11/12/hydra-pydantic-config-management/#a-simple-non-structured-config-example>A simple non-structured config example</a></h4> <p>Let's look at a simple use of hydra for yaml based config without involving python object model for config. This example is borrowed and extended from <a href="https://hydra.cc/docs/1.0/tutorials/basic/your_first_app/composition/">a hydra sample</a>. . <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/blob/master/hydra/my_app_non_structured.py">this example</a> demonstrates 3 config modules i.e. db, schema and ui assembled togather via high level <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/blob/master/hydra/conf/config.yaml">config.yaml</a>. </p> <blockquote> <p><img alt src=../../../resources/pydra/basic_config.jpg> <em>Example hierarchical hydra config.</em></p> </blockquote> <p><div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>logging</span>
<span class=kn>from</span><span class=w> </span><span class=nn>dataclasses</span><span class=w> </span><span class=kn>import</span> <span class=n>dataclass</span>
<span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Optional</span>

<span class=kn>import</span><span class=w> </span><span class=nn>hydra</span>
<span class=kn>from</span><span class=w> </span><span class=nn>hydra.core.config_store</span><span class=w> </span><span class=kn>import</span> <span class=n>ConfigStore</span>
<span class=kn>from</span><span class=w> </span><span class=nn>hydra.core.hydra_config</span><span class=w> </span><span class=kn>import</span> <span class=n>HydraConfig</span>
<span class=kn>from</span><span class=w> </span><span class=nn>omegaconf</span><span class=w> </span><span class=kn>import</span> <span class=n>MISSING</span><span class=p>,</span> <span class=n>DictConfig</span><span class=p>,</span> <span class=n>OmegaConf</span>

<span class=n>log</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>


<span class=nd>@hydra</span><span class=o>.</span><span class=n>main</span><span class=p>(</span><span class=n>config_path</span><span class=o>=</span><span class=s2>&quot;conf&quot;</span><span class=p>,</span> <span class=n>config_name</span><span class=o>=</span><span class=s2>&quot;config&quot;</span><span class=p>)</span>
<span class=k>def</span><span class=w> </span><span class=nf>my_app</span><span class=p>(</span><span class=n>cfg</span><span class=p>:</span> <span class=n>DictConfig</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Type of cfg is: </span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=nb>type</span><span class=p>(</span><span class=n>cfg</span><span class=p>))</span>
    <span class=n>cfg_dict</span> <span class=o>=</span> <span class=n>OmegaConf</span><span class=o>.</span><span class=n>to_container</span><span class=p>(</span><span class=n>cfg</span><span class=p>,</span> <span class=n>throw_on_missing</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>resolve</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Merged Yaml:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>OmegaConf</span><span class=o>.</span><span class=n>to_yaml</span><span class=p>(</span><span class=n>cfg</span><span class=p>))</span>

    <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>cfg</span><span class=o>.</span><span class=n>db</span><span class=p>)</span>
    <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>cfg</span><span class=o>.</span><span class=n>db</span><span class=o>.</span><span class=n>driver</span><span class=p>)</span>

    <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>HydraConfig</span><span class=o>.</span><span class=n>get</span><span class=p>()</span><span class=o>.</span><span class=n>job</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>


<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&quot;__main__&quot;</span><span class=p>:</span>
    <span class=n>my_app</span><span class=p>()</span>
</code></pre></div> Sample code can be found <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/blob/master/hydra/my_app_non_structured.py">here</a></p> <p>A few things happening in this script: 1. How is config loaded: The above script tells hydra to look for hierarchical config under <code>conf</code> as a base location for config directory, and <code>config.yaml</code> as top-level config specification. This setting is defaulted by python decorator <code>@hydra.main(config_path="conf", config_name="config")</code>. A user can override these settings and point the config location to another place by using <code>--config-dir</code> for the base directory and <code>--config-name</code> for top-level config.yaml as follows: <div class=highlight><pre><span></span><code>python<span class=w> </span>my_app_non_structured.py<span class=w> </span>--config-dir<span class=w> </span>conf_custom_hydra
python<span class=w> </span>my_app_non_structured.py<span class=w> </span>--config-name<span class=w> </span>config_hydra
</code></pre></div> 2. What format can I access config: Once hydra has loaded the config, it will be loaded as dict/dictionary and surfaced as <code>DictConfig</code> from <a href="https://github.com/omry/omegaconf">OmegaConf</a>. The benefit <code>DictConfig</code> is you can access the fields as variable accessors e.g. <code>cfg.db.driver</code> as shown in code above instead of dict str key access pattern. 3. Where is composition coming from: What's defined in <code>conf</code> directory is template config. Some values may be missing - which can be represented in yaml as <code>???</code>. It's also possible to override some values from the template config at runtime. An example of this is: <code>python my_app_non_structured.py db.user=suneeta</code> Here, the final used configuration that the application will see is: <div class=highlight><pre><span></span><code>db:
  driver: mysql
  user: suneeta
  pwd: secret
ui:
  create_db: true
  view: true
schema:
  database: school
  tables:
  - name: students
  - name: exams
</code></pre></div> 4. What is the final config used in my run: Hydra saves the specifics of the config used in the run in its output location. By default the output location is <code>outputs/YYYY-MM-DD/HH-MM-SS/.hydra/config.yaml</code> which can be used to rerun the same run for reproducibility. <div class=highlight><pre><span></span><code>python<span class=w> </span>my_app_non_structured.py<span class=w> </span>--config-dir<span class=o>=</span>outputs/2022-03-16/13-45-29/.hydra
</code></pre></div> Hydra also allows you to configure job and run settings, an example of such configuration is located <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/tree/master/hydra/conf_custom_hydra/hydra">here</a>. Alternatively, one can also override these settings in the main <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/blob/master/hydra/conf/config_hydra.yaml">config.yaml</a> file:</p> <p><div class=highlight><pre><span></span><code><span class=nt>defaults</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">_self_</span><span class=w>  </span><span class=c1># Note: to source default of hydra config </span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>db</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>ui</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">full</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>schema</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">school</span>

<span class=nt>hydra</span><span class=p>:</span>
<span class=w>  </span><span class=nt>job</span><span class=p>:</span>
<span class=w>    </span><span class=nt>env_set</span><span class=p>:</span><span class=w> </span>
<span class=w>      </span><span class=nt>HDF5_USE_FILE_LOCKING</span><span class=p>:</span><span class=w> </span><span class=s>&quot;false&quot;</span>
<span class=w>      </span><span class=c1>## Useful for distributed train setup</span>
<span class=w>      </span><span class=c1># RANK: ${hydra.job.num}</span>
<span class=w>    </span><span class=nt>env_copy</span><span class=p>:</span><span class=w> </span><span class=c1>## Local environment copy</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">API_KEY</span><span class=w>  </span>

<span class=w>  </span><span class=nt>job_logging</span><span class=p>:</span>
<span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class=w>    </span><span class=nt>formatters</span><span class=p>:</span>
<span class=w>      </span><span class=nt>simple</span><span class=p>:</span>
<span class=w>        </span><span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=s>&quot;[%(levelname)s]</span><span class=nv> </span><span class=s>-</span><span class=nv> </span><span class=s>%(message)s&quot;</span>
<span class=w>    </span><span class=nt>handlers</span><span class=p>:</span>
<span class=w>      </span><span class=nt>console</span><span class=p>:</span>
<span class=w>        </span><span class=nt>class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">logging.StreamHandler</span>
<span class=w>        </span><span class=nt>formatter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">simple</span>
<span class=w>        </span><span class=nt>stream</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ext://sys.stdout</span>
<span class=w>    </span><span class=nt>root</span><span class=p>:</span>
<span class=w>      </span><span class=nt>handlers</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>console</span><span class="p p-Indicator">]</span>

<span class=w>    </span><span class=nt>disable_existing_loggers</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class=w>  </span><span class=nt>run</span><span class=p>:</span>
<span class=w>    </span><span class=nt>dir</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">outputs/${hydra.job.name}/${now:%Y-%m-%d_%H-%M-%S}</span>
</code></pre></div> 5. Multi-run and templates: Multi-run allows users to run the multi-process workload on the same template of config but dynamically changing some values of it. Effectively, the user will be running multiple processes of the same code under different configurations. Parameter sweeps are a really good use case for when this may come in handy. In the following run, <code>multirun</code> is doing the trick triggering 3 different processes each for schema of school, support, and warehouse. <div class=highlight><pre><span></span><code>python<span class=w> </span>my_app_non_structured.py<span class=w> </span>db.user<span class=o>=</span>suneeta<span class=w> </span><span class=nv>schema</span><span class=o>=</span>school,support,warehouse<span class=w>  </span>--config-dir<span class=w> </span>conf_custom_hydra<span class=w> </span>--multirun
</code></pre></div></p> <p>Each process gets an int id assigned which the application can recognize. The index starts from 0, as shown in fig below. </p> <blockquote> <p><img alt src=../../../resources/pydra/multi-runs.jpg> <em>Example Of multi-runs.</em></p> </blockquote> <p>This is especially useful in distributed training runs where things like <a href="https://pytorch.org/tutorials/intermediate/dist_tuto.html">RANK</a> of process needs to be known. This can be easily configured using hydra as <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/blob/master/hydra/conf/config_hydra.yaml#L12">following</a>: <div class=highlight><pre><span></span><code>hydra:
  job:
    env_set: 
      RANK: ${hydra.job.num}
</code></pre></div></p> <h4 id=an-extension-using-structured-config><a class=toclink href=../../2023/11/12/hydra-pydantic-config-management/#an-extension-using-structured-config>An extension using structured config</a></h4> <p>If your application configs are slightly more complex and you might want object representation of your config then <a href="https://hydra.cc/">Hydra</a> provided structured config option with <code>ConfigStore</code>. An example of this is <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/blob/master/hydra/my_app.py">here</a>.</p> <p>In this case, you define your config object model as follows: <div class=highlight><pre><span></span><code><span class=nd>@dataclass</span>
<span class=k>class</span><span class=w> </span><span class=nc>DBConfig</span><span class=p>:</span>
    <span class=n>user</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>MISSING</span>
    <span class=n>pwd</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>MISSING</span>
    <span class=n>driver</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>MISSING</span>
    <span class=n>timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>100</span>


<span class=nd>@dataclass</span>
<span class=k>class</span><span class=w> </span><span class=nc>MySQLConfig</span><span class=p>(</span><span class=n>DBConfig</span><span class=p>):</span>
    <span class=n>driver</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;mysql&quot;</span>


<span class=nd>@dataclass</span>
<span class=k>class</span><span class=w> </span><span class=nc>PostGreSQLConfig</span><span class=p>(</span><span class=n>DBConfig</span><span class=p>):</span>
    <span class=n>driver</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;postgresql&quot;</span>


<span class=nd>@dataclass</span>
<span class=k>class</span><span class=w> </span><span class=nc>View</span><span class=p>:</span>
    <span class=n>create_db</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=n>view</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=n>MISSING</span>


<span class=nd>@dataclass</span>
<span class=k>class</span><span class=w> </span><span class=nc>Table</span><span class=p>:</span>
    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>MISSING</span>


<span class=nd>@dataclass</span>
<span class=k>class</span><span class=w> </span><span class=nc>Schema</span><span class=p>:</span>
    <span class=n>database</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;school&quot;</span>
    <span class=n>tables</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Table</span><span class=p>]</span> <span class=o>=</span> <span class=n>MISSING</span>


<span class=nd>@dataclass</span>
<span class=k>class</span><span class=w> </span><span class=nc>Config</span><span class=p>:</span>
    <span class=c1># We can now annotate db as DBConfig which</span>
    <span class=c1># improves both static and dynamic type safety.</span>
    <span class=n>db</span><span class=p>:</span> <span class=n>DBConfig</span>
    <span class=n>ui</span><span class=p>:</span> <span class=n>View</span>
    <span class=n>schema</span><span class=p>:</span> <span class=n>Schema</span>
</code></pre></div> A few things noteworthy to call out here: 1. <code>MISSING</code> is the replacement of yaml equivalent of missing denoted as <code>???</code>. 2. Hydra can only work with plain old python objects and at best with <a href="https://docs.python.org/3/library/dataclasses.html">dataclasses</a> or drop-in replacements of <code>dataclasses</code>. 3. Structured config can not work with python primitives and cant serde (serialize and deserialize) canonical or complex python objects. Not even things like python pathlib <code>Path</code>. </p> <p>Once, the config object model is done, one should define <code>ConfigStore</code> and register <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/blob/master/hydra/my_app.py#L57-L62">config objects</a>: <div class=highlight><pre><span></span><code>cs = ConfigStore.instance()
cs.store(name=&quot;config&quot;, node=Config)
cs.store(group=&quot;db&quot;, name=&quot;mysql&quot;, node=MySQLConfig)
cs.store(group=&quot;db&quot;, name=&quot;postgresql&quot;, node=PostGreSQLConfig)
cs.store(name=&quot;ui&quot;, node=View)
cs.store(name=&quot;schema&quot;, node=Schema)
</code></pre></div></p> <p>Here, <code>group</code> key in config registry indicates mutually exclusive groups. More about these can be found <a href="https://hydra.cc/docs/tutorials/structured_config/config_groups/">here</a>.</p> <p>How does hydra injection change then to support config store? Not by a lot, as shown in this <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/blob/master/hydra/my_app.py#L75-L80">example</a>, changing <code>DictConfig</code> to your high-level config object <code>Config</code> in this case does the trick. Then, <code>OmegaConf.to_object(cfg)</code> unpacks dict config in your python object model. <div class=highlight><pre><span></span><code>@hydra.main(config_path=&quot;conf&quot;, config_name=&quot;config&quot;)
def my_app(cfg: Config) -&gt; None:    
    log.info(&quot;Type of cfg is: %s&quot;, type(cfg))
    cfg_dict = OmegaConf.to_container(cfg, throw_on_missing=False, resolve=True)

    cfg_obj = OmegaConf.to_object(cfg)
</code></pre></div></p> <p>This is all the application needs to do to move to structured config and features discussed earlier can be explored using the following commands: <div class=highlight><pre><span></span><code>python my_app.py
python my_app.py db.user=suneeta    
python my_app.py db.user=suneeta --config-dir conf_custom_hydra
# python my_app.py db.user=suneeta --config-name config_hydra
# Multi-run
python my_app.py db.user=suneeta schema=school,support,warehouse  --config-dir conf_custom_hydra --multirun
</code></pre></div> Code located <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/blob/master/hydra/my_app.py">here</a></p> <p>There is another approach <a href="https://hydra.cc/">Hydra</a> offers to <a href="https://hydra.cc/docs/advanced/instantiate_objects/overview/">instantiate objects</a> through the config. This approach requires the user to know which config is object-able beforehand as unpacking them into objects requires explicit calls to <code>instantiate</code> API. An example of such use is as follows, notice fully qualified class name in <code>__target__</code> field in config:</p> <blockquote> <p><img alt src=../../../resources/pydra/instantiate.jpg> <em>Example Of instantiate objects.</em></p> </blockquote> <p>This feature, in my view, should be used sparingly as it tightly couples the config to application-specific objects. This kind of mixed-breed config handling approach is very hard to maintain and understand.</p> <h4 id=some-other-interesting-features-of-hydra><a class=toclink href=../../2023/11/12/hydra-pydantic-config-management/#some-other-interesting-features-of-hydra>Some other interesting features of hydra</a></h4> <h5 id=interpolation><a class=toclink href=../../2023/11/12/hydra-pydantic-config-management/#interpolation>Interpolation</a></h5> <p>Interpolation offers a means to refer to an existing config instead of duplicating it. It also allows users to use derive values obtained through string interpolation in config. An example of interpolation is shown below:</p> <blockquote> <p><img alt src=../../../resources/pydra/Interpolation.jpg> <em>Example Of instantiate objects.</em></p> </blockquote> <h5 id=hydra-directives><a class=toclink href=../../2023/11/12/hydra-pydantic-config-management/#hydra-directives>Hydra Directives</a></h5> <p><a href="https://hydra.cc/">Hydra</a> allows overriding package configuration employing directives; documentation for these is <a href="https://hydra.cc/docs/1.0/advanced/overriding_packages/">here</a>. In short, they offer means to rewrite and relocate config dynamically. I think this is evil and facilitates yaml engineering. It can also be a debugging nightmare if your intended use of config is beyond standard interfaces. </p> <blockquote> <p><img alt src=../../../resources/pydra/directives-rewrites.jpg> <em>Example Of directives to rewrite config specifications.</em></p> </blockquote> <p>Talking about directives, <code>__global__</code> are quite handy in managing configuration overrides. One example is shown here on <a href="https://hydra.cc/docs/patterns/configuring_experiments/">hydra samples itself</a></p> <h4 id=where-hydra-falls-short><a class=toclink href=../../2023/11/12/hydra-pydantic-config-management/#where-hydra-falls-short>Where Hydra falls short?</a></h4> <p>Overall, <a href="https://github.com/omry/omegaconf">OmegaConf</a> and <a href="https://hydra.cc/">Hydra</a> are two powerful tools for config management, however, I personally find the following shortcoming in these tools:</p> <ol> <li> <p>No support to serde (serialize and deserialize) canonical or complex python objects can be really annoying and causes more overhead for applications. Only primitive supports are a good start. </p> <p>1.1. <a href="https://github.com/omry/omegaconf">OmegaConf</a> and <a href="https://hydra.cc/">Hydra</a> does not support <code>Union</code> type in the config either.</p> </li> <li> <p>Support for structured config type is limited to plain old Python objects or dataclasses (and drop-in replacement thereof).</p> </li> <li> <p>Validation framework is a must-have in any config management framework. Anything users provide must be validated in the application for various things like type-checking, application-specific validation, constraint limits, etc. This is currently offloaded largely to application. The choice application is left with is using structured config as simple objects and performing all validation explicitly including obvious things like type checking. This is limiting in my view.</p> </li> <li> <p>Interpolation is great to have feature. Extension to this is being able to run expression-based interpolations eg list of items to the total item in the list. However, this support is lacking in <a href="https://hydra.cc/">Hydra</a> with <a href="https://github.com/omry/omegaconf/issues/91">issues</a> being raised.</p> </li> </ol> <h3 id=pydantic><a class=toclink href=../../2023/11/12/hydra-pydantic-config-management/#pydantic>Pydantic</a></h3> <p><a href="https://pydantic-docs.helpmanual.io/">Pydantic</a> offers a runtime type enforcement and validation and is itself a data validation and settings management tool. It works with pure canonical python data models and provides two approaches for this: 1. <a href="https://pydantic-docs.helpmanual.io/usage/dataclasses/">Drop in replacement of dataclass</a> 2. <a href="https://pydantic-docs.helpmanual.io/usage/models/">BaseModel abstraction</a></p> <p>Through its validation framework and type checking pydantic offers schema enforcement and can serialize and deserialize objects from various formats including but not limited to yaml/json, xml, ORM, etc. Its field type support especially <a href="https://pydantic-docs.helpmanual.io/usage/types/#constrained-types">constrained types</a> are very rich and vastly simplifies application config validations. Eg can the image size be less than 0? What's the best approach to validate this? limit at config level or sprinkle that in the application where config is used?</p> <p>Overall, pydantic is a well-documented library, an example of its dataclass use is as shown <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/blob/master/pydantic/model_dc.py">below</a>: <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>logging</span>
<span class=kn>import</span><span class=w> </span><span class=nn>sys</span>
<span class=kn>from</span><span class=w> </span><span class=nn>pathlib</span><span class=w> </span><span class=kn>import</span> <span class=n>Path</span>
<span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Optional</span><span class=p>,</span> <span class=n>Union</span>

<span class=kn>from</span><span class=w> </span><span class=nn>pydantic</span><span class=w> </span><span class=kn>import</span> <span class=n>BaseModel</span><span class=p>,</span> <span class=n>conint</span><span class=p>,</span> <span class=n>validator</span>
<span class=kn>from</span><span class=w> </span><span class=nn>pydantic.dataclasses</span><span class=w> </span><span class=kn>import</span> <span class=n>dataclass</span>


<span class=n>log</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>


<span class=nd>@dataclass</span>
<span class=k>class</span><span class=w> </span><span class=nc>Dataset</span><span class=p>:</span>
    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
    <span class=n>path</span><span class=p>:</span> <span class=nb>str</span>

    <span class=nd>@validator</span><span class=p>(</span><span class=s2>&quot;path&quot;</span><span class=p>)</span>
    <span class=k>def</span><span class=w> </span><span class=nf>validate_path</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Path</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>Path</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;exist&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>Path</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>


<span class=nd>@dataclass</span>
<span class=k>class</span><span class=w> </span><span class=nc>Model</span><span class=p>:</span>
    <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span>
    <span class=n>num_layers</span><span class=p>:</span> <span class=n>conint</span><span class=p>(</span><span class=n>ge</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
    <span class=n>width</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>conint</span><span class=p>(</span><span class=n>ge</span><span class=o>=</span><span class=mi>0</span><span class=p>)]</span>

    <span class=nd>@validator</span><span class=p>(</span><span class=s2>&quot;type&quot;</span><span class=p>)</span>
    <span class=k>def</span><span class=w> </span><span class=nf>validate_supported_type</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
        <span class=k>if</span> <span class=nb>type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=s2>&quot;alex&quot;</span><span class=p>,</span> <span class=s2>&quot;le&quot;</span><span class=p>]:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;&#39;type&#39; canonly be [alex, le] got: </span><span class=si>{</span><span class=nb>type</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=nb>type</span>


<span class=nd>@dataclass</span>
<span class=k>class</span><span class=w> </span><span class=nc>Config</span><span class=p>:</span>
    <span class=n>dataset</span><span class=p>:</span> <span class=n>Dataset</span>
    <span class=n>model</span><span class=p>:</span> <span class=n>Model</span>
</code></pre></div> Notice the use of the validator decorator here. This is an approach to validate for application-specific logics.</p> <p>BaseModel comes with more bells and whistles as it provides syntactic sugar of <code>Config</code> inner class that can be used to configure the behavior of a concrete implementation of BaseModels. Details of this can be found <a href="https://pydantic-docs.helpmanual.io/usage/model_config/">here</a>. Some of the settings like <code>anystr_lower</code> and <code>use_enum_values</code> are so handy. Who does not want to work with case insensitive configurations but keep the application clear of case conversions? Like BCE and bce means any different than binary cross entropy? BaseModel implementation looks like this:</p> <p><div class=highlight><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>Dataset</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
    <span class=n>path</span><span class=p>:</span> <span class=nb>str</span>

    <span class=nd>@validator</span><span class=p>(</span><span class=s2>&quot;path&quot;</span><span class=p>)</span>
    <span class=k>def</span><span class=w> </span><span class=nf>validate_path</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Path</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>Path</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;exist&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>Path</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>

    <span class=k>class</span><span class=w> </span><span class=nc>Config</span><span class=p>:</span>
        <span class=n>title</span> <span class=o>=</span> <span class=s2>&quot;Dataset&quot;</span>
        <span class=n>max_anystr_length</span> <span class=o>=</span> <span class=mi>10</span>
        <span class=n>allow_mutation</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=n>validate_assignment</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=n>anystr_lower</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=n>validate_all</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=n>use_enum_values</span> <span class=o>=</span> <span class=kc>True</span> 
</code></pre></div> Full example code is located <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/blob/master/pydantic/model.py">here</a></p> <p>BaseSettings is also another great feature that seeks to abstract away settings/config that is sourced from other sources like an environment variable, init files, etc. <div class=highlight><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>Secrets</span><span class=p>(</span><span class=n>BaseSettings</span><span class=p>):</span>
    <span class=n>api_key</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=s2>&quot;api_key&quot;</span><span class=p>)</span>
    <span class=n>token</span><span class=p>:</span> <span class=nb>str</span>

    <span class=k>class</span><span class=w> </span><span class=nc>Config</span><span class=p>:</span>
        <span class=c1># case_sensitive = True</span>
        <span class=n>env_nested_delimiter</span> <span class=o>=</span> <span class=s2>&quot;_&quot;</span>

        <span class=nd>@classmethod</span>
        <span class=k>def</span><span class=w> </span><span class=nf>customise_sources</span><span class=p>(</span>
            <span class=bp>cls</span><span class=p>,</span>
            <span class=n>init_settings</span><span class=p>:</span> <span class=n>SettingsSourceCallable</span><span class=p>,</span>
            <span class=n>env_settings</span><span class=p>:</span> <span class=n>SettingsSourceCallable</span><span class=p>,</span>
            <span class=n>file_secret_settings</span><span class=p>:</span> <span class=n>SettingsSourceCallable</span><span class=p>,</span>
        <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>SettingsSourceCallable</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
            <span class=k>return</span> <span class=n>env_settings</span><span class=p>,</span> <span class=n>init_settings</span><span class=p>,</span> <span class=n>file_secret_settings</span>
</code></pre></div></p> <h4 id=an-few-interesting-notes><a class=toclink href=../../2023/11/12/hydra-pydantic-config-management/#an-few-interesting-notes>An few interesting notes</a></h4> <ol> <li>It's interesting to note that the validator of pydantic can be repurposed to implement derived fields. An example of this is captured <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/blob/master/pydantic/dynamic.py">here</a>: The use-case being, a list of classes is already provided in config in another module say data. You want to "infer" the total number of classes from this in the model config. In this case, you can interpolate and copy over a list of classes from the data module to model but your requirement of actually only caring about total classes is unfulfilled as you cant do expression-based interpolation just yet. In this case, <code>total_classes</code> can be defined as either list of int and then the total is deduced upon validation, leaving your in config object always representing total int value and logic-based deduction happening upon validation. Example of this is as follows:</li> </ol> <p><div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Union</span>
<span class=kn>from</span><span class=w> </span><span class=nn>pydantic</span><span class=w> </span><span class=kn>import</span> <span class=n>BaseModel</span><span class=p>,</span> <span class=n>conint</span><span class=p>,</span> <span class=n>validator</span>

<span class=k>class</span><span class=w> </span><span class=nc>Model</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
    <span class=n>total_classes</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>conint</span><span class=p>(</span><span class=n>ge</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span> <span class=n>List</span><span class=p>[</span><span class=n>conint</span><span class=p>(</span><span class=n>ge</span><span class=o>=</span><span class=mi>0</span><span class=p>)]]</span>

    <span class=nd>@validator</span><span class=p>(</span><span class=s2>&quot;total_classes&quot;</span><span class=p>)</span>
    <span class=k>def</span><span class=w> </span><span class=nf>validate_classes</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>total_classes</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>conint</span><span class=p>(</span><span class=n>ge</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span> <span class=n>List</span><span class=p>[</span><span class=n>conint</span><span class=p>(</span><span class=n>ge</span><span class=o>=</span><span class=mi>0</span><span class=p>)]])</span> <span class=o>-&gt;</span> <span class=n>conint</span><span class=p>(</span><span class=n>ge</span><span class=o>=</span><span class=mi>0</span><span class=p>):</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>total_classes</span><span class=p>,</span> <span class=n>List</span><span class=p>):</span>
            <span class=k>return</span> <span class=nb>len</span><span class=p>(</span><span class=n>total_classes</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>total_classes</span>
</code></pre></div> I have not seen any issue in the use of validator like this but unsure if this is the intended use of validator support. Also, unsure why the validator returns in the said interface. </p> <ol> <li>Hydra's benchmarking is pretty favorable (see image below). However, they dont benchmark against OmegaConf and some other related tools, see details <a href="https://github.com/samuelcolvin/pydantic/pull/3264">here</a>. </li> </ol> <blockquote> <p><img alt src=../../../resources/pydra/benchmark.jpg> <em>Hydra's benchmarks.</em></p> </blockquote> <h4 id=can-pydantic-bridge-the-gaps-in-hydra><a class=toclink href=../../2023/11/12/hydra-pydantic-config-management/#can-pydantic-bridge-the-gaps-in-hydra>Can Pydantic bridge the gaps in hydra</a></h4> <p>Pydantic offers a strong validation framework something that's been missing in hydra. While drop-in replacement of pydantic dataclass works with hydra one can still miss out on the syntactical sugars of Model Config and still be limited to primitives and non Union types and more interesting constrained types of pydantic. </p> <p>It's fair to say that direct integration of hydra with pydantic is absent. The follow-up question should be, can we make it work? Sure we can :). </p> <p>An example demonstrating how <a href="https://hydra.cc/">Hydra</a> and <a href="https://pydantic-docs.helpmanual.io/">Pydantic</a> can be used in conjunction is shown <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/blob/master/pydantic_hydra/example.py">here</a>. The secret sauce of integration lies in the following:</p> <ol> <li>Giving up on the use of <code>ConfigStore</code> of hydra</li> <li>Reading the config as <code>DictConfig</code> and unpacking to Pydantic BaseModel object via dict</li> </ol> <p>In short, this is two-liner: <div class=highlight><pre><span></span><code>    <span class=n>OmegaConf</span><span class=o>.</span><span class=n>resolve</span><span class=p>(</span><span class=n>cfg</span><span class=p>)</span>
    <span class=n>r_model</span> <span class=o>=</span> <span class=n>Config</span><span class=p>(</span><span class=o>**</span><span class=n>cfg</span><span class=p>)</span>
</code></pre></div> where <code>Config</code> is a concrete implementation of <a href="https://pydantic-docs.helpmanual.io/">Pydantic</a>'s BaseModel. The decision we make it here is configs are specified in yaml format and we leave Hydra to manage template, composition, and all the good things of non-structured config management. Upon resolution and merge of config, we deserialize with Pydantic and get all the goodies of Pydantic validation, check, etc.</p> <h3 id=how-well-does-this-integrate-with-other-ecosystem-tools><a class=toclink href=../../2023/11/12/hydra-pydantic-config-management/#how-well-does-this-integrate-with-other-ecosystem-tools>How well does this integrate with other ecosystem tools</a></h3> <p>Given hydra can provide a final configuration in dict format, the configuration side can easily integrate with echo-system tools that care about configs. Given most experiment management and tracking tools support managing config as dict, this is less of a challenge. A post from <a href="https://wandb.ai/adrishd/hydra-example/reports/Configuring-W-B-Projects-with-Hydra--VmlldzoxNTA2MzQw">Weights and biases</a> goes in detail about integration. </p> <p>It's interesting to note that other features of Hydra like multirun and sweeps given they employ multi-processing may interfere with other tools employing MP techniques too. </p> <h3 id=version-config><a class=toclink href=../../2023/11/12/hydra-pydantic-config-management/#version-config>Version config</a></h3> <p>Versioning is very important practice to follow if one works with large, actively evolving code base. For the same reasons as REST APIs should be versioned, docker images are versioned, library releases are versioned, and so on, application config specifications should be versioned as well. If not for incremental updates then at least for breaking changes. <a href="https://kubernetes.io/">Kubernetes</a> actually does this really well, where users can bring their resource specification of supported version and it can work with that version creating ../resources for you. There is lot more complexity in config management that Kubernetes immplements but whats transferable here in my view is:</p> <ol> <li>When creating a run, always use latest version of config.</li> <li>Have a support in place where you can migrate your old configs to latest version of config so you can reproduce [not repeat] your experiments with newer features should you need to.</li> </ol> <p><a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/blob/master/pydantic_hydra/example.py#L83-L172">This prototype</a> is a toy example to explore how to handle versioning in the config and provide a migration path for when old version config is provided. The assumption made here is, your training code only ever works with the latest version of config so the application code is simple and is always progressive. Whenever a breaking change is introduced, a new float version of config is created while the preceding version of config implements a migration path to the following version.</p> <p>Code shown below, represents Model config which has 3 versions <code>v</code> i.e. 1.0, 2.0, 3.0. Each version makes a breaking change to the previous but each concrete implementation implements a method <code>def to_next(self) -&gt; Optional[BaseModel]</code> that cracks at migrating the config to a new specification. <div class=highlight><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>VersionModel</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>,</span> <span class=n>abc</span><span class=o>.</span><span class=n>ABC</span><span class=p>):</span>
    <span class=n>v</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;inf&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=nb>float</span><span class=p>(</span><span class=s2>&quot;inf&quot;</span><span class=p>),</span> <span class=n>const</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=k>class</span><span class=w> </span><span class=nc>Config</span><span class=p>:</span>
        <span class=n>title</span> <span class=o>=</span> <span class=s2>&quot;Model&quot;</span>
        <span class=n>allow_mutation</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=n>max_anystr_length</span> <span class=o>=</span> <span class=mi>10</span>
        <span class=n>validate_assignment</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=n>anystr_lower</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=n>validate_all</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=n>use_enum_values</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=k>def</span><span class=w> </span><span class=nf>version</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>v</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_next_version_model</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
        <span class=n>versions</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>fake_registry</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
        <span class=n>versions</span><span class=o>.</span><span class=n>sort</span><span class=p>()</span>
        <span class=n>idx</span> <span class=o>=</span> <span class=n>versions</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>v</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
        <span class=k>if</span> <span class=n>idx</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>versions</span><span class=p>):</span>
            <span class=k>return</span> <span class=kc>None</span>
        <span class=k>return</span> <span class=n>versions</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>next_version</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>BaseModel</span><span class=p>:</span>
        <span class=n>next_class</span> <span class=o>=</span> <span class=n>fake_registry</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_next_version_model</span><span class=p>())</span>
        <span class=k>return</span> <span class=n>next_class</span>

    <span class=nd>@abc</span><span class=o>.</span><span class=n>abstractmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>to_next</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>BaseModel</span><span class=p>:</span>
        <span class=k>pass</span>


<span class=k>class</span><span class=w> </span><span class=nc>Model1</span><span class=p>(</span><span class=n>VersionModel</span><span class=p>):</span>
    <span class=c1># https://pydantic-docs.helpmanual.io/usage/types/#arguments-to-constr</span>
    <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span>  <span class=c1># constr(to_lower=True)</span>
    <span class=n>num_layers</span><span class=p>:</span> <span class=n>conint</span><span class=p>(</span><span class=n>ge</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
    <span class=n>width</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>conint</span><span class=p>(</span><span class=n>ge</span><span class=o>=</span><span class=mi>0</span><span class=p>)]</span>
    <span class=c1># v: float = Field(1.0, const=True)</span>
    <span class=n>zoom</span><span class=p>:</span> <span class=n>conint</span><span class=p>(</span><span class=n>gt</span><span class=o>=</span><span class=mi>18</span><span class=p>)</span> <span class=o>=</span> <span class=mi>19</span>
    <span class=n>v</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=mf>1.0</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>const</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=c1># @classmethod</span>
    <span class=c1># def to_next(cls, instance: Type[VBT]) -&gt; BaseModel:</span>
    <span class=k>def</span><span class=w> </span><span class=nf>to_next</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>BaseModel</span><span class=p>]:</span>
        <span class=n>next_class</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>next_version</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>next_class</span> <span class=o>!=</span> <span class=n>Model2</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&quot;WTH&quot;</span><span class=p>)</span>

        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;================================================&quot;</span><span class=p>)</span>
        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;==============Migrating from 1-&gt;2 ==============&quot;</span><span class=p>)</span>
        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;================================================&quot;</span><span class=p>)</span>

        <span class=n>d</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dict</span><span class=p>()</span>
        <span class=n>d</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;v&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>Model2</span><span class=p>(</span><span class=o>**</span><span class=n>d</span><span class=p>)</span>


<span class=k>class</span><span class=w> </span><span class=nc>Model2</span><span class=p>(</span><span class=n>Model1</span><span class=p>):</span>
    <span class=n>width</span><span class=p>:</span> <span class=n>conint</span><span class=p>(</span><span class=n>ge</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
    <span class=n>context</span><span class=p>:</span> <span class=n>conint</span><span class=p>(</span><span class=n>ge</span><span class=o>=</span><span class=mi>256</span><span class=p>)</span> <span class=o>=</span> <span class=mi>256</span>
    <span class=c1># v: float = Field(2.0, const=True)</span>
    <span class=n>v</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=mf>2.0</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=mf>2.0</span><span class=p>,</span> <span class=n>const</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>to_next</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>BaseModel</span><span class=p>]:</span>
        <span class=n>next_class</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>next_version</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>next_class</span> <span class=o>!=</span> <span class=n>Model3</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&quot;WTH&quot;</span><span class=p>)</span>

        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;================================================&quot;</span><span class=p>)</span>
        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;==============Migrating from 2-&gt;3 ==============&quot;</span><span class=p>)</span>
        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;================================================&quot;</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>Model3</span><span class=p>(</span>
            <span class=n>new_context</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>context</span><span class=p>,</span>
            <span class=n>num_layers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>num_layers</span><span class=p>,</span>
            <span class=nb>type</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>type</span><span class=p>,</span>
            <span class=n>width</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>width</span><span class=p>,</span>
            <span class=n>zoom</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>zoom</span><span class=p>,</span>
        <span class=p>)</span>

<span class=k>class</span><span class=w> </span><span class=nc>Model3</span><span class=p>(</span><span class=n>Model1</span><span class=p>):</span>
    <span class=n>new_context</span><span class=p>:</span> <span class=n>conint</span><span class=p>(</span><span class=n>ge</span><span class=o>=</span><span class=mi>512</span><span class=p>,</span> <span class=n>le</span><span class=o>=</span><span class=mi>1300</span><span class=p>)</span> <span class=o>=</span> <span class=mi>512</span>
    <span class=n>v</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=mf>3.0</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=mf>3.0</span><span class=p>,</span> <span class=n>const</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>to_next</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>BaseModel</span><span class=p>]:</span>
        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;================================================&quot;</span><span class=p>)</span>
        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;============== Latest no migration =============&quot;</span><span class=p>)</span>
        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;================================================&quot;</span><span class=p>)</span>

        <span class=k>return</span> <span class=kc>None</span>
</code></pre></div> Config templates, as shown <a href="https://github.com/suneeta-mall/hydra_pydantic_config_management/tree/master/pydantic_hydra/conf/model">here</a> are versioned as well. </p> <p>Let's run through various scenarios: 1. A user wants to run a training and uses the latest config, they run <code>python example.py model=resnet_v3</code> 2. A user wants to run a training and uses the latest config but overrides some values, they run <code>python example.py model=resnet_v3 +model.zoom=25</code> 3. A user wants to re-run a training from an old config, they run <code>python example.py</code>. They use the v2 version of config and migration fails because field <code>context</code> require value is greater than or equal to 512 in v3 but used config in v2 template is 256. The user received feedback on what needs to change in config to make it work. 4. the Same user in #3 wants to re-run a training from the old config, they run <code>python example.py model.context=512</code>. They can run and the application performs the migration and the application actually only Model3 version of object config. 5. I want to expose the schema of Model config, how can I do this: <div class=highlight><pre><span></span><code>        _Models = Annotated[Union[Model1, Model2, Model3], Field(discriminator=&quot;v&quot;)]
        _schema = schema_json_of(_Models, title=&quot;Model Schema&quot;, indent=2)
</code></pre></div> This produces the following schema for model config: <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Model Schema&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;discriminator&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;propertyName&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;v&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;mapping&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;1.0&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;#/definitions/Model1&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;2.0&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;#/definitions/Model2&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;3.0&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;#/definitions/Model3&quot;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>},</span>
<span class=w>  </span><span class=nt>&quot;anyOf&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;$ref&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;#/definitions/Model1&quot;</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;$ref&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;#/definitions/Model2&quot;</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;$ref&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;#/definitions/Model3&quot;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>],</span>
<span class=w>  </span><span class=nt>&quot;definitions&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;Model1&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Model&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;object&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;properties&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;v&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;V&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;const&quot;</span><span class=p>:</span><span class=w> </span><span class=mf>1.0</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;enum&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>            </span><span class=mf>1.0</span>
<span class=w>          </span><span class=p>],</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;number&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Type&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;string&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;num_layers&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Num Layers&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;minimum&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>3</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;integer&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;width&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Width&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;minimum&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;integer&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;zoom&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Zoom&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;default&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>19</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;exclusiveMinimum&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>18</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;integer&quot;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>      </span><span class=p>},</span>
<span class=w>      </span><span class=nt>&quot;required&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>        </span><span class=s2>&quot;type&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=s2>&quot;num_layers&quot;</span>
<span class=w>      </span><span class=p>]</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=nt>&quot;Model2&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Model&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;object&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;properties&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;v&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;V&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;const&quot;</span><span class=p>:</span><span class=w> </span><span class=mf>2.0</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;enum&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>            </span><span class=mf>2.0</span>
<span class=w>          </span><span class=p>],</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;number&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Type&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;string&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;num_layers&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Num Layers&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;minimum&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>3</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;integer&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;width&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Width&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;minimum&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;integer&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;zoom&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Zoom&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;default&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>19</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;exclusiveMinimum&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>18</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;integer&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;context&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Context&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;default&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>256</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;minimum&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>256</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;integer&quot;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>      </span><span class=p>},</span>
<span class=w>      </span><span class=nt>&quot;required&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>        </span><span class=s2>&quot;type&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=s2>&quot;num_layers&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=s2>&quot;width&quot;</span>
<span class=w>      </span><span class=p>]</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=nt>&quot;Model3&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Model&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;object&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;properties&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;v&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;V&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;const&quot;</span><span class=p>:</span><span class=w> </span><span class=mf>3.0</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;enum&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>            </span><span class=mf>3.0</span>
<span class=w>          </span><span class=p>],</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;number&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Type&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;string&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;num_layers&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Num Layers&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;minimum&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>3</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;integer&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;width&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Width&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;minimum&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;integer&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;zoom&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Zoom&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;default&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>19</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;exclusiveMinimum&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>18</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;integer&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;new_context&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>          </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;New Context&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;default&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>512</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;minimum&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>512</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;maximum&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>1300</span><span class=p>,</span>
<span class=w>          </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;integer&quot;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>      </span><span class=p>},</span>
<span class=w>      </span><span class=nt>&quot;required&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>        </span><span class=s2>&quot;type&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=s2>&quot;num_layers&quot;</span>
<span class=w>      </span><span class=p>]</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div></p> <h3 id=conclusion><a class=toclink href=../../2023/11/12/hydra-pydantic-config-management/#conclusion>Conclusion</a></h3> <p>It's great to have tools like <a href="https://hydra.cc/">Hydra</a> and <a href="https://pydantic-docs.helpmanual.io/">Pydantic</a> to simplify config management and deal with validations efficiently. It would be even great if <a href="https://hydra.cc/">Hydra</a> integrates nicely with <a href="https://pydantic-docs.helpmanual.io/">Pydantic</a> as well but at least there is a path to using these two tools together. </p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=/resources/me.png alt="Suneeta Mall"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2022-06-09 00:00:00">June 9, 2022</time></li> <li class=md-meta__item> in <a href=./ class=md-meta__link>Machine Learning</a>, <a href=../ai/ class=md-meta__link>AI</a>, <a href=../data-science/ class=md-meta__link>Data-science</a>, <a href=../data/ class=md-meta__link>Data</a>, <a href=../data-centric-ai/ class=md-meta__link>Data-Centric-AI</a></li> <li class=md-meta__item> 17 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=review-and-comparison-of-two-manifold-learning-algorithms-t-sne-and-umap><a href=../../2022/06/09/feature-analysis---t-sne-vs-umap/ class=toclink>Review and comparison of two manifold learning algorithms: t-SNE and UMAP</a></h2> <p>What are manifold learning algorithms? What is t-SNE and UMAP? What are the differences between <a href="https://lvdmaaten.github.io/publications/papers/JMLR_2008.pdf">t-SNE</a> and <a href="https://arxiv.org/abs/1802.03426">UMAP</a>? How can I explore the features of a dataset using <a href="https://lvdmaaten.github.io/publications/papers/JMLR_2008.pdf">t-SNE</a> and <a href="https://arxiv.org/abs/1802.03426">UMAP</a>? These are my notes from my recent exploration into <a href="https://lvdmaaten.github.io/publications/papers/JMLR_2008.pdf">t-SNE</a> and <a href="https://arxiv.org/abs/1802.03426">UMAP</a> and trying to apply them to a multi-label dataset to understand the abilities and limits of these algorithms. </p> <p>This post is broken down into the following sections:</p> <ul> <li><a href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#review-and-comparison-of-two-manifold-learning-algorithms-t-sne-and-umap>Review and comparison of two manifold learning algorithms: t-SNE and UMAP</a></li> <li><a href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#manifold-learning-algorithms-mla>Manifold learning algorithms (MLA)</a></li> <li><a href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#neighbour-graphs>Neighbour graphs</a></li> <li><a href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#t-distributed-stochastic-neighbor-embedding-t-sne>t-Distributed Stochastic Neighbor Embedding (t-SNE)</a></li> <li><a href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#uniform-manifold-approximation-and-projection-umap>Uniform Manifold Approximation and Projection UMAP</a></li> <li><a href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#comparison-table-t-sne-vs-umap>Comparison table: t-SNE vs UMAP</a></li> <li><a href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#exploring-dataset-with-t-sne--umap>Exploring dataset with t-SNE \&amp; UMAP</a></li> <li><a href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#simple-feature-dataset-like-mnist>Simple feature dataset like MNIST</a></li> <li><a href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#more-complex-datasets-like-cifar>More complex datasets like CIFAR</a></li> <li><a href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#what-to-do-when-there-is-noise-in-features>What to do when there is noise in features?</a></li> <li><a href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#how-to-do-this-for-multi-label>how to do this for multi-label</a></li> <li><a href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#can-we-apply-this-to-understand-what-neural-networks-are-doing>Can we apply this to understand what neural networks are doing?</a></li> <li><a href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#conclusion>Conclusion</a></li> </ul> <h3 id=manifold-learning-algorithms-mla><a class=toclink href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#manifold-learning-algorithms-mla>Manifold learning algorithms (MLA)</a></h3> <p>For us humans, high-dimensional data are very difficult to visualize and reason with. That's why we use dimensionality reduction techniques to reduce data dimensions so that the data is easy to work with and reason about. Manifold learning algorithms (MLA) are dimensionality reduction techniques that are sensitive to non-linear structures in data. The non-linearity is what sets manifold learning apart from other popular linear dimensionality reduction techniques like Principal Component Analysis (PCA) or Independent Component Analysis (ICA). Non-linearity allows MLAs to retain complex and interesting properties of data that would otherwise be lost in linear reduction/projection. Because of this property, MLA is a very handy algorithm to analyze data - to reduce data dimensions to 2D or 3D, and visualize and explore them to find patterns in datasets.</p> <p><a href="https://lvdmaaten.github.io/publications/papers/JMLR_2008.pdf">t-SNE</a> (t-Distributed Stochastic Neighbor Embedding) and Uniform Manifold Approximation and Projection <a href="https://arxiv.org/abs/1802.03426">UMAP</a> are the two examples of MLA, that I will cover in this post. I will compare and contrast them and provide a good intuition of how they work and how to choose one over the other.</p> <p>Note that, MLAs are tweaks and generalizations of existing linear dimensionality reduction frameworks themselves. Similar to linear dimensionality reduction techniques, MLAs are predominantly unsupervised even though supervised variants exist. The scope of this post is unsupervised techniques, however.</p> <p>So what does non-linearity buys us? The following shows the difference in reduction using PCA vs t-SNE, as shown in <a href="https://www.youtube.com/watch?v=nq6iPZVUxZU">McInnes</a> excellent talk:</p> <blockquote> <p><img alt src=../../../resources/feature-analysis/PCA_vs_t-SNE_on_MNIST.jpg> Comparison of t-SNE and UMAP on MNIST dataset. (Image from <a href="https://www.youtube.com/watch?v=nq6iPZVUxZU">McInnes</a> talk)</p> </blockquote> <p>As we can see, PCA retains some structure. However, it is very well pronounced in t-SNE, and clusters are more clearly separated. </p> <h3 id=neighbour-graphs><a class=toclink href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#neighbour-graphs>Neighbour graphs</a></h3> <p><a href="https://lvdmaaten.github.io/publications/papers/JMLR_2008.pdf">t-SNE</a> and <a href="https://arxiv.org/abs/1802.03426">UMAP</a> are neighbor graph technique that models data points as nodes, with weighted edges representing the distance between the nodes. Through various optimizations and iterations, this graph and layout are tuned to best represent the data as the distance is derived from the "closeness" of the features of the data itself. This graph is then projected on reduced dimensional space a.k.a. embedded space. This is a very different technique than matrix factorization as employed by PCA, ICA for example.</p> <h3 id=t-distributed-stochastic-neighbor-embedding-t-sne><a class=toclink href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#t-distributed-stochastic-neighbor-embedding-t-sne>t-Distributed Stochastic Neighbor Embedding (t-SNE)</a></h3> <p><a href="https://lvdmaaten.github.io/publications/papers/JMLR_2008.pdf">t-SNE</a> uses Gaussian joint probability measures to estimate the pairwise distances between the data points in the original dimension. Similarly, the student's t-distribution is used to estimate the pairwise distances between the data points in the embedded space (i.e. lower dimension or target dimension). t-SNE then uses the gradient descent technique to minimize the divergence between the two distributions in original and embedded space using the Kullback-Leibler (KL) divergence technique.</p> <p><code>Perplexity</code> in t-SNE is effectively the number of nearest neighbors considered in producing the conditional probability measure. A larger perplexity may obscure small structures in the dataset while small perplexity will result in very localized output ignoring global information. Perplexity must be less than the size of data (number of data points) then; otherwise, we are looking at getting a blobby mass. The recommended range for perplexity lies between 5-50, with a more general rule that the larger the data, the larger the perplexity.</p> <p>Because of the use of KL divergence, t-SNE preserves the local structure in the original space, however, global structure preservation is not guaranteed. Having said that, when initialization with PCA is applied, the global structure is somewhat preserved. </p> <p>Talking more about structures, the scale of distances between points in the embedded space is not uniform in t-SNE as t-SNE uses varying distance scales. That's why it is recommended to explore data under different configurations to tease out patterns in the dataset. Learning rate and number of iterations are two additional parameters that help with refining the descent to reveal structures in the dataset in the embedded space. As highlighted in this great <a href="https://distill.pub/2016/misread-tsne/">distill</a> article on t-SNE, more than one plot may be needed to understand the structures of the dataset.</p> <blockquote> <p><img alt src=../../../resources/feature-analysis/tsne-topo.jpg> Different patterns are revealed under different t-SNE configurations, as shown by <a href="https://distill.pub/2016/misread-tsne/">distill</a> article. (Image from <a href="https://distill.pub/2016/misread-tsne/">distill</a>).</p> </blockquote> <p>t-SNE is known to be very slow with the order of complexity given by O(dN^2) where d is the number of output dimensions and N is the number of samples. Barnes-Hut variation of t-SNE improves the performance [O(dN log N)] however Barnes-Hut can only work with dense datasets and provide at most 3d embedding space. The efficiency gain in Barnes-Hut is coming from changes in gradient calculation which are done with <code>O(n log n)</code> complexity, that uses approximation techniques which leads to about 3% error in nearest neighbor calculation.</p> <p>Because of these performance implications, a common recommendation is to use PCA to reduce the dimension before applying t-SNE. This should be considered very carefully especially if the point of using t-SNE was to explore into non-linearity of the dataset. Pre-processing with linear techniques like PCA will destroy non-linear structures if present.</p> <h3 id=uniform-manifold-approximation-and-projection-umap><a class=toclink href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#uniform-manifold-approximation-and-projection-umap>Uniform Manifold Approximation and Projection <a href="https://arxiv.org/abs/1802.03426">UMAP</a></a></h3> <p><a href="https://arxiv.org/abs/1802.03426">UMAP</a> is based on pure combinatorial mathematics that is well covered in the <a href="https://arxiv.org/abs/1802.03426">paper</a> and is also well explained by author McInnes in his <a href="https://www.youtube.com/watch?v=nq6iPZVUxZU">talk</a> and <a href=umap_doco>library documentation</a> is pretty well written too. Similar to <a href="https://lvdmaaten.github.io/publications/papers/JMLR_2008.pdf">t-SNE</a>, <a href="https://arxiv.org/abs/1802.03426">UMAP</a> is also a topological neighbor graph modeling technique. There are several differences b/w <a href="https://lvdmaaten.github.io/publications/papers/JMLR_2008.pdf">t-SNE</a> and <a href="https://arxiv.org/abs/1802.03426">UMAP</a> with the main one being that UMAP retains not only local but global structure in the data.</p> <p>There is a great post that goes into detail about <a href="https://pair-code.github.io/understanding-umap/index.html">how UMAP works</a>. High level, UMAP uses combinatorial topological modeling with the help of simplices to capture the data and applies Riemannian metrics to enforce the uniformity in the distribution. Fuzzy logic is also applied to the graph to adjust the probability distance if the radius grows. Once the graphs are built then optimization techniques are applied to make the embedded space graph very similar to the original space one. UMAP uses binary cross-entropy as a cost function and stochastic gradient descent to iterate on the graph for embedded space. Both t-SNE and UMAP use the same framework to achieve manifold projections however implementation details vary. <a href="https://towardsdatascience.com/how-exactly-umap-works-13e3040e1668">Oskolkov</a>'s post covers in great detail the nuances of both the techniques and is an excellent read.</p> <p>UMAP is faster for several reasons, mainly, it uses random projection trees and nearest neighbor descent to find approximate neighbors quickly. As shown in the figure below, similar to t-SNE, UMAP also varies the distance density in the embedded space.</p> <blockquote> <p><img alt src=../../../resources/feature-analysis/umap-math.jpg> Manifold reprojection used by UMAP, as presented by <a href="https://www.youtube.com/watch?v=nq6iPZVUxZU">McInnes</a> in his talk. (Image from <a href="https://www.youtube.com/watch?v=nq6iPZVUxZU">McInnes</a> talk)</p> </blockquote> <p>Here's an example of UMAP retaining both local and global structure in embedded space:</p> <blockquote> <p><img alt src=../../../resources/feature-analysis/umap-topo.jpg> Example of UMAP reprojecting a point-cloud mammoth structure on 2-D space. (Image provided by the author, produced using tool <a href="https://pair-code.github.io/understanding-umap/index.html">1</a>)</p> </blockquote> <p>Here's a side-by-side comparison of t-SNE and UMAP on reducing the dimensionality of a mammoth. As shown, UMAP retains the global structure but it's not that well retained by t-SNE. </p> <blockquote> <p><img alt src=../../../resources/feature-analysis/tsne-vs-umap.jpg> Side by side comparison of t-SNE and UMAP projections of the mammoth data used in the previous figure. (Image provided by the author, produced using tool <a href="https://pair-code.github.io/understanding-umap/index.html">1</a>) </p> </blockquote> <p>The explanation for this difference lies in the loss function. As shown in the following figure, UMAP uses binary cross-entropy that penalizes both local (clumps) and global (gaps) structures. In t-SNE however, due to KL Divergence as the choice of the cost function, the focus remains on getting the clumps i.e. local structure right.</p> <blockquote> <p><img alt src=../../../resources/feature-analysis/ce-umap.jpg> Cots function used in UMAP as discussed in <a href="https://www.youtube.com/watch?v=nq6iPZVUxZU">McInnes</a> talk. (Image from <a href="https://www.youtube.com/watch?v=nq6iPZVUxZU">McInnes</a> talk)</p> </blockquote> <p>The first part of the equation is the same in both t-SNE (coming from KL divergence) and UMAP. UMAP only has the second part that contributes to getting the gaps right i.e. getting the global structure right.</p> <h3 id=comparison-table-t-sne-vs-umap><a class=toclink href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#comparison-table-t-sne-vs-umap>Comparison table: t-SNE vs UMAP</a></h3> <table> <thead> <tr> <th>Characteristics</th> <th>t-SNE</th> <th>UMAP</th> </tr> </thead> <tbody> <tr> <td>Computational complexity</td> <td>O(dN^2) <br>(Barnes-Hut with O(dN log N) )</td> <td>O(d*n^1.14) <br>(<a href="https://github.com/lmcinnes/umap/issues/8">emprical-estimates</a> O(dN log N))</td> </tr> <tr> <td>Local structure preservation</td> <td>Y</td> <td>Y</td> </tr> <tr> <td>Global structure preservation</td> <td>N <br>(somewhat when <code>init=PCA</code>)</td> <td>Y</td> </tr> <tr> <td></td> <td></td> <td></td> </tr> <tr> <td>Cost Function</td> <td>KL Divergence</td> <td>Cross Entropy</td> </tr> <tr> <td>Initialization</td> <td>Random <br> (PCA as alternate)</td> <td>Graph Laplacian</td> </tr> <tr> <td>Optimization algorithm</td> <td>Gradient Descent (GD)</td> <td>Stochastic Gradient Descent (SGD)</td> </tr> <tr> <td>Distribution for modelling distance probabilities</td> <td>Student's t-distribution</td> <td>family of curves (1+a*y<sup>(2b))</sup>-1</td> </tr> <tr> <td>Nearest neighbors hyperparameter</td> <td>2^Shannon entropy</td> <td>nearest neighbor k</td> </tr> </tbody> </table> <h2 id=exploring-dataset-with-t-sne-umap><a class=toclink href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#exploring-dataset-with-t-sne-umap>Exploring dataset with t-SNE &amp; UMAP</a></h2> <p>Now that we have covered theoretical differences, let's apply these techniques to a few datasets and do a few side-by-side comparisons between t-SNE and UMAP.</p> <p>Source code and other content used in this exercise are available in this git repository - <a href="https://github.com/suneeta-mall/feature_analysis">feature_analysis</a>. The notebook for MNIST analysis is available <a href="https://github.com/suneeta-mall/feature_analysis/blob/master/docs/MNIST_TSNE_vs_UMAP.ipynb">here</a>. Likewise, the notebook for CIFAR analysis is available <a href="https://github.com/suneeta-mall/feature_analysis/blob/master/docs/CIFAR10_TSNE_vs_UMAP.ipynb">here</a>.</p> <h3 id=simple-feature-dataset-like-mnist><a class=toclink href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#simple-feature-dataset-like-mnist>Simple feature dataset like MNIST</a></h3> <p>The following figure reprojects MNIST image features on the 2D embedded space under different perplexity settings. As shown, increasing the perplexity, makes the local clusters very packed together. In this case, PCA based initialization technique was chosen because I want to retain the global structure as much as possible. </p> <blockquote> <p><img alt src=../../../resources/feature-analysis/mnist_t-sne_dif_perplex.jpg> Reprojection of MNIST image features on the 2D embedded space using t-SNE under different perplexity settings. (Image provided by author)</p> </blockquote> <p>It's quite interesting to see that the digits that are packed close together are: 1. 7,9,4 2. 3,5,8 3. 6 &amp; 0 4. 1 &amp; 2 5. That 6 is more close to 5 than 1 6. Likewise 7 is closer to 1 than 0.</p> <p>At a high level this co-relation makes sense, the features of the digits that are quite similar are more closely packed than digitals that are very different. Its also, interesting to note that 8 and 9 have anomalies that map closely to 0 in rare cases in embedded space. So what's going on? Following image overlays randomly selected images on the clusters produced by t-SNE @ perplexity of 50.</p> <blockquote> <p><img alt src=../../../resources/feature-analysis/mnist_tsne_with_img.jpg> Reprojection of MNIST image features on the 2D embedded space using t-SNE @ perplexity=50 with randomly selected image overlay. (Image provided by author)</p> </blockquote> <p>As we pan around this image, we can see a distinct shift in the characteristics of the digits. For example, the 2 digits at the top are very cursive and have a round little circle at the joint of the two whereas as we travel to the lower part of the cluster of 2s, we can see how sharply written the bottom 2s are. The bottom 2s features are sharp angular joints. Likewise, the top part of the cluster of 1s is quite slanty whereas the bottom 1s are upright. </p> <p>It's quite interesting to see that the 8's occasionally clustered together with 0's are quite round in the middle and do not have the sharp joint in the middle. </p> <p>So, what does MNIST data look like with UMAP? UMAP's embedded space also reflects the same grouping as discussed above. In fact, UMAP and t-SNE clustering in terms of digits grouping are very much alike. It appears to me that UMAP and t-SNE are mirror reflections when it comes to how digits are grouped. </p> <blockquote> <p><img alt src=../../../resources/feature-analysis/umap_mnist.jpg> Reprojection of MNIST image features on the 2D embedded space using UMAP. (Image provided by author)</p> </blockquote> <p>It's also very interesting to note how similar-looking 1s are that are reprojected to the same coordinates in the embedded space.</p> <blockquote> <p><img alt src=../../../resources/feature-analysis/ones_umap.jpg> One example of samples that get reprojected to the same coordinates in the embedded space using UMAP. (Image provided by author)</p> </blockquote> <p>Not all the data points that collide in embedded space will look exactly similar, the similarity is more in the reduced dimensional space. One such example is shown below. Here 1 and 0 are reprojected to the same coordinates. As we can see the strokes on the left side of 0 are very similar to strokes of 1. The circle of zero is not quite complete either. </p> <blockquote> <p><img alt src=../../../resources/feature-analysis/one-vs-zero.jpg> One example of two different digits getting reprojected to the same coordinates in the embedded space using UMAP. (Image provided by author)</p> </blockquote> <p>Here's also an example of samples falling into the same neighborhood in the embedded space that look quite distinct despite sharing some commonality (the strokes around the mouth of 4 and incomplete 8s)! </p> <blockquote> <p><img alt src=../../../resources/feature-analysis/umap_odd_case.jpg> Example of 4 and 8s reprojected to the nearby coordinates in the embedded space using UMAP. (Image provided by author)</p> </blockquote> <p>Its unpredictable what tangible features have been leveraged to calculate the similarities amongst data points in the embedded space. This is because the main focus of MLAs has been distance measures and the embedded space is derived based on best effort using unsupervised techniques with evident data loss (due to dimensionality reduction). </p> <p>This was MNIST, where digits are captured with empty backgrounds. These are very easy cases because all the signals in the feature vectors are true signals that correspond to the digit as its drawn. When we start talking about visualizing data where there are noises in the signals then that case poses certain challenges. For example, taking the case of <a href="https://www.cs.toronto.edu/~kriz/cifar.html">cifar</a> dataset, the images of things are captured with a varying background as they are all-natural images unlike MNIST with a black background. In the following section, let's have a look at what happens when we apply t-SNE and UMA to the CIFAR dataset.</p> <blockquote> <p><img alt src=../../../resources/feature-analysis/CIFAR10-vs-MNIST.jpg> High-level differences between <a href="https://www.cs.toronto.edu/~kriz/cifar.html">cifar</a> and MNIST dataset. (Image provided by author)</p> </blockquote> <h3 id=more-complex-datasets-like-cifar><a class=toclink href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#more-complex-datasets-like-cifar>More complex datasets like CIFAR</a></h3> <p>The following figure shows the resultant embedding of CIFAR images after applying UMAP. As shown below results are less than impressive to delineate amongst CIFAR classes or perform any sort of features analysis. </p> <blockquote> <p><img alt src=../../../resources/feature-analysis/cifar-10-tsne.jpg> Results of CIFAR image feature visualization using t-SNE under different perplexity settings. (Image provided by author)</p> </blockquote> <p>So, what's going on? Let's overlay the images and see if we can find some patterns and make sense of the one big lump we are seeing. The following figure overlays the image. It's really hard to find a consistent similarity between neighboring points. Often we see cars and vehicles nearby but not consistently. They are intermixed with flowers and other classes. It's simply too much noise in the feature vector to do any meaningful convergence. </p> <blockquote> <p><img alt src=../../../resources/feature-analysis/cifar-10-t-sne-with-images.jpg> Results of CIFAR image feature visualization using t-SNE. Shows images in an overlay on randomly selected points. (Image provided by author)</p> </blockquote> <p>In the above two figures, we looked at analyzing CIFAR with t-SNE. The following plot is produced by using UMAP. As we can see it's not convincing either. Much like t-SNE, UMAP is also providing one big lump and no meaningful insights. </p> <blockquote> <p><img alt src=../../../resources/feature-analysis/cifar-umap.jpg> Results of CIFAR image feature visualization using UMAP. (Image provided by author)</p> </blockquote> <p>Following show images of 2 cats that are projected to the same location in embedded space. There is some similarity between the two images like nose, and sharp ears obviously but also the two images have varying distinct features.</p> <blockquote> <p><img alt src=../../../resources/feature-analysis/cifar-umap-collison.jpg> Results of CIFAR image feature visualization using UMAP showing samples of cats that are reprojected into the same located in the embedded space. (Image provided by author)</p> </blockquote> <p>Likewise, if we look at the following figure where deer and frog are co-located in embedded space, we can see the image texture is very similar. This texture however is the result of normalization and grayscale conversion. As we can see, a lot goes on in nature scenes and without a clear understanding of which features to focus on, one's features can be other's noise. </p> <blockquote> <p><img alt src=../../../resources/feature-analysis/umap_frog_deer.jpg> Results of CIFAR image feature visualization using UMAP. Shows images in an overlay on randomly selected points. (Image provided by author)</p> </blockquote> <p>t-SNE and UMAP are feature visualization techniques and perform best when the data vector represents the feature sans noise. </p> <h3 id=what-to-do-when-there-is-noise-in-features><a class=toclink href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#what-to-do-when-there-is-noise-in-features>What to do when there is noise in features?</a></h3> <p>So, what can we do if there are noises in our feature vectors? We can apply techniques that reduce noises from feature vectors before applying manifold learning algorithms. Given the emphasis on nonlinearity in both t-SNE and UMAP (to preserve nonlinear features), it is better to choose a noise reduction technique that is nonlinear. </p> <p><a href="https://www.deeplearningbook.org/contents/autoencoders.html">Autoencoder</a> is a class of unsupervised deep learning techniques that learns the latent representation of the input dataset eliminating noises. Autoencoder can be non-linear depending on the choices of layers in the network. For example, using a convolution layer will allow for non-linearity. If noises are present in the feature vector then an autoencoder can be applied to learn latent features of a dataset and to transform samples to noise-free samples before applying manifold algorithms. <a href="https://arxiv.org/abs/1802.03426">UMAP</a> has native integration with Tensorflow for similar use cases that is surfaced as <a href="https://umap-learn.readthedocs.io/en/latest/parametric_umap.html">parametric UMAP</a>. Why parametric because autoencoders/neural networks are parametric! i.e. increasing data size will not increase parameters - the parameters may be large but will be fixed and limited. This approach of transforming input feature vectors to the latest representation not only helps with noise reduction but also with complex and very high dimensional feature vectors. </p> <p>The following figure shows the results of applying autoencoder before performing manifold algorithm t-SNE and UMAP for feature visualization. As we can see in the result, the clumps are much more compact and the gaps are wider. The proximity of MNIST classes remains unchanged, however - which is very nice to see.</p> <blockquote> <p><img alt src=../../../resources/feature-analysis/umap_tsne-parametric_umap.jpg> Results of applying autoencoder on MNIST before applying manifold algorithm t-SNE and UMAP. (Image provided by author)</p> </blockquote> <p>So how does it affects the features that contribute to proximities/neighborhood of data? The manifold algorithm is still the same however it's now applying on latent feature vector as produced by autoencoders and not raw features. So effectively, the proximity factor is now calculated on latent representation and not directly on perceptible features. Given the digit clusters are still holding global structure and it's just more packed together within the classes, we can get the sense that it's doing the right things if intra-class clumps can be explained. Let's look at some examples. The following shows a reprojection in the embedded space where 4,9 and 1 are clustered together into larger clusters of 1s. If we look closely the backbone of all these numbers is slanting at about 45 degrees and perhaps that has been the main driving factor. The protruding belly of 4 and 9 are largely ignored but also they are not very prominent. </p> <blockquote> <p><img alt src=../../../resources/feature-analysis/MNIST-Parametric-UMAP.jpg> Example of co-located 1s, 4 &amp; 9 in embedded space obtained by applying Paramertic UMAP on MNIST. (Image provided by author)</p> </blockquote> <p>More importantly, looking at the dataset (in the following figure), there are not as many 9s or 4s that have a backbone at that steep slant of 45 degrees. This is more easily shown in the full-scale overlay in the following figure (sparsely chosen images to show to make it more comprehensible). We can see all samples are upright 4s and 9s where there is a slant the protrusion is more prominent. Anyhow, we don't need to get overboard with this as manifold algorithms are not feature detection algorithms and certainly can't be compared to the likes of more powerful feature extraction techniques like convolution. The goal with manifold is to find global and local structures in the dataset. These algorithms work best if signals in datasets are noise-free where noise includes features/characteristics we want ignored in the analysis. A rich natural background is a very good case of noise as shown already in the CIFAR case.</p> <blockquote> <p><img alt src=../../../resources/feature-analysis/overlay_on_t-SNE_parametric.jpg> Images overlaid on t-SNE of auto-encoded features derived from MNIST dataset. (Image provided by author)</p> </blockquote> <h3 id=how-to-do-this-for-multi-label><a class=toclink href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#how-to-do-this-for-multi-label>how to do this for multi-label</a></h3> <p>In the early day of learning about this, I found myself wondering how would we do the feature analysis on a multi-label dataset? Multi-class is certainly the easy case - each sample only needs to be color-coded for one class so is easy to visualize. We are also expecting class-specific data to be clumped together mostly (perhaps not always and depends on intent but may be more commonly).</p> <p>If multi-label data consists of exclusive classes similar to <a href="https://ai.stanford.edu/~jkrause/cars/car_dataset.html">Satnford Cars Dataset</a> where options within the make and the models of cars are mutually exclusive, then splitting the visualization to the group of exclusive cases could be very helpful. </p> <p>However, if the multi-label dataset is more alike <a href="https://paperswithcode.com/dataset/mlrsnet">MLRSNet</a> where classes are independent then it's best to first analyze the data class agnostic and explore if there are any patterns in features and proceed based on this.</p> <h2 id=can-we-apply-this-to-understand-what-neural-networks-are-doing><a class=toclink href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#can-we-apply-this-to-understand-what-neural-networks-are-doing>Can we apply this to understand what neural networks are doing?</a></h2> <p>A lot of work has been done in the area of explainability and feature understanding that is very well documented in <a href="https://distill.pub/2019/activation-atlas/">distill</a> blogs. The underlined idea is that we can take the activation of the layers of the neural network and explore what features it is that that particular layer is paying attention to. The activations are essentially the signal that is fired for a given input to the layer. These signals then formulate the feature vector for further analysis to understand where and what the layer is paying more attention to. T-SNE and UMAP are heavily used in these analyses. </p> <p>The <a href="https://distill.pub/2019/activation-atlas/">distill</a> blogs are very well documented and highly recommended for reading if this is something that is of interest to you.</p> <h3 id=conclusion><a class=toclink href=../../2022/06/09/feature-analysis---t-sne-vs-umap/#conclusion>Conclusion</a></h3> <p>This post was focused on the fundamentals of manifold learning algorithms, and diving into the details of t-SNE and UMAP. This post also compared and contrasted t-SNE and UMAP and presented some analysis of MNIST and CIFAR datasets. We also covered what to do if we have a very high dimensional dataset and also if we have noises in the dataset. Lastly, we touched on what to do if your dataset is multi-label. </p> <p>In the follow-up, I will cover how we can utilize t-SNE and UMAP to better understand what neural networks are doing and apply it in conjunction with convolutions as feature extractors. </p> <p>[umap_doco] https://umap-learn.readthedocs.io/en/latest/how_umap_works.html</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=/resources/me.png alt="Suneeta Mall"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2022-05-16 00:00:00">May 16, 2022</time></li> <li class=md-meta__item> in <a href=./ class=md-meta__link>Machine Learning</a>, <a href=../ai/ class=md-meta__link>AI</a>, <a href=../deep-learning/ class=md-meta__link>Deep Learning</a>, <a href=../data/ class=md-meta__link>Data</a>, <a href=../data-centric-ai/ class=md-meta__link>Data-Centric-AI</a></li> <li class=md-meta__item> 16 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=confident-learning-label-errors-are-imperative-so-what-can-you-do><a href=../../2022/05/16/confident-learning-and-clean-data/ class=toclink>Confident Learning: Label errors are imperative! So what can you do?</a></h2> <p>What makes deep-learning so great, despite what you may have heard, is data! There is an old saying, that sums it up pretty well:</p> <blockquote> <p>The model is only as good as the <span style=color:red>data</span>! <br></p> </blockquote> <p>Which brings us to the real question, exactly how good is your data? Collecting ground truth/training datasets is incredibly expensive, laborious, and time-consuming. The process of labeling involves searching for the object of interest and applying prior knowledge and heuristics to come to a final decision. A decision to represent if the object (of interest) is present and if so, annotate it to provide extra information like bounding box, and segmentation mask. </p> <p>There are several factors at play in this process that leads to error in the dataset. The question is what can we do about it? In this post, I will touch on some of the reasons why labeling error occurs, why the errors in labels are imperative, and what are the tools and techniques one can use to manage errors in the label datasets. Then, I will dive into the detail of <a href="https://arxiv.org/abs/1911.00068">confident learning</a>. I will also demonstrate the use of <a href="https://github.com/cleanlab/cleanlab">cleanlab</a>, a <a href="https://arxiv.org/abs/1911.00068">confident learning</a> implementation [1], to easily find noise in the data.</p> <p><strong>Disclaimer</strong>: Before diving into the details, I would like to acknowledge that, at the time of writing this post, I am not affiliated with or sponsored by <a href="https://github.com/cleanlab/cleanlab">cleanlab</a> in any capacity.</p> <p>This post is broken down into the following sections:</p> <ul> <li><a href=../../2022/05/16/confident-learning-and-clean-data/#confident-learning-label-errors-are-imperative-so-what-can-you-do>Confident Learning: Label errors are imperative! So what can you do?</a></li> <li><a href=../../2022/05/16/confident-learning-and-clean-data/#reasons-for-labeling-errors>Reasons for labeling errors</a></li> <li><a href=../../2022/05/16/confident-learning-and-clean-data/#labeling-efficiency-tricks-that-increase-the-risk-of-labeling-errors>Labeling efficiency tricks that increase the risk of labeling errors</a></li> <li><a href=../../2022/05/16/confident-learning-and-clean-data/#errors-in-labels-are-imperative>Errors in labels are imperative</a></li> <li><a href=../../2022/05/16/confident-learning-and-clean-data/#exactly-what-is-confident-learning>Exactly, what is Confident learning?</a><ul> <li><a href=../../2022/05/16/confident-learning-and-clean-data/#fundamentals>Fundamentals</a></li> <li><a href=../../2022/05/16/confident-learning-and-clean-data/#limitations-of-cl>Limitations of CL</a></li> </ul> </li> <li><a href=../../2022/05/16/confident-learning-and-clean-data/#hands-on-of-label-noise-analysis-using-cleanlab-for-multi-label-classification>Hands on of label noise analysis using cleanlab for multi-label classification</a><ul> <li><a href=../../2022/05/16/confident-learning-and-clean-data/#model-info>Model info</a></li> <li><a href=../../2022/05/16/confident-learning-and-clean-data/#exploration-in-noise-using-cleanlab>Exploration in noise using cleanlab</a></li> </ul> </li> <li><a href=../../2022/05/16/confident-learning-and-clean-data/#conclusion>Conclusion</a></li> <li><a href=../../2022/05/16/confident-learning-and-clean-data/#references>References</a></li> </ul> <h3 id=reasons-for-labeling-errors><a class=toclink href=../../2022/05/16/confident-learning-and-clean-data/#reasons-for-labeling-errors>Reasons for labeling errors</a></h3> <p>Let's first look at some of the reasons why errors in the labels may be present. One broad class for such errors is tooling/software bugs. These can be controlled and managed using good software best practices like tests covering both software and the data. The other class of errors is the one where the mistakes are coming from the labelers themselves. These are incredibly harder issues to track. Because labelers are the oracle in this process of deep learning after all! If we don't trust them, then who do we trust?</p> <p>There is a very interesting work by <a href="https://www.researchgate.net/publication/225041737_Automated_detection_of_heuristics_and_biases_among_pathologists_in_a_computer-based_system">Rebecca Crowley</a> where she provides a detailed chart of a range of reasons why an object (of interest) may be missed while searching in a scene or also why a wrong final decision may be made by them [4]. Some directly impacting labeling in my view are:</p> <ol> <li><strong>Search Satisficing</strong>: The tendency to call off a search once something has been found, leading to premature stopping, thus increasing the chance of missing annotations[4]. This more applies to scenarios where more than one annotation is needed. For example, multi-label or segmentation annotation (dog and pen are in the image but the labeler only annotates for the dog and does not spend enough time to spot the pen and capture in labels).</li> <li><strong>Overconfidence &amp; Under-confidence</strong>: This type of labeling error relates to one's feeling-of-knowing [4] that is over or underestimated.</li> <li><strong>Availability</strong>: There is an implicit bias in annotating it wrongly if something is frequently occurring or rarely occurring [4]. It is particularly true for challenging labeling tasks. For instance, if the cancer prevalence rate in a location is 0.01%, then the labeler, when labeling a not-so-straightforward case, is more likely to mark a non-cancer than cancer.</li> <li><strong>Anchoring/Confirmation bias</strong>: When a labeler makes a pre-emptive decision [4] about a labeling task outcome and then looks for information to support that decision. For example, believing they are looking at a cancerous case, they start to search for abnormality in the image to support the finding that this case is cancer. In this unfair search/decision process, they are more likely to make mistakes.</li> <li><strong>Gambler's Fallacy</strong>: When they are encountered with a repeated pattern of similar cases, then they are likely to deviate and favor an outcome that breaks that pattern [4].</li> <li>Amongst all these, <strong>Cognitive Overload</strong> is also a valid and fair reason for errors in labels.</li> </ol> <h3 id=labeling-efficiency-tricks-that-increase-the-risk-of-labeling-errors><a class=toclink href=../../2022/05/16/confident-learning-and-clean-data/#labeling-efficiency-tricks-that-increase-the-risk-of-labeling-errors>Labeling efficiency tricks that increase the risk of labeling errors</a></h3> <p>Given the process to procure a labeling dataset is expensive, some clever tricks and techniques are occasionally applied to optimize the labeling funnel. While some focus on optimization through labeling experience such as <a href="https://arxiv.org/abs/1903.06874">Fast Interactive Object Annotation</a><sup>[5]</sup>, other techniques focus on using auto-labeling techniques to reduce the labeling burden a bit to aid the labelers. Tesla has a very powerful mechanism to realize auto-labeling at scale as talked about in the <a href="https://www.youtube.com/watch?v=a510m7s_SVI">2021 CVPR by Karpathy</a>. They sure have the advantage of having feedback (not just the event that's worth labeling but also what did the driver do or if that led to a mishap). It's an advantage that not all deep-learning practicing organizations have! Impressive nonetheless! Then we also have the weakly supervised class of training regimes that I won't go into detail about (perhaps a topic for another day)!</p> <p>The thing is, the cleverer tricks you employ to optimize this process, the higher the chances of error in your dataset. For instance, using the model in the loop for labeling is being increasingly used to optimize the labeling process (<a href="https://suneeta-mall.github.io/talks/She_Builds_on_AWS_2020.html">as detailed in this presentation</a>), as an auto-labeling/pre-label trick, wherein predicted labels are shown to the labelers and the labeler only fine-tunes the annotation instead of annotating from the get-go. This process has two main challenges:</p> <p>a) It may introduce a whole gamut of bias in labels <a href="../../2022/05/16/confident-learning-and-clean-data/# reasons-for-labeling-errors">as discussed above in (Reasons for labeling errors</a>.</p> <p>b) If the model is not on par with human labelers, the labor, and boredom of correcting a garbage prior label increase the risk of errors in the dataset. This is a classic case of cognitive overload.</p> <p>If this example was not enough, let's take a case of auto labeling <a href="https://suneeta-mall.github.io/talks/KGC_NY_2022.html">using ontology/knowledge graph</a>. Here, the risk of error propagation is too high if the knowledge encoded in the ontology/knowledge graph is biased. For example, if it's an ocean water body it cants be a swimming pool. Because well, contrary to common knowledge ocean pools do exist. Or if it's a house it's not a waterbody - because you know lake houses do exist!</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/cleanlab/47f76ecac3e3bcc2b5b21e30ea10d336.jpeg> <span style=text-align:center;>Ocean Pool/Rock Pool @Mona Vale NSW AU (Image is taken from the internet! @credit: unknown)</span></p> </blockquote> <h3 id=errors-in-labels-are-imperative><a class=toclink href=../../2022/05/16/confident-learning-and-clean-data/#errors-in-labels-are-imperative>Errors in labels are imperative</a></h3> <p>Given the challenges discussed so far, It is fair to say that errors are imperative. The oracle in this process are labelers and they are only just human!</p> <blockquote> <p>I am <span style=color:red>not perfect</span>; I am only <span style=color:red>human</span></p> </blockquote> <p>Evidently, there is <em>an estimated average of at least 3.3% errors across the 10 popular datasets, where for example label errors comprise at least 6% of the ImageNet validation set</em> <sup><a href="https://arxiv.org/abs/2103.14749">2</a></sup>.</p> <p>Assuming, human labelers will produce a perfectly clean dataset is, well, overreaching to say the least. If one cares, one can employ multiple labelers to reduce the error by removing the noise through consensus. This is a great technique to produce a high-quality dataset but it's also many times more expensive and slow thus impractical as standard modus-operandi. Besides being expensive, this does not guarantee a clean dataset either. This is evident from <a href="https://arxiv.org/abs/2103.14749">Northcutt's NeurIPS 2021</a><sup>[2]</sup> work on analyzing errors in the test set of popular datasets that reported order of hundred samples across popular datasets where an agreement could not be reached on true ground truth despite looking at collating outcomes from labelers (see table 2 in the paper for reference).</p> <p>For the last few years, I have been using model-in-loop to find samples where there are disagreements in the dataset with the models. Some of the other techniques that I have found useful are leveraging loss functions, as called out by Andrej Karpathy! More recently, I have seen a huge benefit of deploying <a href="https://suneeta-mall.github.io/talks/KGC_NY_2022.html">ontology-based violations</a> to find samples that are either a) labeling errors or b) extreme edge cases that we were not aware of (aka out of distribution [OOD] samples). </p> <blockquote class=twitter-tweet><p dir=ltr>When you sort your dataset descending by loss you are guaranteed to find something unexpected, strange and helpful.</p>&mdash; Andrej Karpathy (@karpathy) <a href="https://twitter.com/karpathy/status/1311884485676294151?ref_src=twsrc%5Etfw">October 2, 2020</a></blockquote> <script async= src="../../../assets/external/platform.twitter.com/widgets.js" charset="utf-8"></script> <p><br></p> <p>However, I realized I have been living in oblivion when I came across project <a href="https://github.com/cleanlab/cleanlab">cleanlab</a> from <a href="https://twitter.com/cgnorthcutt">Northcutt</a>'s group and started digging in a bunch of literature around this exact space! I was excited to uncover all the literature that proposed the tricks and tips I have been using to date without being aware of them. Well no more!! In the following sections, I will cover what I have learned reading through this literature.</p> <h3 id=exactly-what-is-confident-learning><a class=toclink href=../../2022/05/16/confident-learning-and-clean-data/#exactly-what-is-confident-learning>Exactly, what is Confident learning?</a></h3> <blockquote> <p>All models are wrong, but some are <span style=color:red>useful</span>!</p> </blockquote> <p><a href="https://arxiv.org/abs/1911.00068">Confident learning</a><sup>[1]</sup> (CL) is all about using all the useful information we have at hand to find noise in the dataset and improve the quality of the dataset. It's about using one oracle (the labelers) and testing it using another oracle in the build i.e. the model! At a very high level, this is exactly what we have been more generally calling model-in-the-loop!</p> <blockquote> <p>Learning exists in the context of data, yet notions of confidence typically focus on model predictions, not label quality!<sup><a href="https://arxiv.org/abs/1911.00068">1</a></sup></p> </blockquote> <p><a href="https://arxiv.org/abs/1911.00068">Confident learning</a> (CL) is a class of learning where the focus is to learn well despite some noise in the dataset. This is achieved by accurately and directly characterizing the uncertainty of label noise in the data. The foundation CL depends on is that <code>Label noise is class-conditional, depending only on the latent true class, not the data</code> <sup><a href="https://arxiv.org/abs/1911.00068">1</a></sup>. For instance, a <code>leopard</code> is likely to be mistakenly labeled as a <code>jaguar</code>. This is a very strong argument and in practice untrue. I can argue that the scene (ie the data) has implications for the labeler's decisions. For instance, a dingy sailing in water is less likely to be labeled as a car if it's in water. In other words, would not a dingy being transported in a lorry is more likely to be labeled as a car than when it was sailing on the water? so data and context do matters! <br> This assumption is a classic case of, <code>in statistics any assumption is fair if you can solve for x!</code>. Now that we have taken a dig at this, it's fair to say that this assumption is somewhat true even if not entirely. </p> <p>Another assumption CL makes is that rate of error in the dataset is &lt; &frac12;. This is a fair assumption and is coming from <a href="http://homepages.math.uic.edu/~lreyzin/papers/angluin88b.pdf">Angluin &amp; Laird</a>'s<sup>[3]</sup> proposed method for the class conditional noise process which is used in CL to calculate the joint distribution of noisy and true labels.</p> <p>In <a href="https://arxiv.org/abs/1911.00068">Confident learning</a>, a reasonably well performant model is used to estimate the errors in the dataset. First, the model's prediction is obtained then, using a class-specific threshold setting confident joint distribution matrix is obtained; which is then normalized to obtain an estimation of the error matrix. This estimated error matrix then builds the foundation for dataset pruning, counting, and ranking samples in the dataset.</p> <blockquote> <p>Estimating the joint distribution is challenging as it requires disambiguation of epistemic uncertainty (model-predicted probabilities) from aleatoric uncertainty (noisy labels) but useful because its marginals yield important statistics used in the literature, including latent noise transition rates latent prior of uncorrupted labels, and inverse noise rates. <sup><a href="https://arxiv.org/abs/1911.00068">1</a></sup>.</p> <p><img alt src=../../../resources/data-centric-ai/cleanlab/cl.jpg> <a href="https://arxiv.org/abs/1911.00068">Confident learning</a> in pictures<sup><a href="https://arxiv.org/abs/1911.00068">1</a></sup>.</p> </blockquote> <p>The role of a class-specific threshold is useful to handle variations in model performance for each class. This technique is also helpful to handle collisions in predicted labels. </p> <p>What's great about <a href="https://arxiv.org/abs/1911.00068">Confident learning</a> and <a href="https://github.com/cleanlab/cleanlab">cleanlab</a> (its python implementation of it) is that while it does not propose any groundbreaking algorithm, it has done something that is rarely done. Bring together antecedent works into a very good technical framework that is so powerful that it rightfully questions major datasets that shape the evolution of deep learning. Their work on the <a href="https://arxiv.org/abs/2103.14749">analysis</a> of 10 popular datasets including MNIST is well appreciated. This is also a reminder that we are massively overfitting the entire deep learning landscape to datasets like MNIST, and ImageNet, as they are pretty much, must use the dataset to benchmark and qualify bigger and better algorithms and that, they have at least 3.3% errors if not 20% (as estimated by <a href="https://arxiv.org/abs/2103.14749">Northcutt's group</a>)!</p> <p>This approach was used in side by side comparison where samples were pruned either randomly (shown in orange in below fig) or more strategically via CL to remove noisy samples only (shown in blue below fig). The accuracy results as shown below. CL is doing better than random prune!</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/cleanlab/cl_result.jpg> Borrowed from <a href="https://arxiv.org/abs/1911.00068">Confident learning</a><sup><a href="https://arxiv.org/abs/1911.00068">1</a></sup></p> </blockquote> <p>Following are an example of some of the samples that CL flags as noisy/erroneous, also including the edge cases where a) neither were true and b) Its either the CL suggestion or provided label but unclear which of the two are correct (non-agreement):</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/cleanlab/cl_results_image.jpg> Examples of samples corrected using <a href="https://arxiv.org/abs/2103.14749">Confident learning</a><sup><a href="https://arxiv.org/abs/2103.14749">2</a></sup>.</p> </blockquote> <p>CL is not 100% accurate. At the best, it is an effort to estimate noise using an epistemic uncertainty predictor [the model]. Having said that these examples it fails on are quite challenging as well. </p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/cleanlab/fail_cl.jpg> Examples of samples <a href="https://arxiv.org/abs/2103.14749">Confident learning</a> struggled with!<sup><a href="https://arxiv.org/abs/2103.14749">2</a></sup></p> </blockquote> <h4 id=fundamentals><a class=toclink href=../../2022/05/16/confident-learning-and-clean-data/#fundamentals>Fundamentals</a></h4> <p>Let's look at the fundamentals CL builds on and dig in a bit on the antecedent and related works that formulate the foundation upon which <a href="https://arxiv.org/abs/1911.00068">Confident learning</a>(<a href="https://github.com/cleanlab/cleanlab">cleanlab</a>) is built!</p> <ol> <li> <p>As discussed above already, is class conditional noise proposed by <a href="http://homepages.math.uic.edu/~lreyzin/papers/angluin88b.pdf">Angluin &amp; Laird</a> is the main concept utilized by CL. </p> </li> <li> <p>The use of weighted loss functions to estimate the probability of misclassification, as used in <sup><a href="https://proceedings.neurips.cc/paper/2013/file/3871bd64012152bfb53fdf04b401193f-Paper.pdf">7</a></sup>, is quite relevant to the field of CL, although it's not directly used in the CL technique as proposed by the <a href="https://arxiv.org/abs/1911.00068">Confident learning</a> framework paper. </p> </li> <li> <p>Use of iterative noise cross-validation [INCV] techniques, as proposed in Chen <em>et.</em> al<sup>[8]</sup>, that utilize a model-in-the-loop approach to finding noisy samples. This algorithm is shown below:</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/cleanlab/INCV.jpg> <a href="https://arxiv.org/abs/1905.05040">Chen</a>'s INCV algorithm</p> </blockquote> </li> <li> <p>CL does not directly use <a href="https://arxiv.org/abs/1712.05055">MentorNet</a><sup>[6]</sup>. However, it is very relatable work that builds on a data-driven training approach. In simplistic terms, there is a teacher network that builds a curriculum of easy to hard samples (derived using loss measures) and the student is trained off this curriculum.</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/cleanlab/M-Net.jpg> <a href="https://arxiv.org/abs/1712.05055">MentorNet</a> architecture</p> </blockquote> </li> <li> <p>There are other variations to data-driven teaching, one noticeable example is <a href="https://arxiv.org/abs/1804.06872">Co-teaching</a><sup>[9]</sup> which looks to be teaching each other in pairs and passing the non-noisy samples (calculated based on loss measures) to each other during learning. The main issue <a href="https://arxiv.org/abs/1804.06872">Co-teaching</a> tries to solve is the memorization effects that are present in <a href="https://arxiv.org/abs/1712.05055">MentorNet</a><sup>[6]</sup>. (aka M-Net] but not in <a href="https://arxiv.org/abs/1804.06872">Co-teaching</a><sup>[9]</sup> due to data share.</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/cleanlab/m-d-co-teach.jpg> <a href="https://arxiv.org/abs/1804.06872">Co-teaching</a> approach in contrast with <a href="https://arxiv.org/abs/1712.05055">MentorNet</a> aka M-Net</p> </blockquote> </li> <li> <p>The understanding that small losses are a good indicator of useful samples and highly likely correct samples whereas jumpy, high loss producing samples are, well, interesting! They can be extreme edge cases or out-of-distribution samples or also can indicate wrongness. This only holds for reasonably performant models with abilities at least better than random chance if not more!</p> </li> </ol> <h4 id=limitations-of-cl><a class=toclink href=../../2022/05/16/confident-learning-and-clean-data/#limitations-of-cl>Limitations of CL</a></h4> <p>One thing that CL entirely ignores about label errors is when one or more true label is entirely missed. This is more likely to happen in multi-label settings and even more complex labeling setting like segmentation or detection than in multi-class classifications. For example, if there is a TV and water bottle in an image and the only annotation present is for the TV, and the water bottle is missed entirely! This is currently not modeled in CL as relies on building a pairwise class-conditional distribution between the given label and the true label. If the given label was a cat but the actual label was the dog for example. The framework itself does not allow it to model for the missing label when a true label is present. </p> <p>Pairwise class-conditional distribution as proposed in CL also limits its use in multi-label settings. Explicitly when multiple labels can co-exist on the same data. For example, both the roof and swimming pool can be present in the image and they are not necessarily exclusive. This limitation comes from pairwise (single class gives vs single class predicted) modeling. This is different from say <a href="http://ai.stanford.edu/~jkrause/cars/car_dataset.html">Stanford Car Dataset</a> where make and model are predicted as multiple labels but they are exclusive ie a vehicle can be ute or hatchback but that is exclusive to it being made by Toyota or Volvo. Exclusivity in this case allows for modeling Pairwise class-conditional distribution. These are more multi-label multi-class modeled using multi-headed networks. True multi-label datasets can't be modeled like these pairwise joint distributions. They can perhaps be modeled using more complex joint distribution formulations but that would not scale very well. <a href="https://arxiv.org/abs/1911.00068">Confident learning</a><sup>[1]</sup> as it stands currently is a computationally expensive algorithm with an order of complexity being O(m2 + nm). </p> <p>Having said these, it is probably something that is not explained in the literature as it seems that <a href="https://github.com/cleanlab/cleanlab">cleanlab</a> itself supports multi-label classification. Conceptually I am unclear how multi-label works given the said theory. The support for multi-label is developing as issues are being addressed on this tool <a href="https://github.com/cleanlab/cleanlab/issues/263">1</a>,<a href="https://github.com/cleanlab/cleanlab/issues/55">2</a>.</p> <h3 id=hands-on-of-label-noise-analysis-using-cleanlab-for-multi-label-classification><a class=toclink href=../../2022/05/16/confident-learning-and-clean-data/#hands-on-of-label-noise-analysis-using-cleanlab-for-multi-label-classification>Hands on of label noise analysis using cleanlab for multi-label classification</a></h3> <p>Now that we have covered the background and theoretical foundations, let's try the <a href="https://arxiv.org/abs/1911.00068">confident learning</a> out in detecting label noise using its implementation <a href="https://github.com/cleanlab/cleanlab">cleanlab</a>. Specifically, I will use multi-label classification given the uncertainty around it (as discussed above)!. For this hands-on, I will use <a href="https://paperswithcode.com/dataset/mlrsnet">MLRSNet</a> dataset. This spike is built using ResNet as a multi-label image classifier predicting 6 classes that can co-exist at the same time. These classes are <code>['airplane', 'airport', 'buildings', 'cars', 'runway', 'trees']</code> and derived off <a href="https://paperswithcode.com/dataset/mlrsnet">MLRSNet</a> subset - i.e. only using <code>airplane</code> and <code>airport</code>.</p> <p>The source code and <a href="https://github.com/suneeta-mall/label_noise/blob/master/label_noise_notebook.ipynb">this notebook</a> for this project is <a href="https://github.com/suneeta-mall/label-noise">label-noise</a> Github repository. <a href="https://github.com/suneeta-mall/label_noise/blob/master/label_noise_notebook.ipynb">The notebook</a> checks how well <a href="https://github.com/cleanlab/cleanlab">cleanlab</a> performs in detecting label noise and identifies out-of-distribution samples, weird samples, and also errors!</p> <h4 id=model-info><a class=toclink href=../../2022/05/16/confident-learning-and-clean-data/#model-info>Model info</a></h4> <p>Train and validation loss from the model trained using <a href="https://github.com/suneeta-mall/label-noise">label-noise</a> for 19 epochs. Note, for this spike, I opted out of n-fold cross-validation (CV). Using CV can lead to better results but its a not quick.</p> <p><img alt src=../../../resources/data-centric-ai/cleanlab/model_measures.jpg></p> <blockquote> <p>Training logs for the model used in this exercise (Image provided by author)</p> </blockquote> <h4 id=exploration-in-noise-using-cleanlab><a class=toclink href=../../2022/05/16/confident-learning-and-clean-data/#exploration-in-noise-using-cleanlab>Exploration in noise using cleanlab</a></h4> <p>As shown in <a href="https://github.com/suneeta-mall/label_noise/blob/master/label_noise_notebook.ipynb">this notebook</a>, the filter approach provided a list of samples that were deemed noisy. This flagged 38% of out-of-samples as noisy/erroneous. </p> <p>Ranking provided an order in the samples on a 0-1 scale for label quality, the higher the number, the better quality the sample. I looked in <code>get_self_confidence_for_each_label</code> approach for out-of-distribution (OOD) samples and also entropy-based ordering. The distribution for each is as follows:</p> <p><img alt src=../../../resources/data-centric-ai/cleanlab/rank_entropy.jpg></p> <blockquote> <p>Confidance order of entropy-based ordering</p> </blockquote> <p><img alt src=../../../resources/data-centric-ai/cleanlab/rank_self_confidance.jpg></p> <blockquote> <p>Confidance order of self_confidence ordering</p> </blockquote> <p>The samples picked as lowest quality or confidence is indeed rightfully chosen. There is an airplane that was missed in the image (shown in the highlighted overlay) and also another sample is OOD! <img alt src=../../../resources/data-centric-ai/cleanlab/Errors_flagged_in_ranking.jpg></p> <p>What's more interesting is all three methods of filtering, ranked by self-confidence and entropy all flagged these two samples! So we increase the threshold, and while there are false positives (for noise) there is some good example of errors.</p> <table> <thead> <tr> <th>False Positive</th> <th>True Positive</th> </tr> </thead> <tbody> <tr> <td><img alt src=../../../resources/data-centric-ai/cleanlab/fp_cl.jpg></td> <td><img alt src=../../../resources/data-centric-ai/cleanlab/Increasing_threshold_error.jpg></td> </tr> </tbody> </table> <p>I am not sure if I am following how to interpret the <a href="https://github.com/cleanlab/cleanlab/issues/263">pair-wise count for multi-label</a>, so that's left for another day!</p> <h3 id=conclusion><a class=toclink href=../../2022/05/16/confident-learning-and-clean-data/#conclusion>Conclusion</a></h3> <p>As discussed in this post, there are several reasons why label errors are unavoidable. While no small-efforts are required to minimize the errors in the dataset, management of the errors in the dataset is also warranted. The management to find noisy data, out of distribution data, or data that represents a systematic flaw (software/tooling issues or issues in the understanding of a concept that defines the target class). Approaches like model-in-loop, or additional information like ontology to find such noises or errors in the dataset are effective techniques. Confident learning provides a solid foundation for analyzing a dataset of noisy or OOD samples — a technique that's quite effective for multi-class approaches, with the evolving support for multi-label classification. Now, on to cleaning the dataset! Happy cleaning!</p> <h3 id=references><a class=toclink href=../../2022/05/16/confident-learning-and-clean-data/#references>References</a></h3> <ol> <li>C. G. Northcutt, L. Jiang, and I. Chuang. Confident learning: Estimating uncertainty in dataset labels. Journal of Artificial Intelligence Research, 70:1373–1411, 2021. <a href="https://arxiv.org/abs/1911.00068">1911.00068</a></li> <li>Northcutt, C. G., Athalye, A., and Mueller, J. (2021). Pervasive label errors in test sets destabilize machine learning benchmarks. In International Conference on Learning Representations Workshop Track (ICLR). <a href="https://arxiv.org/abs/2103.14749">2103.14749</a></li> <li>D. Angluin and P. Laird. Learning from noisy examples. Machine Learning, 2(4):343–370, 1988. <a href="http://homepages.math.uic.edu/~lreyzin/papers/angluin88b.pdf">link</a></li> <li>Crowley RS, Legowski E, Medvedeva O, Reitmeyer K, Tseytlin E, Castine M, Jukic D, Mello-Thoms C. Automated detection of heuristics and biases among pathologists in a computer-based system. Adv Health Sci Educ Theory Pract. 2013 Aug;18(3):343-63. doi: 10.1007/s10459-012-9374-z. Epub 2012 May 23. PMID: 22618855; PMCID: PMC3728442. <a href="https://pubmed.ncbi.nlm.nih.gov/22618855/">link</a></li> <li>Huan Ling and Jun Gao and Amlan Kar and Wenzheng Chen and Sanja Fidler, Fast Interactive Object Annotation with Curve-GCN. CVPR, 2019 <a href="https://arxiv.org/abs/1903.06874">link</a></li> <li>Jiang, L., Zhou, Z., Leung, T., Li, L.-J., and Fei-Fei, L. (2018). Mentornet: Learning data-driven curriculum for very deep neural networks on corrupted labels. In International Conference on Machine Learning (ICML).<a href="https://arxiv.org/abs/1712.05055">1712.05055</a>.</li> <li>N. Natarajan, I. S. Dhillon, P. K. Ravikumar, and A. Tewari. Learning with noisy labels. In Conference on Neural Information Processing Systems (NeurIPS), pages 1196–1204, 2013. <a href="https://proceedings.neurips.cc/paper/2013/file/3871bd64012152bfb53fdf04b401193f-Paper.pdf">NurIPS 2013</a></li> <li>P. Chen, B. B. Liao, G. Chen, and S. Zhang. Understanding and utilizing deep neural networks trained with noisy labels. In International Conference on Machine Learning (ICML), 2019.<a href="https://arxiv.org/abs/1905.05040">1905.05040</a></li> <li>Han, B., Yao, Q., Yu, X., Niu, G., Xu, M., Hu, W., Tsang, I., and Sugiyama, M. (2018). Co-teaching: Robust training of deep neural networks with extremely noisy labels. In Conference on Neural Information Processing Systems (NeurIPS). <a href="https://arxiv.org/abs/1804.06872">1804.06872</a></li> </ol> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=/resources/me.png alt="Suneeta Mall"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2021-12-31 00:00:00">December 31, 2021</time></li> <li class=md-meta__item> in <a href=./ class=md-meta__link>Machine Learning</a>, <a href=../ai/ class=md-meta__link>AI</a>, <a href=../deep-learning/ class=md-meta__link>Deep Learning</a>, <a href=../data/ class=md-meta__link>Data</a>, <a href=../data-centric-ai/ class=md-meta__link>Data-Centric-AI</a></li> <li class=md-meta__item> 27 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=review-of-recent-advances-in-dealing-with-data-size-challenges-in-deep-learning><a href=../../2021/12/31/data-in-deep-learning/ class=toclink>Review of recent advances in dealing with data size challenges in Deep Learning</a></h2> <p>The energy and excitement in machine learning and deep learning communities are infectious these days. So many groundbreaking advances are happening in this area but I have often found myself wondering why the only thing that makes it all shine - yes I am talking about the dark horse of deep learning <em>the</em> <em>data</em> is so underappreciated. The last few years of DL research have given me much joy and excitement and I carry hope now that going forward we can see some exciting progress in this space that explore advances in deep learning in conjunction with data! In this article, I summarise some of the recent developments in the deep learning space that I have been blown away by. </p> <p>Table of content of this article: - <a href=../../2021/12/31/data-in-deep-learning/#review-of-recent-advances-in-dealing-with-data-size-challenges-in-deep-learning>Review of recent advances in dealing with data size challenges in Deep Learning</a> - <a href=../../2021/12/31/data-in-deep-learning/#the-dark-horse-of-deep-learning-data>The dark horse of deep learning: data</a> - <a href=../../2021/12/31/data-in-deep-learning/#labelled-data-the-types-of-labels>Labelled data: the types of labels</a> - <a href=../../2021/12/31/data-in-deep-learning/#commonly-used-dl-techniques-centered-around-data>Commonly used DL techniques centered around data</a> - <a href=../../2021/12/31/data-in-deep-learning/#data-augmentation>Data Augmentation</a> - <a href=../../2021/12/31/data-in-deep-learning/#transfer-learning>Transfer Learning</a> - <a href=../../2021/12/31/data-in-deep-learning/#dimensionality-reduction>Dimensionality reduction</a> - <a href=../../2021/12/31/data-in-deep-learning/#active-learning>Active learning</a> - <a href=../../2021/12/31/data-in-deep-learning/#challenges-in-scaling-dataset-for-deep-learning>Challenges in scaling dataset for deep-learning</a> - <a href=../../2021/12/31/data-in-deep-learning/#recent-advances-in-data-related-techniques>Recent advances in data-related techniques</a> - <a href=../../2021/12/31/data-in-deep-learning/#1-regularization>1. Regularization</a> - <a href=../../2021/12/31/data-in-deep-learning/#11-mixup>1.1 Mixup</a> - <a href=../../2021/12/31/data-in-deep-learning/#12-label-smoothing>1.2 Label Smoothing</a> - <a href=../../2021/12/31/data-in-deep-learning/#2-compression>2. Compression</a> - <a href=../../2021/12/31/data-in-deep-learning/#21-x-shot-learning-how-many-are-enough>2.1. X-shot learning: How many are enough?</a> - <a href=../../2021/12/31/data-in-deep-learning/#22-pruning>2.2. Pruning</a> - <a href=../../2021/12/31/data-in-deep-learning/#221-coresets>2.2.1 Coresets</a> - <a href=../../2021/12/31/data-in-deep-learning/#222-example-forgetting>2.2.2 Example forgetting</a> - <a href=../../2021/12/31/data-in-deep-learning/#223-using-gradient-norms>2.2.3 Using Gradient norms</a> - <a href=../../2021/12/31/data-in-deep-learning/#23-distillation>2.3. Distillation</a> - <a href=../../2021/12/31/data-in-deep-learning/#3-so-what-if-you-have-noisy-data>3. So what if you have noisy data</a> - <a href=../../2021/12/31/data-in-deep-learning/#conclusion>Conclusion</a> - <a href=../../2021/12/31/data-in-deep-learning/#references>References</a></p> <h2 id=the-dark-horse-of-deep-learning-data><a class=toclink href=../../2021/12/31/data-in-deep-learning/#the-dark-horse-of-deep-learning-data>The dark horse of deep learning: data</a></h2> <p>Deep learning (DL) algorithms learn to perform a task by building a (domain) knowledge representation by looking at the training data. An early study of image models (classification and segmentation, year 2017) noted that the performance of the model increases logarithmically as the training dataset increases <a href="https://arxiv.org/abs/1707.02968">1</a>. The belief that increasing training dataset size will continue to increase model performance has been long-held. This has also been supported by another empirical study that validated this belief across machine translation, language modeling, image classification, and speech recognition <a href="https://arxiv.org/abs/1712.00409">2</a> (see figure 1). </p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/dataset_size_scale.jpeg> *Figure 1: Shows relationship between generalization error and dataset size (log scale) <a href="https://arxiv.org/abs/1712.00409">2</a> *</p> </blockquote> <p>So, the bigger dataset is better right? Almost! A theoretical foundation has been laid out in the form of power-law i.e $ \begin{equation} \label{power_law} ε(m) \approx αm^{β_g} \end{equation} $ wherein <em>ε</em> is generalization error, <em>m</em> is the number of samples in the training set, <em>α</em> is a constant property of the problem/DL task, and <em>β<sub>g</sub></em> is the scaling exponent that defines the steepness of the learning curve. Here, <em>β<sub>g</sub></em>, the steepness of the curve depicts how well a model can learn from adding more data to the training set <a href="https://arxiv.org/abs/1712.00409">2</a> .(see figure 2) Empirically, <em>β<sub>g</sub></em> was found to be between −0.07 and −0.35 despite theory suggesting <em>β<sub>g</sub></em> to be 0.5 or 1. Nonetheless, the logarithmic relationship holds. As shown in figure 2, the gain eventually tapers in irreducible error. </p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/power-law.jpeg> *Figure 2: Power Law curve showing model trained with a small dataset only as good as random guesses to rapidly getting better as dataset size increases to eventually settling into irreducible error region explained by a combination of factors including imperfect data that cause imperfect generalization <a href="https://arxiv.org/abs/1712.00409">2</a> *</p> </blockquote> <p>This can be attributed to several factors including imperfection in data. The importance of data quality and continually iterating over is touched on in some of the previous talks <a href="https://suneeta-mall.github.io/talks/She_Builds_on_AWS_2020.html">1</a>, <a href="https://suneeta-mall.github.io/talks/AWS_ANZ_Commuity_day_2020.html">2</a>, <a href="https://suneeta-mall.github.io/talks/Kafka_Summit_APAC_2021.html">3</a>. Data quality matters, and so does the data distribution. The better the distribution of the training dataset is, the more generalized the model can be!</p> <hr> <blockquote> <blockquote> <blockquote> <blockquote> <p>Data is certainly the new oil! <a href="https://www.wired.com/story/no-data-is-not-the-new-oil/">3</a></p> </blockquote> </blockquote> </blockquote> </blockquote> <hr> <p>So, can we scale the data size without many grievances? Keep in mind, 61% of AI practicing organizations already find data and data-related challenges as their top challenge <a href="https://pages.run.ai/hubfs/PDFs/2021-State-of-AI-Infrastructure-Survey.pdf">4</a>. If the challenges around procurement, storage, data quality, and distribution/demographic of the dataset has not subsumed you yet, this post focuses on yet another series of questioning. How can we train efficiently when data volume grows and the computation cost and turnaround time increase linearly with data growth? Then we begin asking how much of the data is superfluous, which examples are more impactful, and how do we find them? These are very important questions to ask given a recent survey <a href="https://pages.run.ai/hubfs/PDFs/2021-State-of-AI-Infrastructure-Survey.pdf">4</a> noted that about 40% of the organizations practicing AI already spend at least $1M per annum on GPUs and AI-related compute infrastructures. This should concern us all. Not every organization beyond the FAANG (and also, the one's assumed in FAANG but missed out on acronym!) and ones with big fat balance sheet will be able to leverage the gain by simply scaling the dataset. Besides, this should concern us all for environmental reasons and carbon emissions implications <a href="https://www.forbes.com/sites/robtoews/2020/06/17/deep-learnings-climate-change-problem/?sh=55d621d76b43">more details</a>. </p> <blockquote> <p>The carbon footprint of training a single AI is as much as 284 tonnes of carbon dioxide equivalent — five times the lifetime emissions of an average car <a href="https://www.newscientist.com/article/2205779-creating-an-ai-can-be-five-times-worse-for-the-planet-than-a-car/">source</a>.</p> </blockquote> <p>The utopian state of simply scaling training datasets and counting your blessings simply does not exist. The question then is, what are we doing about it? Unfortunately not a whole lot especially if you look at the excitement in the ML research community in utilizing gazillion GPU years to gain a minuscule increase in model performance attributed to algorithmic or architectural changes. But the good news is this area is gaining much more traction now. Few pieces of research since 2020 are very promising albeit in their infancy. I have been following the literature around the use of data in AI (a.k.a data-centric AI) topic very closely as this is one of my active areas of interest. I am excited about some of the recent developments in this area. In this post, I will cover some of my learnings and excitement around this topic.</p> <p>Before, covering them in detail, let's review foundational understanding and priors first:</p> <h2 id=labelled-data-the-types-of-labels><a class=toclink href=../../2021/12/31/data-in-deep-learning/#labelled-data-the-types-of-labels>Labelled data: the types of labels</a></h2> <p>This post focuses heavily on supervised learning scenarios focussing mainly on computer vision. In this space, there are two types of labels: - Hard labels - Soft labels</p> <p>Traditional labels are hard labels where the value of ground truth is a discrete value e.g. 0 and 1, 0 for no, and 1 for yes. These discrete values can be anything depending on how the dataset was curated. It's important to note that these values are absolute and unambiguously indicate their meaning.</p> <p>There is an emerging form of labels known as soft labels where ground through represents the likelihood. By nature these labels are continuous. An example, a pixel is 40% cat 60% dog. It will make a whole lot of sense in the following sections.</p> <h2 id=commonly-used-dl-techniques-centered-around-data><a class=toclink href=../../2021/12/31/data-in-deep-learning/#commonly-used-dl-techniques-centered-around-data>Commonly used DL techniques centered around data</a></h2> <p>Data augmentation and transfer learning are two commonly used techniques in deep learning these days that focus on applying data efficiently. Both these techniques are heavily democratized now and commonly applied unless explicitly omitted. </p> <h3 id=data-augmentation><a class=toclink href=../../2021/12/31/data-in-deep-learning/#data-augmentation>Data Augmentation</a></h3> <p>Data augmentation encompasses a variety of techniques to transform a datapoint such that it adds variety to the dataset. The technique aims to keep the data distribution about the same but add richness to the dataset by adding variety. Predominantly, the transformation via this technique has been intra-sample. Affine transformations, contrast adjustment, jittering, or color balancing are some such examples of data augmentation techniques. <a href="https://github.com/aleju/imgaug">Imgaug</a> and <a href="https://github.com/kornia/kornia">kornia</a> are very good libraries for such operation even though all ML frameworks offer a limited set of data augmentation routines. </p> <p>Data augmentation technique was initially proposed to increase robustness and achieve better generalization in the model but they are also used as a technique to synthetically increase data size as well. This is especially true in cases where data procurement is really challenging. These days, data augmentation techniques have become a lot more complex and richer including scenarios where-in model-driven augmentations may also be applied. One example of this is GAN-based techniques to augment and synthesize samples. In fact, data augmentation is also one of the techniques to build robustness against adversarial attacks.</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/imgaug_heavy1.jpg> * Example of augmentation <a href="https://github.com/aleju/imgaug">src</a> *</p> </blockquote> <h3 id=transfer-learning><a class=toclink href=../../2021/12/31/data-in-deep-learning/#transfer-learning>Transfer Learning</a></h3> <p>Transfer learning is a very well democratized technique as well that stems from reusing the learned representations into a new task if the problem domain of two tasks is related. Transfer learning relaxes the assumption that the training data must be independent and identically distributed (i.i.d.) with the test data <a href="https://arxiv.org/abs/1808.01974">5</a>, allowing one to solve the problem of insufficient training data by bootstrapping model weights from another learned model trained with another dataset.</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/transfer_learning.jpeg> *Figure 3: Training with and without transfer learning <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.146.1515&amp;rep=rep1&amp;type=pdf">6</a> *</p> </blockquote> <p>With transfer learning, faster convergence can be achieved if there is an overlap between the tasks of the source and target model.</p> <h3 id=dimensionality-reduction><a class=toclink href=../../2021/12/31/data-in-deep-learning/#dimensionality-reduction>Dimensionality reduction</a></h3> <p>Dimension reduction techniques are also applied to large datasets:</p> <p>These techniques are categorized into two: 1. Ones that seek to preserve the pairwise distance amongst all the samples in the dataset. Principal component analysis (PCA) is a good example of this. 2. Ones that preserve the local distances over global distance. The techniques like uniform manifold approximation and projection (UMAP) <a href="https://arxiv.org/abs/1802.03426">23</a> and t-distributed stochastic neighbor embedding (t-SNE) <a href="https://www.jmlr.org/papers/volume9/vandermaaten08a/vandermaaten08a.pdf">24</a> fit in this category. UMAP arguably preserves more of the global structure and is algorithmically faster than t-sne. Both T-SNE and UMAP use gradient descent for arriving at the optimal embeddings.</p> <p>These techniques in DL space however are mostly used to understand the data and also for visualization purposes. UMAP and T-SNE do better at preserving global structure than other embedding algorithms but are limited. <a href="https://towardsdatascience.com/tsne-vs-umap-global-structure-4d8045acba17">This blog</a> covers the topic more in detail.</p> <h3 id=active-learning><a class=toclink href=../../2021/12/31/data-in-deep-learning/#active-learning>Active learning</a></h3> <p>Active learning is a methodology wherein the training process proactively asks for labels on specific data. It is used more commonly in classical ML techniques, but it has not been very successful in deep learning due to back-propagation. Offline or pool-based active learning has been investigated heavily for use in deep learning but without much groundbreaking success. The use of active learning is not very straightforward either due to the negative impact of outliers on training <a href="https://arxiv.org/abs/2107.02331">25</a>. Pool-based active learning will be covered in the following section in more detail (pruning).</p> <h2 id=challenges-in-scaling-dataset-for-deep-learning><a class=toclink href=../../2021/12/31/data-in-deep-learning/#challenges-in-scaling-dataset-for-deep-learning>Challenges in scaling dataset for deep-learning</a></h2> <p>Besides the techniques discussed in <a href=../../2021/12/31/data-in-deep-learning/#commonly-used-dl-techniques-centered-around-data>previous section</a>, not a lot of investment has been done in the area focussing on data-centric AI. The momentum around data-centric AI is forming a bit recently with <a href="https://twitter.com/AndrewYNg">Andrew Ng</a> driving <a href="https://landing.ai/data-centric-ai/">data-centric AI</a> efforts through his new startup <a href="https://landing.ai">Landing.AI</a>. </p> <p>In my view, the following are some of the broad categories of questions that fall under the purview of data-centric AI:</p> <ol> <li>How to efficiently train with the rapid increase in the dataset? <a href="https://twitter.com/ylecun">Yann LeCun</a> called out in his interview with <a href="https://twitter.com/soumithchintala">Soumith Chintala</a> during <a href="https://www.youtube.com/watch?v=vXbbaEZbrOI">PyTorch developer day 2021</a> that training time of more than 1 week should not be acceptable. This is a very good baseline for practical reasons but if one does not have an enormous GPU fleet at their disposal then this is goalpost is very hard to achieve given current DL practices. So, what else can be done to train efficiently with increased dataset size?</li> <li>Are all samples equally important? How important a sample in the dataset is? Can we leverage the "importance factor" for good?</li> <li>What role does a sample play towards better generalization? Some samples carry redundant features, so how to deduplicate the dataset when features as in DL are not explicit?</li> <li>Data size matters but can we be strategic about what goes in the dataset?<ol> <li>Cleverly doing this has to do with efficient sampling and data mining techniques. These are the easily solved problem if and only if we know what our targets are. Challenge in DL, as I see it, is what to look for to mine for the best sample? This is not well understood. </li> </ol> </li> <li>How can we leverage more innate DL techniques like objective functions, backpropagation, and gradient descent to build a slick and effective dataset that provides the highest return on investment.</li> <li>Noises in datasets are seen as evil. But are they always evil? How much noise can one live with? How to quantify this?</li> <li>How much of a crime it is if data bleeds across traditional train/validate/calibrate/test splits.<ol> <li>What are the recommendations on the data split for cascade training scenarios?</li> </ol> </li> <li>How fancy can one get with data augmentation before returns start to diminish?</li> <li>How to optimize the use of data if continual learning is observed? </li> </ol> <h2 id=recent-advances-in-data-related-techniques><a class=toclink href=../../2021/12/31/data-in-deep-learning/#recent-advances-in-data-related-techniques>Recent advances in data-related techniques</a></h2> <p>If we look at humans are learning machines, they have infinite data at their disposal to learn from. Our system had evolved into efficient strategies to parse through infinite data streams to select the samples we are interested in. How our vision system performs foveal fixation utilizing saccadic eye movements to conduct efficient subsampling of interesting and useful datapoint should be a good motivation. Sure we fail sometimes, we fail to see the pen on the table even though it's right in front of us due to various reasons but we hit it right most of the time. Some concepts of <a href="http://www.gestalttheory.net/cms/uploads/pdf/archive/1934_1960/Principles_Gestalt_Psychology_koffka.pdf">Gestalt theory</a>, a principle used to explain how people perceive visual components (as organized patterns, instead of many disparate parts) are already applicable for better selection of data even if machine models are <a href="https://dl.acm.org/doi/10.1145/3442188.3445922">stochastic parrots</a>. According to this theory, eight main factors, listed below, determine how the visual system automatically groups elements into patterns. </p> <ol> <li>Proximity: Tendency to perceive objects or shapes that are close to one another as forming a group. </li> <li>Similarity: Tendency to group objects if physical resemblance e.g. shape, pattern, color, etc. is present. </li> <li>Closure: Tendency to see complete figures/forms even if what is present in the image is incomplete. </li> <li>Symmetry: Tendency to 'see' objects as symmetrical and forming around a center point. 50 </li> <li>Common fate: Tendency to associate similar movement as part of a common motion. </li> <li>Continuity: Tendency to perceive each object as a single uninterrupted i.e. continuous object </li> <li>Good Gestalt: Tendency to group together if a regular, simple, and orderly pattern can be formed </li> <li>Past experience: Tendency to categorize objects according to past experience. </li> </ol> <p>Of these, I argue, proximity, similarity, common fate, and past experience are relevant. I even argue on the possibility of applying closure. A recent work by FAIR <a href="https://arxiv.org/abs/2111.06377">22</a>, shows that machine models can fill in the gaps and infer missing pieces correctly by applying minor changes commonly used technique autoencoders. Why I bring this up with so much excitement than GAN-based techniques of hallucination is how easy it is to build and train as compared to GAN.</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/masked_autoencoder.jpeg> <em>Masked-Autoencoders showing model inferring missing patches <a href="https://arxiv.org/abs/2111.06377">22</a></em></p> </blockquote> <p>Its been interesting to note that the recent advances towards dealing with the challenges of scaled data are largely inspired by already known deep-learning techniques except they are now applied through the lens of data. Examples like pruning, compression, sampling strategies, and leveraging from phenomena such as catastrophic forgetting, knowledge distillation.</p> <table> <thead> <tr> <th style="text-align: left;">Technique</th> <th style="text-align: center;">How it's presently utilized in model building</th> <th style="text-align: right;">Proposed data-centric view</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">Prunning</td> <td style="text-align: center;">A specialized class of model compression technique where low magnitude weights are eliminated to reduce the size and computational overhead.</td> <td style="text-align: right;">Samples that don't contribute much to generalization are omitted from the training regime.</td> </tr> <tr> <td style="text-align: left;">Compression</td> <td style="text-align: center;">A broad range of model compression techniques to reduce the size and computational overhead includes techniques like quantization wherein some amount of information loss is expected.</td> <td style="text-align: right;">A broad range of data filtering and compression techniques to reduce size without compromising much on generalization.</td> </tr> <tr> <td style="text-align: left;">Distillation</td> <td style="text-align: center;">To extract learned representation from a more complex model to a potentially smaller model.</td> <td style="text-align: right;">To extract knowledge present in the larger dataset into a smaller synthesized set.</td> </tr> <tr> <td style="text-align: left;">Loss function</td> <td style="text-align: center;">Also termed as the objective function is the one of core concepts of DL that defines the problem statement.</td> <td style="text-align: right;">As shown in <a href="https://arxiv.org/abs/2111.06377">22</a>, and also more broadly can be leveraged to fill in missing information in the data.</td> </tr> <tr> <td style="text-align: left;">Regularisation</td> <td style="text-align: center;">One of the theoretical principles of DL is applied through various techniques like BatchNorm, Dropouts to avoid overfitting.</td> <td style="text-align: right;">Variety of techniques to ensure overfitting applied with data in mind, e.g. Label Smoothing <a href="https://arxiv.org/abs/1710.09412">7</a>,<a href="https://arxiv.org/abs/1512.00567">10</a></td> </tr> </tbody> </table> <p>*Table 1: Summary of techniques that are crossbreed from core DL techniques to also into data-centric DL *</p> <p>Let's dive into the details of how these classes of techniques are applied through the lens of data:</p> <h3 id=1-regularization><a class=toclink href=../../2021/12/31/data-in-deep-learning/#1-regularization>1. Regularization</a></h3> <h4 id=11-mixup><a class=toclink href=../../2021/12/31/data-in-deep-learning/#11-mixup>1.1 Mixup</a></h4> <p>Mixup is a special form of data augmentation technique that looks beyond intra-sample modification and explores inter-sample modification. The idea with mixup is to linearly combine (through convex geometry) a pair of samples to result into one.</p> <p>$ \begin{equation} x\prime=λx_i + (1−λ)x_j , \ \text{where,} λ ∈ [0,1] \ \text{ drawn from beta distribution, and xi, xj are input/source vector} \end{equation} $</p> <p>$ \begin{equation} y\prime = λy_i + (1 − λ)y_j , \ \text{where y_i , yj are one-hot label encodings} \end{equation} $</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/mixup_on_oxford_pets.jpeg> *Figure 4: Sample produced by applying mixup <a href="https://arxiv.org/abs/1710.09412">7</a> on <a href="https://www.robots.ox.ac.uk/~vgg/data/pets/">Oxford Pets dataset</a> *</p> </blockquote> <p>Mixup <a href="https://arxiv.org/abs/1710.09412">7</a> in fact seeks to regularize the neural network to favor simple linear behavior in-between training examples. As shown in fig 5, mixup results in better models with fewer missed. Its been shown that mixup increases the generalization, reduces the memorization of corrupt labels, increases the robustness towards adversarial examples <a href="https://arxiv.org/abs/1710.09412">7</a>,<a href="https://arxiv.org/abs/1812.01187">8</a>.</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/mixup-gradnorm.jpeg> <em>Figure 5: Shows that using mixup <a href="https://arxiv.org/abs/1710.09412">7</a>, lower prediction error and smaller gradient norms are observed.</em></p> </blockquote> <p>I see mixup as not only an augmentation, and regularisation technique but also a data compression technique. Depending on how frequently (say α) the mixup is applied, the dataset compression ratio (C<sub>r</sub>) will :</p> <p>$ \begin{equation} C_r = 1 - α/2 \end{equation} $</p> <p>If you have not noticed already, applying mixup convert labels to soft labels. The linear combination of discreet values will result in a continuous label value that can explain the example previously discussed wherein the pixel is 40% cat 60% dog (see fig 5).</p> <h4 id=12-label-smoothing><a class=toclink href=../../2021/12/31/data-in-deep-learning/#12-label-smoothing>1.2 Label Smoothing</a></h4> <p>Label smoothing <a href="https://arxiv.org/abs/1512.00567">10</a> is a form of regularisation technique that smoothes out ground truth by a very small value epsilon <code>ɛ</code>. One motivation for this is of course better generalization and avoiding overfitting. While the other motivation is to discourage the model from becoming overconfident. Both <a href="https://arxiv.org/abs/1812.01187">8</a>,<a href="https://arxiv.org/abs/1512.00567">10</a> have shown that label smoothing leads to better models.</p> <p>$ \begin{equation} Q_{i} = \begin{cases} \displaystyle 1 - ɛ &amp; \text{if i == k,} \ <br> ɛ/K &amp; \text{Otherwise, where K is number of classes} \ <br> \end{cases} <br> \end{equation} $</p> <p>Label smoothing as indicated by the equation above does not lead to any visible differences in label data as <code>ɛ</code> is really small. However, applying mixup change visibly changes both source (x) and the label (y).</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/visible_ls.jpeg> <em>Applying label-smoothing has no noticeable difference</em></p> </blockquote> <h3 id=2-compression><a class=toclink href=../../2021/12/31/data-in-deep-learning/#2-compression>2. Compression</a></h3> <p>Compression refers to a broad range of data filtering and compression techniques to reduce size without compromising much on generalization. Following are some of the recent exciting development on this front:</p> <h4 id=21-x-shot-learning-how-many-are-enough><a class=toclink href=../../2021/12/31/data-in-deep-learning/#21-x-shot-learning-how-many-are-enough>2.1. X-shot learning: How many are enough?</a></h4> <p>The troubles of high computational cost and long training times due to an increase in the dataset have led to the development of training by a few shot strategies. The intuition behind this approach is to take a model and guide it to learn to perform a new task only by looking at a few samples <a href="https://arxiv.org/abs/1904.05046">11</a>. The concept of transfer learning is implicitly applied in this approach. This line of investigation started with training new tasks by using only a few (handful) samples and explored an extreme case of one-shot training i.e. learning new tasks from only one sample <a href="https://ieeexplore.ieee.org/document/1597116">12</a>,<a href="https://arxiv.org/abs/1606.04080">13</a>.</p> <p>Recently an interesting mega-extreme approach of shot-based learning has emerged - <code>'Less Than One'-Shot Learning</code> a.k.a LO Shot learning <a href="https://arxiv.org/abs/1904.05046">11</a>. This approach utilizes soft label concepts and seeks to merge hard label N class samples into M samples where M &lt; N and thus the name less than one! LO Shot-based techniques are a form of data compression technique and may feel very similar to the MixUp technique discussed earlier. However, LO Shot contrary to a convex combination of samples as in Mixup, exploits distance weighted k-Nearest Neighbours technique to infer the soft labels. Their algorithm termed <code>distance-weighted soft-label prototype k-Nearest Neighbours (SLaPkNN)</code> essentially takes the sum of the label vectors of the k-nearest prototypes to target point x, with each prototype weighted inversely proportional to its distance from x. The following figure shows 4 class datasets are merged into 2 samples using SLaPkNN.</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/LO-Shot.jpeg> <em>Figure LO-Shot: LO Shot splitting 4 class space into 2 points <a href="https://arxiv.org/abs/1904.05046">11</a>.</em></p> </blockquote> <p>In my understanding that is the main theoretical difference between the two techniques, with the other difference being mixup only merges two samples into one using a probability drawn from beta distribution combined using <code>λ</code> and <code>1-λ</code> whereas LO is more versatile and can compress greatly. I am not saying mixup cant be extended to be more multivariate but that empirical analysis of such approach is unknown; whereas with <a href="https://arxiv.org/abs/1904.05046">11</a> its been shown SLaPkNN can compress 3M − 2 classes into M samples at least. </p> <p>The technical explanation for this along with code is available <a href="https://github.com/ilia10000/LO-Shot/tree/master/Paper1">here</a>.</p> <h4 id=22-pruning><a class=toclink href=../../2021/12/31/data-in-deep-learning/#22-pruning>2.2. Pruning</a></h4> <p>Pruning is a subclass of compression techniques wherein samples that are not really helpful or effective are dropped out whereas selected samples are kept as is without any loss in content. Following are some of the known techniques of dataset pruning:</p> <h5 id=221-coresets><a class=toclink href=../../2021/12/31/data-in-deep-learning/#221-coresets>2.2.1 Coresets</a></h5> <p>Coreset selection technique pertains to subsampling from a large dataset to a smaller set that almost approximates the given large set. This is not a new technique and has heavily been explored using hand-engineered features and simpler models like Markov models to approximate the smaller set. This is not a DL-specific technique either and has its place in classical ML as well. An example could be using naïve Bayes to select coresets for more computationally expensive counterparts like decision trees. </p> <p>In deep learning, using a similar concept, a lighter-weight DL model can be used as a proxy to select the approximate dataset <a href="https://arxiv.org/abs/1906.11829">15</a>. This is easier achieved when continual learning is practiced otherwise it can be a very expensive technique in itself given proxy model needs to be trained with a full dataset first. This becomes especially tricky given the proxy and target models are different and also when the information in the dataset is not concentrated in a few samples but uniformly distributed over all of them. These are some of the reasons why this approach is not very successful.</p> <h5 id=222-example-forgetting><a class=toclink href=../../2021/12/31/data-in-deep-learning/#222-example-forgetting>2.2.2 Example forgetting</a></h5> <p>An investigation <a href="https://arxiv.org/abs/1812.05159">14</a> reported that some samples once learned are never forgotten and exhibit the same behavior across various training parameters and hyperparameters. There are other classes of samples that are forgotten. The forgetting event was defined as when the model prediction regresses in the subsequent epoch. Both qualitative and qualitative (see fig 6 and 7) analysis into such forgotten samples indicated noisy labels, images with "uncommon" visually complicated features were the main reasons for example forgetting.</p> <blockquote> <p><img alt=w src=../../../resources/data-centric-ai/forgetting_stats.jpeg> <em>Figure 6: Algorithm to track forgotten samples <a href="https://arxiv.org/abs/1812.05159">14</a>.</em></p> <p><img alt src=../../../resources/data-centric-ai/forgetten_samples.jpeg> <em>Figure 7: Indicating how increasing fraction of noisy samples led to increased forgetting events <a href="https://arxiv.org/abs/1812.05159">14</a>.</em></p> </blockquote> <p>An interesting observation from this study was that losing a large fraction of unforgotten samples still results in extremely competitive performance on the test set. The hypothesis formed was unforgotten samples are not very informative whereas forgotten samples are more informative and useful for training. In their case, the forgetting score stabilized after 75 epochs (using RESNET &amp; CIFAR but the value will vary as per model and data).</p> <p>Perhaps a few samples are enough to tell that a cat has 4 legs, a small face, and pointy ears, and it's more about how different varieties of cats look especially if they look different from the norm e.g. Sphynx cats.</p> <h5 id=223-using-gradient-norms><a class=toclink href=../../2021/12/31/data-in-deep-learning/#223-using-gradient-norms>2.2.3 Using Gradient norms</a></h5> <p>Loss functions are an excellent measure to find interesting samples in your dataset whether these may be poorly labeled or really outlier samples. This was highlighted by <a href="https://twitter.com/karpathy/status/1311884485676294151">Andrej Karpathy</a> as well:</p> <blockquote> <p>When you sort your dataset descending by loss you are guaranteed to find something unexpected, strange, and helpful.</p> </blockquote> <p>Personally, I have found loss a very good measure to find poorly labeled samples. So, the natural question would be "should we explore how we can use the loss as a measure to prune the dataset?". It's not until NeurIPS 2021, <a href="https://arxiv.org/abs/2107.07075">21</a> that this was properly investigated. This Standford study looked into the initial loss gradient norm of individual training examples, averaged over several weight initializations, to prune the dataset for better generalization. This work is closely related to example forgetting except that instead of performance measure the focus more is on using local information early in training to prune the dataset. </p> <p>This work proposes GraNd score of a training sample (x, y) at time t given by L2 norm of the gradient of loss computed on that sample and also expected loss L2 norm termed EL2N (equation below). The reasoning here is that samples with a small GraNd score have abounded influence on learning how to classify the rest of the training data at a given training time. Empirically, this paper found that averaging the norms over multiple weight initializations resulted in scores that correlate with forgetting scores <a href="https://arxiv.org/abs/1812.05159">14</a> and leads to pruning a significant fraction of samples early in training. They were able to prune 50% of the sample from <em>CIFAR-10 without affecting accuracy</em>, while on the more challenging CIFAR-100 dataset, they pruned 25% of examples with only a 1% drop in accuracy. <br> $ \begin{equation} χ_t(x, y) = E_{w_t} || g_t(x, y)||_2 \ \tag*{GraNd eq} \ \end{equation} $</p> <p>$ \begin{equation} χ_t(x, y) = E || p(w_t, x) - y)||_2 \ \tag*{EL2N eq} \ \end{equation} $</p> <p>This is a particularly interesting approach and is a big departure from other pruning strategies to date which treated samples in the dataset independently. Dropping samples based on independent statistics provides a weaker theoretical guarantee of success as DL is a non-convex problem <a href="https://arxiv.org/abs/2107.07075">21</a>. I am very curious to find out how mixup impacts the GraNd scores given it shown (see figure 5b) using mixup leads to smaller gradient norm (l1 albeit).</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/gradnd_el2n.jpeg> <em>Results of prunning with GradNd and EL2N <a href="https://arxiv.org/abs/2107.07075">21</a>.</em></p> </blockquote> <p>The results from this study are shown in the fig above. Noticeably high pruning is not fruititious even with this approach despite how well it's doing on CIFAR-10 and 100 datasets. Are we retaining the data distribution when we drop large samples? Mostly not and that is only reasoning that makes sense. And we circle back to how much pruning is enough? Is that network dependent or more a property of data and its distribution? This study <a href="https://arxiv.org/abs/2107.07075">21</a> claims that GradND and EL2N scores, when averaged over multiple initializations or training trajectories remove dependence on specific weights/networks, presenting a more compressed dataset. If this assertion holds in reality, in my view, this is a very promising finding easing the data-related challenges of DL.</p> <p>What's more fascinating about this work is that it sheds light on how the underlying data distribution shapes the training dynamics. This has been amiss until now. Of particular interest is identifying subspaces of the model's data representation that are relatively stable over the training.</p> <h4 id=23-distillation><a class=toclink href=../../2021/12/31/data-in-deep-learning/#23-distillation>2.3. Distillation</a></h4> <p>Distillation technique refers to the methodologies of distilling the knowledge of a complex or larger set into a smaller set. <a href="https://arxiv.org/abs/1503.02531">Knowledge or model distillation</a> is a popular technique that compresses the learned representation of a larger model into a much smaller model without any significant drop in performance. Using student-teacher training regime have been explored extensively even in the case of transformer networks that are even more data-hungry than more conventional network say Convolution network <a href="https://arxiv.org/abs/2012.12877">DeiT</a>. Despite being called data-efficient, this paper employs a teacher-student strategy to transform networks, and data itself is merely treated as a commodity. </p> <p>Recently, this concept is investigated for use in deep learning for dataset distillation with aim of synthesizing an optimal smaller dataset from a large dataset <a href="https://arxiv.org/abs/1811.10959">17</a>,<a href="https://arxiv.org/abs/2102.08259">16</a>. The distilled dataset are learned and synthesized but in theory, they approximate the larger dataset. Note that the synthesized data may not follow the same data distribution.</p> <p>Some dataset distillation techniques refer to their approach as compression as well. I disagree with this in principle as compression albeit lossy in this context, refers to compressing the dataset whereas with distillation the data representation is deduced/synthesized - potentially leading to entirely different samples together. Perhaps it's the compressibility factor a.k.a compression ratio that applies to both techniques. For example, see figure 13 shows the extent to which distilled images can change.</p> <p>A dataset distillation <a href="https://arxiv.org/abs/1811.10959">17</a> paper quotes:</p> <blockquote> <p>We present a new optimization algorithm for synthesizing a small number of synthetic data samples not only capturing much of the original training data but also tailored explicitly for fast model training in only a few gradient steps <a href="https://arxiv.org/abs/1811.10959">17</a>.</p> </blockquote> <p>Their problem formulation was very interesting! they derive the network weights as a differentiable function of the synthetic training data and set the training objective to optimize the pixel values of the distilled images The result from this study showed that one can go as low as one synthetic image per category while not regressing too much on the performance. More concretely, they distilled 60K training images of the MNIST digit dataset into only 10 synthetic images (one per class) yields a test-time MNIST recognition performance of 94%, compared to 99% for the original dataset). </p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/fair_mnist_distillation.jpeg> <em>Figure 8: Dataset distillation results from FAIR study <a href="https://arxiv.org/abs/1811.10959">17</a>.</em></p> </blockquote> <p>Here are some of the distilled samples for the classes labeled at the top (fig 9). It's amazing how well the MNIST trained on these sets does but CIFAR one misses the mark only being about as good as random (54%) compared to 80% on the full dataset(fig 8 &amp; 9).</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/example_of_distilled_images.jpeg> <em>Figure 9: Dataset distillation results from FAIR study <a href="https://arxiv.org/abs/1811.10959">17</a>.</em></p> </blockquote> <p>Following this work, another distillation technique was proposed utilizing kernel methods - more specifically kernel ridge regression to obtain ε-approximate of original datasets <a href="https://arxiv.org/abs/2011.00050">18</a>. This technique is termed Kernel Inducing Points (KIP) and follows the same principle for keeping the objective function to maximize the approximation and backpropagate the gradients to learn synthesized distilled data. The difference between <a href="https://arxiv.org/abs/2011.00050">18</a> and <a href="https://arxiv.org/abs/1811.10959">17</a> is one <a href="https://arxiv.org/abs/1811.10959">17</a> uses the same DL network while the other <a href="https://arxiv.org/abs/2011.00050">18</a> uses kernel techniques. With KIP, another advantage is that not just source samples but optionally labels can be synthesized too. In <a href="https://arxiv.org/abs/1811.10959">17</a>, the objective was purely to learn pixel values and thus the source (X). This paper <a href="https://arxiv.org/abs/2011.00050">18</a> also proposes another technique Label Solve (LS) in while X is kept constant and only label (Y) is learned.</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/KIP_LS.jpeg> <em>Figure 10: Examples of distilled samples a) with KIP and b) With LS <a href="https://arxiv.org/abs/2011.00050">18</a>.</em></p> </blockquote> <p>The CIFAR 10 result from <a href="https://arxiv.org/abs/1811.10959">17</a> (fig 9) was about 36.79% for 10 samples, with KIP there is a slight gain in performance there given the extreme compression. This raises the question of what is a good compression ratio that can guarantee good information retention. For complex tasks like CIFAR (compared to MNIST), 10 (one per sample) may not be enough given how complex this dataset is comparatively. </p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/KIP_LS_Results.jpeg> <em>Figure 11: CIFAR10 result from KIP and LS <a href="https://arxiv.org/abs/2011.00050">18</a>.</em></p> </blockquote> <p>Actually, LO shot technique <a href="https://arxiv.org/abs/1904.05046">11</a>, discussed previously, is also a specialized form of X-shot technique that does dataset distillation. Aside from that, gradient-based techniques for dataset distillation have been actively investigated in the last few years (ref <a href="https://arxiv.org/abs/2102.08259">16</a>,<a href="https://arxiv.org/abs/1811.10959">17</a>,<a href="https://arxiv.org/abs/2011.00050">18</a>,<a href="https://arxiv.org/abs/2006.05929">19</a>,<a href="https://arxiv.org/abs/2107.13034">20</a>). Another approach explored siamese augmentation method termed <code>Differentiable Siamese Augmentation (DSA)</code> that uses matching loss and synthesizes dataset through backpropagation techniques <a href="https://arxiv.org/abs/2102.08259">16</a></p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/dsa.jpeg> <em>Figure 12: Differentiable Siamese Augmentation <a href="https://arxiv.org/abs/2102.08259">16</a>.</em></p> </blockquote> <p>Bayesian and gradient-descent trained neural networks converge to Gaussian processes (GP) as the number of hidden units in intermediary layers approaches infinity <a href="https://arxiv.org/abs/2107.13034">20</a> (fig 13). This is true for convolutional networks as well as they converge to a particular gaussian processes channel limits are stretched to infinity. These networks can thus be described as kernels known as Neural Tangent Kernel (NTK). <a href="https://github.com/google/neural-tangents">Neural Tangents</a> library based on <a href="https://github.com/google/jax">JAX</a> an auto differentiation toolkit has been used in applying these kernels in defining some of the recent distillation methods. References <a href="https://arxiv.org/abs/2011.00050">18</a>,<a href="https://arxiv.org/abs/2107.13034">20</a>,<a href="https://arxiv.org/abs/2107.07075">21</a> are one such examples. </p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/1_640_50fps_FINAL_VERSION.gif> <em>Figure 13: Infinite width Convolution networks converging to infinity <a href="https://arxiv.org/abs/2107.13034">20</a>.</em></p> </blockquote> <p>The authors of KIP and LS techniques <a href="https://arxiv.org/abs/2011.00050">18</a> explore how to scale and accelerate the distillation process to apply these techniques to infinitely wide convolutional networks <a href="https://arxiv.org/abs/2107.13034">20</a>. Their results are very promising (see fig 14).</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/KIP_ConvNet.jpeg> <em>Figure 14: KIP ConvNet results <a href="https://arxiv.org/abs/2107.13034">20</a>.</em></p> </blockquote> <p>A visual inspection into the distilled dataset from the infinite width CNN-based KIP technique is shown in fig 15. The distillation results are curious, to say the least. In the example, the distilled apple image seems to represent a pile of apples whereas the bottle distilled results into visibly different bottles while still showing artifacts of the original two bottles. While other classes show high order features (with some noise). </p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/example_kip_infinite_width_kernel.jpeg> <em>Figure 15: KIP ConvNet example of distilled CIFAR set <a href="https://arxiv.org/abs/2107.13034">20</a>.</em></p> </blockquote> <p>Figure 16 shows MNIST results, they are not only very interesting but also look very much like mixup (where x and y both are mixed).</p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/KIP_Infi_MNIST.jpeg> <em>Figure 16: KIP ConvNet example of distilled MNIST set <a href="https://arxiv.org/abs/2107.13034">20</a>.</em></p> </blockquote> <h3 id=3-so-what-if-you-have-noisy-data><a class=toclink href=../../2021/12/31/data-in-deep-learning/#3-so-what-if-you-have-noisy-data>3. So what if you have noisy data</a></h3> <p>Noises in the dataset are considered a nuisance. Because models hold the compressed form of knowledge represented by the dataset, dataset curation techniques carefully look to avoid noises in datasets. </p> <p>Noises can be an incredibly powerful technique to fill in the missing information in source/images. For instance, if only part of an image is known then instead of padding the image with default (0 or 1-pixel value), filling in using random noise can be an effective technique avoiding confusion on actual real values that relate to the black or white region. This has held true in my own experience. It was very amusing to note that the forgetting event study <a href="https://arxiv.org/abs/1812.05159">14</a> in fact looked into adding label noise on the distribution of forgetting events. They added noise in pixel values and observed that adding an increasing amount of noise decreases the number of unforgettable samples (see also figure 7 for their results when noise was used). </p> <p>Noise coming from randomness is handled very well by DL networks as well. I find the result from <a href="https://arxiv.org/abs/2111.06377">22</a>, shown in figure 17 quite fascinating actually. Looking at how well the model is doing when missing patches are random and how poor it is doing when missing patches are systematic is indicative of how powerful and lame (both at the same time) machines are! </p> <blockquote> <p><img alt src=../../../resources/data-centric-ai/masked_autoencoder_noisy_patches.jpeg> <em>Figure 17: Noisy patches in Masked-AutoEncoder <a href="https://arxiv.org/abs/2111.06377">22</a>.</em></p> </blockquote> <p>GradND study <a href="https://arxiv.org/abs/2107.07075">21</a>, looked into the effect of noise on the source itself and performed a series of experiments to conclude that when there is enough data, keeping the high score examples, which are often noisy or difficult, does not hurt performance and can only help.</p> <h2 id=conclusion><a class=toclink href=../../2021/12/31/data-in-deep-learning/#conclusion>Conclusion</a></h2> <p>In summary, the last four years have been incredibly exciting for data in DL space and the year 2021 even more! There is a lot of mileage we can get out of simpler techniques like MixUp but more exciting developments are dissecting the training dynamics and exploring the importance of samples in solving a particular task using DL techniques. Distillation methods are still in the early stages where they work well for simpler datasets but honestly how many real-world problems have simple datasets? Nevertheless, some really exciting development in this space. These techniques can be groundbreaking if the compression methods hold across a wide range of architectures as indicated by <a href="https://arxiv.org/abs/2107.07075">21</a>. </p> <h2 id=references><a class=toclink href=../../2021/12/31/data-in-deep-learning/#references>References</a></h2> <ol> <li>[1707.02968] Revisiting Unreasonable Effectiveness of Data in Deep Learning Era.” Accessed January 3, 2022. <a href="https://arxiv.org/abs/1707.02968">https://arxiv.org/abs/1707.02968</a>.</li> <li>Hestness, Joel, Sharan Narang, Newsha Ardalani, Gregory Diamos, Heewoo Jun, Hassan Kianinejad, Md Mostofa Ali Patwary, Yang Yang, and Yanqi Zhou. “Deep Learning Scaling Is Predictable, Empirically,” December 2017. <a href="https://arxiv.org/abs/1712.00409">https://arxiv.org/abs/1712.00409</a>.</li> <li><a href="https://www.wired.com/story/no-data-is-not-the-new-oil/">https://www.wired.com/story/no-data-is-not-the-new-oil/</a></li> <li><a href="https://pages.run.ai/hubfs/PDFs/2021-State-of-AI-Infrastructure-Survey.pdf">https://pages.run.ai/hubfs/PDFs/2021-State-of-AI-Infrastructure-Survey.pdf</a></li> <li>[1808.01974] A Survey on Deep Transfer Learning. Accessed January 5, 2022. <a href="https://arxiv.org/abs/1808.01974">https://arxiv.org/abs/1808.01974</a>.</li> <li>Transfer Learning. <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.146.1515&amp;rep=rep1&amp;type=pdf">http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.146.1515&amp;rep=rep1&amp;type=pdf</a></li> <li>Zhang, Hongyi, Moustapha Cisse, Yann N. Dauphin, and David Lopez-Paz. “Mixup: Beyond Empirical Risk Minimization,” October 2017. <a href="https://arxiv.org/abs/1710.09412">https://arxiv.org/abs/1710.09412</a>.</li> <li>[1812.01187] Bag of Tricks for Image Classification with Convolutional Neural Networks. Accessed December 30, 2021. <a href="https://arxiv.org/abs/1812.01187">https://arxiv.org/abs/1812.01187</a>.</li> <li>[2009.08449] 'Less Than One'-Shot Learning: Learning N Classes From M &lt; N Samples. Accessed January 5, 2022. <a href="https://arxiv.org/abs/2009.08449">https://arxiv.org/abs/2009.08449</a>.</li> <li>[1512.00567] Rethinking the Inception Architecture for Computer Vision. Accessed January 5, 2022. <a href="https://arxiv.org/abs/1512.00567">https://arxiv.org/abs/1512.00567</a>.</li> <li>[1904.05046] Generalizing from a Few Examples: A Survey on Few-Shot Learning. Accessed January 5, 2022. <a href="https://arxiv.org/abs/1904.05046">https://arxiv.org/abs/1904.05046</a>.</li> <li>Li Fei-Fei, R. Fergus and P. Perona, "One-shot learning of object categories," in IEEE Transactions on Pattern Analysis and Machine Intelligence, vol. 28, no. 4, pp. 594–611, April 2006, doi: 10.1109/TPAMI.2006.79. <a href="https://ieeexplore.ieee.org/document/1597116">https://ieeexplore.ieee.org/document/1597116</a></li> <li>[1606.04080] Matching Networks for One Shot Learning. Accessed January 5, 2022. <a href="https://arxiv.org/abs/1606.04080">https://arxiv.org/abs/1606.04080</a>.</li> <li>[1812.05159] An Empirical Study of Example Forgetting during Deep Neural Network Learning. Accessed December 29, 2021. <a href="https://arxiv.org/abs/1812.05159">https://arxiv.org/abs/1812.05159</a>.</li> <li>[1906.11829] Selection via Proxy: Efficient Data Selection for Deep Learning. Accessed December 29, 2021. <a href="https://arxiv.org/abs/1906.11829">https://arxiv.org/abs/1906.11829</a>.</li> <li>[2102.08259] Dataset Condensation with Differentiable Siamese Augmentation. Accessed January 5, 2022. <a href="https://arxiv.org/abs/2102.08259">https://arxiv.org/abs/2102.08259</a>.</li> <li>[1811.10959] Dataset Distillation. Accessed January 5, 2022. <a href="https://arxiv.org/abs/1811.10959">https://arxiv.org/abs/1811.10959</a>.</li> <li>[2011.00050] Dataset Meta-Learning from Kernel Ridge-Regression. Accessed January 5, 2022. <a href="https://arxiv.org/abs/2011.00050">https://arxiv.org/abs/2011.00050</a>.</li> <li>[2006.05929] Dataset Condensation with Gradient Matching. Accessed January 5, 2022. <a href="https://arxiv.org/abs/2006.05929">https://arxiv.org/abs/2006.05929</a>.</li> <li>[2107.13034] Dataset Distillation with Infinitely Wide Convolutional Networks. Accessed January 5, 2022. <a href="https://arxiv.org/abs/2107.13034">https://arxiv.org/abs/2107.13034</a>.</li> <li>[2107.07075] Deep Learning on a Data Diet: Finding Important Examples Early in Training. Accessed December 10, 2021. <a href="https://arxiv.org/abs/2107.07075">https://arxiv.org/abs/2107.07075</a>.</li> <li>[2111.06377] Masked Autoencoders Are Scalable Vision Learners. Accessed January 5, 2022. <a href="https://arxiv.org/abs/2111.06377">https://arxiv.org/abs/2111.06377</a>.</li> <li>[1802.03426] UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction. Accessed January 5, 2022. 23. <a href="https://arxiv.org/abs/1802.03426">https://arxiv.org/abs/1802.03426</a>.</li> <li>Maaten, Laurens van der and Geoffrey E. Hinton. "Visualizing Data using t-SNE." Journal of Machine Learning Research 9 (2008): 2579–2605. <a href="https://www.jmlr.org/papers/volume9/vandermaaten08a/vandermaaten08a.pdf">https://www.jmlr.org/papers/volume9/vandermaaten08a/vandermaaten08a.pdf</a></li> <li>[2107.02331] Mind Your Outliers! Investigating the Negative Impact of Outliers on Active Learning for Visual Question Answering.” Accessed January 8, 2022. <a href="https://arxiv.org/abs/2107.02331">https://arxiv.org/abs/2107.02331</a></li> </ol> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=/resources/me.png alt="Suneeta Mall"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2019-12-23 00:00:00">December 23, 2019</time></li> <li class=md-meta__item> in <a href=./ class=md-meta__link>Machine Learning</a>, <a href=../ai/ class=md-meta__link>AI</a>, <a href=../kubernetes/ class=md-meta__link>Kubernetes</a>, <a href=../reproducible-ml/ class=md-meta__link>Reproducible-ml</a></li> <li class=md-meta__item> 6 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=end-to-end-reproducible-machine-learning-pipelines-on-kubernetes><a href=../../2019/12/23/end-to-end-reproducible-machine-learning-pipelines-on-kubernetes/ class=toclink>End-to-end reproducible Machine Learning pipelines on Kubernetes</a></h2> <p>This is <a href=/2019/12/23/Reproducible-ml-pipeline-k8s.html>Part 3</a> - <strong>End-to-end reproducible Machine Learning pipelines on Kubernetes</strong> of technical blog series titled [Reproducibility in Machine Learning]. <a href=/2019/12/21/Reproducible-ml-research-n-industry.html>Part 1</a> &amp; <a href=/2019/12/22/Reproducible-ml-tensorflow.html>Part 2</a> can be found <a href=/2019/12/21/Reproducible-ml-research-n-industry.html>here</a> &amp; <a href=/2019/12/22/Reproducible-ml-tensorflow.html>here</a> respectively.</p> <hr> <p><strong>C</strong>hange <strong>A</strong>nything <strong>C</strong>hanges <strong>E</strong>verything (CAKE) principle <sub>-[Scully et al][scully_2015]</sub> is real in ML. Also, 100% reproducible ML code comes at a cost of speed - a non-negotiable aspect in today's time. If we cannot be 100% and change is evident, then the only way to maintaining explainability, understanding, trust &amp; confidence is through version control everything. </p> <blockquote> <p><img alt src=../../../resources/git_2x.png> <em>Figure 1: Version control explained by <a href="https://xkcd.com/1597/">XKCD</a></em></p> </blockquote> <p>In this post, we will be looking at building an end to end fully automated ML pipeline that can maintain full provenance across the entire ML system. In my view, a standard machine learning workflow looks like the one below: </p> <blockquote> <p><img alt src=../../../resources/ai-workflow.jpg> <em>Figure 2: Machine Learning end to end system</em></p> </blockquote> <p>So we will be working towards building this system with full provenance over it. For this, we will be extending <a href="https://github.com/suneeta-mall/e2e-ml-on-k8s">our sample semantic segmentation example</a> based on <a href="https://www.robots.ox.ac.uk/~vgg/data/pets/">Oxford Pet dataset</a> </p> <p>To build this ML workflow, we will be using <a href="https://kubernetes.io/">Kubernetes</a> - a container orchestration platform. On top of <a href="https://kubernetes.io/">Kubernetes</a>, we will be running <a href="https://github.com/pachyderm/pachyderm">Pachyderm</a> software that will do the heavy lifting of maintaining provenance across data, artifacts, and ml processes.</p> <h3 id=what-to-version-control><a class=toclink href=../../2019/12/23/end-to-end-reproducible-machine-learning-pipelines-on-kubernetes/#what-to-version-control>What to version control</a></h3> <p>In <a href=/2019/12/21/Reproducible-ml-research-n-industry.html>part 1</a> of this blog series, we discussed above the challenges, shown in figure 3, in realizing reproducible ML.</p> <p><img alt src=../../../resources/reproducible-challenge.jpeg> <em>Figure 3: Overview of challenges in reproducible ML</em></p> <p>The presence of these challenges in the system-wide view of ML is shown in figure 4.</p> <p><img alt src=../../../resources/what-t--vcs.jpg> <em>Figure 4: What to version control?</em></p> <p>But first, let's talk about creating the environment, infrastructure, and versioning it. </p> <h4 id=1-versioning-environment><a class=toclink href=../../2019/12/23/end-to-end-reproducible-machine-learning-pipelines-on-kubernetes/#1-versioning-environment>1. Versioning environment</a></h4> <p>Using <a href="https://www.weave.works/technologies/gitops/">gitops</a> environment and any changes associated with it can be version controlled. In this sample, we will be using <a href="https://argoproj.github.io/argo-cd/">ArgoCD</a> to implement GitOps workflow (figure 5) which will see our environment config moved to be alongside the code repository (figure 6). </p> <p><img alt src=../../../resources/gitops.png> <em>Figure 5: Gitops</em></p> <p>This is achieved by defining <a href="https://raw.githubusercontent.com/suneeta-mall/e2e-ml-on-k8s/master/cluster-conf/e2e-ml-argocd-app.yaml">argo apps</a> which can be applied on BYO Kubernetes cluster (version 1.14.7) that has ArgoCD installed:</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>apply<span class=w> </span>–f<span class=w> </span>https://raw.githubusercontent.com/suneeta-mall/e2e-ml-on-k8s/master/cluster-conf/e2e-ml-argocd-app.yaml
</code></pre></div> <p><img alt src=../../../resources/env-as-code.jpg> <em>Figure 6: Gitops on environment config</em></p> <p>Once the Argo apps are created, the following software will be installed on the cluster: - Kubernetes: 1.14.7 (tested on this version, in theory, should work with other versions too!) - ArgoCD: 1.2.3 - Kubeflow: 0.6.2</p> <blockquote> <p>Kubeflow is an ML toolkit designed to bring a variety of ML related <a href="https://kubernetes.io">Kubernetes</a> based software together. - Seldon 0.4.1 (upgraded from packaged version on kubeflow 0.6.2) Seldon is a model serving software - Pachyderm: 1.9.7 Pachyderm offers a git like a repository that can hold data even big data. It also offers automated repository capability that <code>act</code> on input and generate data thus holding a versioned copy of this generated data. Together with these constructs, it can be used to create pipeline DAG like processes with provenance across graph input, transformation spec, output</p> </blockquote> <p>Any change on this configuration repository will then trigger a cluster update keeping environment in synced with versioned config. </p> <h4 id=2-versioning-data-process-and-artifacts><a class=toclink href=../../2019/12/23/end-to-end-reproducible-machine-learning-pipelines-on-kubernetes/#2-versioning-data-process-and-artifacts>2. Versioning data, process, and artifacts</a></h4> <p><img alt src=../../../resources/artifact.jpg> <em>Figure 7: Artifact view of Machine Learning end to end system (shown in figure 2)</em></p> <p>Pachyderm pipeline specification for an end to end ML workflow capability shown in figure 2 is available <a href="https://github.com/suneeta-mall/e2e-ml-on-k8s/blob/master/cluster-conf/k8s/ml-workflow/pachyderm-specs.yaml">here</a>. The generated artifacts/data as a result of this ML workflow is shown in figure 7 above. These artifacts and their association with other processes are also highlighted in figure 7. </p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>pipeline</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">stream</span>
<span class=nt>transform</span><span class=p>:</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">suneetamall/pykubectl:1.14.7</span>
<span class=w>  </span><span class=nt>cmd</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;/bin/bash&quot;</span>
<span class=w>  </span><span class=nt>stdin</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;wget</span><span class=nv> </span><span class=s>-O</span><span class=nv> </span><span class=s>images.tar.gz</span><span class=nv> </span><span class=s>https://www.robots.ox.ac.uk/~vgg/data/pets/data/images.tar.gz</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>\</span>
<span class=w>     </span><span class=s>wget</span><span class=nv> </span><span class=s>-O</span><span class=nv> </span><span class=s>annotations.tar.gz</span><span class=nv> </span><span class=s>https://www.robots.ox.ac.uk/~vgg/data/pets/data/annotations.tar.gz</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>\</span>
<span class=w>     </span><span class=s>tar</span><span class=nv> </span><span class=s>-cvf</span><span class=nv> </span><span class=s>data.tar.gz</span><span class=nv> </span><span class=s>*.tar.gz</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>\</span>
<span class=w>     </span><span class=s>cat</span><span class=nv> </span><span class=s>data.tar.gz</span><span class=nv> </span><span class=s>&gt;</span><span class=nv> </span><span class=s>/pfs/out</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>\</span>
<span class=w>     </span><span class=s>while</span><span class=nv> </span><span class=s>:;</span><span class=nv> </span><span class=s>do</span><span class=nv> </span><span class=s>sleep</span><span class=nv> </span><span class=s>2073600;</span><span class=nv> </span><span class=s>done&quot;</span>
<span class=nt>spout</span><span class=p>:</span>
<span class=w>  </span><span class=nt>overwrite</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nn>---</span>
<span class=nt>input</span><span class=p>:</span>
<span class=w>  </span><span class=nt>pfs</span><span class=p>:</span>
<span class=w>    </span><span class=nt>glob</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class=w>    </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">stream</span>
<span class=nt>pipeline</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warehouse</span>
<span class=nt>transform</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cmd</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;/bin/bash&quot;</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">suneetamall/e2e-ml-on-k8s:1</span>
<span class=w>  </span><span class=nt>stdin</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;python</span><span class=nv> </span><span class=s>download_petset.py</span><span class=nv> </span><span class=s>--input</span><span class=nv> </span><span class=s>/pfs/stream/</span><span class=nv> </span><span class=s>--output</span><span class=nv> </span><span class=s>/pfs/out&quot;</span>
<span class=nt>datum_tries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class=c1>#standby: true</span>
<span class=nn>---</span>
<span class=nt>input</span><span class=p>:</span>
<span class=w>  </span><span class=nt>pfs</span><span class=p>:</span>
<span class=w>    </span><span class=nt>glob</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/&quot;</span>
<span class=w>    </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warehouse</span>
<span class=nt>pipeline</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">transform</span>
<span class=nt>transform</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cmd</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;/bin/bash&quot;</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">suneetamall/e2e-ml-on-k8s:1</span>
<span class=w>  </span><span class=nt>stdin</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;python</span><span class=nv> </span><span class=s>dataset_gen.py</span><span class=nv> </span><span class=s>--input</span><span class=nv> </span><span class=s>/pfs/warehouse</span><span class=nv> </span><span class=s>--output</span><span class=nv> </span><span class=s>/pfs/out&quot;</span>
<span class=nt>datum_tries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class=c1>#standby: true</span>
<span class=nn>---</span>
<span class=nt>input</span><span class=p>:</span>
<span class=w>  </span><span class=nt>pfs</span><span class=p>:</span>
<span class=w>    </span><span class=nt>glob</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/&quot;</span>
<span class=w>    </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">transform</span>
<span class=nt>pipeline</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">train</span>
<span class=nt>transform</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cmd</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;/bin/bash&quot;</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">suneetamall/e2e-ml-on-k8s:1</span>
<span class=w>  </span><span class=nt>stdin</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;python</span><span class=nv> </span><span class=s>train.py</span><span class=nv> </span><span class=s>--input</span><span class=nv> </span><span class=s>/pfs/transform</span><span class=nv> </span><span class=s>--output</span><span class=nv> </span><span class=s>/pfs/out</span><span class=nv> </span><span class=s>--checkpoint_path</span><span class=nv> </span><span class=s>/pfs/out/ckpts</span><span class=nv> </span><span class=s>--tensorboard_path</span><span class=nv> </span><span class=s>/pfs/out&quot;</span>
<span class=nt>resource_requests</span><span class=p>:</span>
<span class=w>  </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2G</span>
<span class=c1>#  gpu:</span>
<span class=c1>#    type: nvidia.com/gpu</span>
<span class=c1>#    number: 1</span>
<span class=nt>datum_tries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class=c1>#standby: true</span>
<span class=nn>---</span>
<span class=nt>input</span><span class=p>:</span>
<span class=w>  </span><span class=nt>pfs</span><span class=p>:</span>
<span class=w>    </span><span class=nt>glob</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/&quot;</span>
<span class=w>    </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">transform</span>
<span class=nt>pipeline</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tune</span>
<span class=nt>transform</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cmd</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;/bin/bash&quot;</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">suneetamall/e2e-ml-on-k8s:1</span>
<span class=w>  </span><span class=nt>stdin</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;python</span><span class=nv> </span><span class=s>tune.py</span><span class=nv> </span><span class=s>--input</span><span class=nv> </span><span class=s>/pfs/transform</span><span class=nv> </span><span class=s>--output</span><span class=nv> </span><span class=s>/pfs/out&quot;</span>
<span class=nt>resource_requests</span><span class=p>:</span>
<span class=w>  </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">4G</span>
<span class=w>  </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class=c1>#  gpu:</span>
<span class=c1>#    type: nvidia.com/gpu</span>
<span class=c1>#    number: 1</span>
<span class=nt>datum_tries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class=c1>#standby: true</span>
<span class=nn>---</span>
<span class=nt>input</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cross</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>pfs</span><span class=p>:</span>
<span class=w>       </span><span class=nt>glob</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/&quot;</span>
<span class=w>       </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">transform</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>pfs</span><span class=p>:</span>
<span class=w>        </span><span class=nt>glob</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/optimal_hp.json&quot;</span>
<span class=w>        </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tune</span>
<span class=nt>pipeline</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model</span>
<span class=nt>transform</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cmd</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;/bin/bash&quot;</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">suneetamall/e2e-ml-on-k8s:1</span>
<span class=w>  </span><span class=nt>stdin</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;python</span><span class=nv> </span><span class=s>train.py</span><span class=nv> </span><span class=s>--input</span><span class=nv> </span><span class=s>/pfs/transform</span><span class=nv> </span><span class=s>--hyperparam_fn_path</span><span class=nv> </span><span class=s>/pfs/tune/optimal_hp.json</span>
<span class=w>     </span><span class=s>--output</span><span class=nv> </span><span class=s>/pfs/out</span><span class=nv> </span><span class=s>--checkpoint_path</span><span class=nv> </span><span class=s>/pfs/out/ckpts</span><span class=nv> </span><span class=s>--tensorboard_path</span><span class=nv> </span><span class=s>/pfs/out&quot;</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;ln</span><span class=nv> </span><span class=s>-s</span><span class=nv> </span><span class=s>/pfs/tune/optimal_hp.json</span><span class=nv> </span><span class=s>/pfs/out/optimal_hp.json&quot;</span>
<span class=nt>resource_requests</span><span class=p>:</span>
<span class=w>  </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2G</span>
<span class=c1>#  gpu:</span>
<span class=c1>#    type: nvidia.com/gpu</span>
<span class=c1>#    number: 1</span>
<span class=nt>datum_tries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class=c1>#standby: true</span>
<span class=nn>---</span>
<span class=nt>input</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cross</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>pfs</span><span class=p>:</span>
<span class=w>       </span><span class=nt>glob</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/calibration&quot;</span>
<span class=w>       </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">transform</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>pfs</span><span class=p>:</span>
<span class=w>        </span><span class=nt>glob</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/model.h5&quot;</span>
<span class=w>        </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model</span>
<span class=nt>pipeline</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">calibrate</span>
<span class=nt>transform</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cmd</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;/bin/bash&quot;</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">suneetamall/e2e-ml-on-k8s:1</span>
<span class=w>  </span><span class=nt>stdin</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;python</span><span class=nv> </span><span class=s>calibrate.py</span><span class=nv> </span><span class=s>--input</span><span class=nv> </span><span class=s>/pfs/transform</span><span class=nv> </span><span class=s>--model_weight</span><span class=nv> </span><span class=s>/pfs/model/model.h5</span><span class=nv> </span><span class=s>--output</span><span class=nv> </span><span class=s>/pfs/out&quot;</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;ln</span><span class=nv> </span><span class=s>-s</span><span class=nv> </span><span class=s>/pfs/model/model.h5</span><span class=nv> </span><span class=s>/pfs/out/model.h5&quot;</span>
<span class=nt>datum_tries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class=c1>#standby: true</span>
<span class=nn>---</span>
<span class=nt>input</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cross</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>pfs</span><span class=p>:</span>
<span class=w>       </span><span class=nt>glob</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/test&quot;</span>
<span class=w>       </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">transform</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>pfs</span><span class=p>:</span>
<span class=w>        </span><span class=nt>glob</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/&quot;</span>
<span class=w>        </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">calibrate</span>
<span class=nt>pipeline</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">evaluate</span>
<span class=nt>transform</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cmd</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;/bin/bash&quot;</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">suneetamall/e2e-ml-on-k8s:1</span>
<span class=w>  </span><span class=nt>stdin</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;papermill</span><span class=nv> </span><span class=s>evaluate.ipynb</span><span class=nv> </span><span class=s>/pfs/out/Report.ipynb</span><span class=nv> </span><span class=s>\</span>
<span class=w>      </span><span class=s>-p</span><span class=nv> </span><span class=s>model_weights</span><span class=nv> </span><span class=s>/pfs/calibrate/model.h5</span><span class=nv> </span><span class=s>\</span>
<span class=w>      </span><span class=s>-p</span><span class=nv> </span><span class=s>calibration_weights</span><span class=nv> </span><span class=s>/pfs/calibrate/calibration.weights</span><span class=nv> </span><span class=s>\</span>
<span class=w>      </span><span class=s>-p</span><span class=nv> </span><span class=s>input_data_dir</span><span class=nv> </span><span class=s>/pfs/transform</span><span class=nv> </span><span class=s>\</span>
<span class=w>      </span><span class=s>-p</span><span class=nv> </span><span class=s>out_dir</span><span class=nv> </span><span class=s>/pfs/out</span><span class=nv> </span><span class=s>\</span>
<span class=w>      </span><span class=s>-p</span><span class=nv> </span><span class=s>hyperparameters</span><span class=nv> </span><span class=s>/pfs/calibrate/optimal_hp.json&quot;</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;ln</span><span class=nv> </span><span class=s>-s</span><span class=nv> </span><span class=s>/pfs/calibrate/model.h5</span><span class=nv> </span><span class=s>/pfs/out/model.h5&quot;</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;ln</span><span class=nv> </span><span class=s>-s</span><span class=nv> </span><span class=s>/pfs/calibrate/calibration.weights</span><span class=nv> </span><span class=s>/pfs/out/calibration.weights&quot;</span>
<span class=nt>resource_requests</span><span class=p>:</span>
<span class=w>  </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
<span class=nt>datum_tries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class=c1>#standby: true</span>
<span class=nn>---</span>
<span class=nt>input</span><span class=p>:</span>
<span class=w>  </span><span class=nt>pfs</span><span class=p>:</span>
<span class=w>    </span><span class=nt>glob</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/&quot;</span>
<span class=w>    </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">evaluate</span>
<span class=nt>pipeline</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">release</span>
<span class=nt>transform</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cmd</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;/bin/bash&quot;</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">suneetamall/e2e-ml-on-k8s:1</span>
<span class=w>  </span><span class=nt>stdin</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;python</span><span class=nv> </span><span class=s>release.py</span><span class=nv> </span><span class=s>--model_db</span><span class=nv> </span><span class=s>evaluate</span><span class=nv> </span><span class=s>--input</span><span class=nv> </span><span class=s>/pfs/evaluate/evaluation_result.csv</span><span class=nv> </span><span class=s>--version</span><span class=nv> </span><span class=s>${evaluate_COMMIT}&quot;</span>
<span class=nt>pod_spec</span><span class=p>:</span><span class=w> </span><span class=s>&#39;{&quot;serviceAccount&quot;:</span><span class=nv> </span><span class=s>&quot;ml-user&quot;,</span><span class=nv> </span><span class=s>&quot;serviceAccountName&quot;:</span><span class=nv> </span><span class=s>&quot;ml-user&quot;}&#39;</span>
<span class=nt>datum_tries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class=c1>#standby: true</span>
<span class=nn>---</span>
<span class=c1>## Service https://docs.pachyderm.io/en/1/concepts/pipeline-concepts/pipeline/service.html</span>
<span class=nt>input</span><span class=p>:</span>
<span class=w>  </span><span class=nt>pfs</span><span class=p>:</span>
<span class=w>    </span><span class=nt>glob</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/&quot;</span>
<span class=w>    </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model</span>
<span class=nt>pipeline</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tensorboard</span>
<span class=nt>service</span><span class=p>:</span>
<span class=w>  </span><span class=nt>external_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30888</span>
<span class=w>  </span><span class=nt>internal_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">6006</span>
<span class=nt>transform</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cmd</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;/bin/bash&quot;</span>
<span class=w>  </span><span class=nt>stdin</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tensorboard --logdir=/pfs/model/</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">suneetamall/e2e-ml-on-k8s:1</span>
<span class=nn>---</span>
</code></pre></div> <p>This pipeline creates ML workflow, with artifact dependency shown in above figure 7, wherein full provenance across data, processes, and outcomes are maintained along with respective lineage. </p> <hr> <p>This is the last post of the technical blog series, [Reproducibility in Machine Learning]. </p> <p>[Reproducibility in Machine Learning]: /2019/12/20/Reproducibility-in-Machine Learning.html</p> <p>[scully_2015]: https://papers.nips.cc/paper/5656-hidden-technical-debt-in-Machine Learning-systems.pdf</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=/resources/me.png alt="Suneeta Mall"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2019-12-23 00:00:00">December 23, 2019</time></li> <li class=md-meta__item> in <a href=./ class=md-meta__link>Machine Learning</a>, <a href=../ai/ class=md-meta__link>AI</a>, <a href=../kubernetes/ class=md-meta__link>Kubernetes</a>, <a href=../reproducible-ml/ class=md-meta__link>Reproducible-ml</a></li> <li class=md-meta__item> 1 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=replicability-an-extension-to-reproducibility><a href=../../2019/12/23/replicability---an-extension-to-reproducibility/ class=toclink>Replicability - an extension to reproducibility</a></h2> <p>This is <a href=/2019/12/23/Reproducible-ml-pipeline-k8s.html>Part 3</a> - <strong>End-to-end reproducible Machine Learning pipelines on Kubernetes</strong> of technical blog series titled [Reproducibility in Machine Learning]. <a href=/2019/12/21/Reproducible-ml-research-n-industry.html>Part 1</a> &amp; <a href=/2019/12/22/Reproducible-ml-tensorflow.html>Part 2</a> can be found <a href=/2019/12/21/Reproducible-ml-research-n-industry.html>here</a> &amp; <a href=/2019/12/22/Reproducible-ml-tensorflow.html>here</a> respectively.</p> <h3 id=part-1-reproducibility-in-machine-learning-research-and-industry><a class=toclink href=../../2019/12/23/replicability---an-extension-to-reproducibility/#part-1-reproducibility-in-machine-learning-research-and-industry>Part 1: Reproducibility in Machine Learning - Research and Industry</a></h3> <h3 id=replicability-and><a class=toclink href=../../2019/12/23/replicability---an-extension-to-reproducibility/#replicability-and>Replicability and</a></h3> <p>The research community is quite divided when it comes to defining reproducibility and often mixes it up with replicability </p> <p><img alt src=../../../resources/replicable.jpeg> <em>Figure 4: Replicability defined</em></p> <p>[Reproducibility in Machine Learning]: /2019/12/20/Reproducibility-in-Machine Learning.html</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=/resources/me.png alt="Suneeta Mall"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2019-12-22 00:00:00">December 22, 2019</time></li> <li class=md-meta__item> in <a href=./ class=md-meta__link>Machine Learning</a>, <a href=../ai/ class=md-meta__link>AI</a>, <a href=../reproducible-ml/ class=md-meta__link>Reproducible-ml</a></li> <li class=md-meta__item> 13 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=realizing-reproducible-machine-learning-with-tensorflow><a href=../../2019/12/22/reproducible-ml-with-tensorflow/ class=toclink>Realizing reproducible Machine Learning - with Tensorflow</a></h2> <p>This is <a href=/2019/12/22/Reproducible-ml-tensorflow.html>Part 2</a> - <strong>Realizing reproducible Machine Learning - with Tensorflow</strong> of technical blog series titled [Reproducibility in Machine Learning]. <a href=/2019/12/21/Reproducible-ml-research-n-industry.html>Part 1</a> &amp; <a href=/2019/12/23/Reproducible-ml-pipeline-k8s.html>Part 3</a> can be found <a href=/2019/12/21/Reproducible-ml-research-n-industry.html>here</a> &amp; <a href=/2019/12/23/Reproducible-ml-pipeline-k8s.html>here</a> respectively. </p> <hr> <p>As discussed in <a href=/2019/12/21/Reproducible-ml-research-n-industry.html>Part 1</a>, writing reproducible machine learning is not easy with challenges arising from every direction e.g. hardware, software, algorithms, process &amp; practice, data. In this post, we will focus on what is needed to ensure ML code is reproducible.</p> <h3 id=first-things-first><a class=toclink href=../../2019/12/22/reproducible-ml-with-tensorflow/#first-things-first>First things first</a></h3> <p>There are a few very simple things that are needed to be done before <em>thinking big</em> and focussing on writing reproducible ML code. These are:</p> <ul> <li>Code is version controlled</li> </ul> <blockquote> <p>Same input (data), same process (code) resulting in the same output is the essence of reproducibility. But code keeps evolving, since ML is so iterative. Hence, it's important to version control code (including configuration). This allows obtaining the same i.e. exact code (commit/version) from the source repository. </p> </blockquote> <ul> <li>Reproducible runtime – pinned libraries </li> </ul> <blockquote> <p>So we version-controlled code but what about environment/runtime? Sometimes, non-determinism is introduced not direct by user code but also dependencies. We talked about this at length in the software section of <code>Challenges in realizing reproducible ML</code> in <a href=/2019/12/21/Reproducible-ml-research-n-industry.html>Part 1</a>. Taking the example of Pyproj - a geospatial transform library, that I once used to compute geo-location-based on some parameters. We changed nothing but just a version of pyproj from V1.9.6 to V2.4.0 and suddenly all our calculations were giving different results. The difference was so much that location calculation for San Diego Convention Centre was coming out to be somewhere in Miramar off golf course (see figure 1) <a href="https://github.com/pyproj4/pyproj/issues/470">issue link</a>. Now imagine ordering pizza delivery on the back of my computation snippet backed with an unpinned version of pyproj? </p> </blockquote> <p><img alt src=../../../resources/proj-bug.png> <em>Figure 1: Example of why pinned libraries are important</em></p> <blockquote> <p>Challenges like these occur quite often that we would like. That's why it's important to pin/fix dependent runtime either by pinning version of libraries or using versioned containers (like <a href="https://www.docker.com/">docker</a>). </p> </blockquote> <ul> <li>Smart randomness</li> </ul> <blockquote> <p>As discussed in <a href=/2019/12/21/Reproducible-ml-research-n-industry.html>Part 1</a>, randomization plays a key role in most ML algorithms. Unseeded randomness is the simplest way to make code non-reproducible. It is also one of the easiest to manage amongst all things gotchas of non-reproducible ML. All we need to do is seed all the randomness and manage the seed via configuration (as code or external). </p> </blockquote> <ul> <li>Rounding precision, under-flows &amp; overflow</li> </ul> <blockquote> <p><a href=//docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html>Floating point</a> arithmetic is ubiquitous in ML. The complexity and intensity of floating-point operations (FLOPS) are increasing every day with current needs easily meeting <a href="https://github.com/albanie/convnet-burden">Giga-Flops</a> order of computations. To achieve efficiency in terms of speed despite the complexity, <a href="https://arxiv.org/pdf/1710.03740.pdf">mixed precision</a> floating-point operations have also been proposed. As discussed <a href=/2019/12/21/Reproducible-ml-research-n-industry.html>Part 1</a>, accelerated hardware such as <a href="https://en.wikipedia.org/wiki/General-purpose_computing_on_graphics_processing_units">(GPGPU)</a>, tensor processing unit <a href="https://en.wikipedia.org/wiki/Tensor_processing_unit">(TPU)</a>, etc. due to their architecture and asynchronous computing do not guarantee reproducibility. Besides, when dealing with floating points, the issues related to <a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X0800800207">overflow and underflow</a> are expected. This just adds to the complexity. </p> </blockquote> <ul> <li>Dependent library's behavior aware </li> </ul> <blockquote> <p>As discussed in the software section of <code>Challenges in realizing reproducible ML</code> in <a href=/2019/12/21/Reproducible-ml-research-n-industry.html>Part 1</a>, some routines of ML libraries do not guarantee reproducibility. For instance, NVIDIA's CUDA based deep learning library <a href="https://docs.nvidia.com/deeplearning/sdk/cudnn-developer-guide/index.html#reproducibility">cudnn</a>. Similarly, with Tensorflow, using some methods may result in non-deterministic behavior. One such example is backward pass of broadcasting on GPU<sup><a href="https://github.com/tensorflow/tensorflow/issues/2652">ref</a></sup>. Awareness about behaviors of libraries being used and approaches to overcome the non-determinism should be explored. </p> </blockquote> <h3 id=writing-reproducible-ml><a class=toclink href=../../2019/12/22/reproducible-ml-with-tensorflow/#writing-reproducible-ml>Writing reproducible ML</a></h3> <p>To demonstrate reproducible ML, I will be using <a href="https://www.robots.ox.ac.uk/~vgg/data/pets/">Oxford Pet dataset</a> that has labels for pet images. I will be doing a semantic segmentation of pets images and will be using pixel-level labeling. Each pixel of the pet image in <a href="https://www.robots.ox.ac.uk/~vgg/data/pets/">Oxford Pet dataset</a> is labeled as 1) Foreground (Pet area), 2) Background (not pet area) and 3) Unknown (edges). These labels by definition are mutually exclusive - i.e. a pixel can only be one of the above 3. </p> <blockquote> <p><img alt src=../../../resources/oxford-petset.png> <em>Figure 2: Oxford pet dataset</em></p> </blockquote> <p>I will be using a convolution neural network (ConvNet) for semantic segmentation. The network architecture is based on <a href="https://arxiv.org/abs/1505.04597">U-net</a>. This is similar to standard semantic segmentation example by <a href="https://www.tensorflow.org/tutorials../../resources/segmentation">tensorflow</a>. </p> <blockquote> <p><img alt src=../../../resources/unet.jpg> <em>Fihure 3: <a href="https://arxiv.org/abs/1505.04597">U-net</a> architecture</em></p> </blockquote> <p>The reproducible version of semantic segmentation is available in Github <a href="https://github.com/suneeta-mall/e2e-ml-on-k8s">repository</a>. This example demonstrates reproducible ML and also performing end to end ML with provenance across process and data. </p> <p><img alt src=../../../resources/repo.jpg> <em>Figure 4: Reproducible ML sample - semantic segmentation of oxford pet</em></p> <p>In this post, however, I will be discussing only the reproducible ML aspect of it and will be referencing snippets of this example.</p> <h4 id=ml-workflow><a class=toclink href=../../2019/12/22/reproducible-ml-with-tensorflow/#ml-workflow>ML workflow</a></h4> <p>In reality, a machine learning workflow is very complex and looks somewhat similar to figure 5. In this post, however, we will only discuss the data and model training part of it. The remaining workflow i.e. the end-to-end workflow will be discussed in <a href=/2019/12/23/Reproducible-ml-pipeline-k8s.html>next post</a>. </p> <blockquote> <p><img alt src=../../../resources/ai-workflow.jpg> <em>Figure 5: Machine learning workflow</em></p> </blockquote> <h4 id=data><a class=toclink href=../../2019/12/22/reproducible-ml-with-tensorflow/#data>Data</a></h4> <p>The source dataset is <a href="https://www.robots.ox.ac.uk/~vgg/data/pets/">Oxford Pet dataset</a> which contains a multitude of labels e.g. class outcome, pixel-wise label, bounding boxes, etc. The first step is to process this data to generate the trainable dataset. In the example code, this is done by <a href="https://github.com/suneeta-mall/e2e-ml-on-k8s/blob/master/app/download_petset.py">download_petset.py</a> script. </p> <p><div class=highlight><pre><span></span><code>python<span class=w> </span>download_petset.py<span class=w>  </span>--output<span class=w> </span>/wks/petset
</code></pre></div> The resulting sample is shown in figure 6.</p> <blockquote> <p><img alt src=../../../resources/warehouse.png> <em>Figure 6: Pets data partitioned by Pets ID</em></p> </blockquote> <p>Post data partition, the entire dataset is divided into 4 sets: a) training, b) validation, c) calibration, and d) test We would want this set partitioning strategy to be reproducible. By doing this, we ensure that if we have to blow away the training dataset, or if accidental data loss occurs then the <em>exact</em> dataset can be created.</p> <p>In this sample, this is achieved by generating the hash of petid and partitioning the hash into 10 folds (script below) to obtain partition index of pet id. </p> <div class=highlight><pre><span></span><code><span class=n>partition_idx</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>((</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>petset_id</span><span class=p>))</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span> <span class=mi>16</span><span class=p>)</span> <span class=o>%</span> <span class=mi>10</span>
</code></pre></div> <p>With partition_idx 0-6 assigned for training, 7 for validation, 8 for calibration, and 9 for the test, every generation will result in pets going into their respective partition. </p> <p>Besides, to set partitioning, any random data augmentation performed is seeded with seed controlled as configuration as code. See <code>tf.image.random_flip_left_right</code> used in this tensorflow data pipeline <a href="https://github.com/suneeta-mall/e2e-ml-on-k8s/blob/master/pypkg/pylib/datapipeline.py#L29">method</a>. </p> <p>Script for model dataset preparation is located in <a href="https://github.com/suneeta-mall/e2e-ml-on-k8s/blob/master/app/dataset_gen.py">dataset_gen.py</a> and used as following <div class=highlight><pre><span></span><code>python<span class=w> </span>dataset_gen.py<span class=w> </span>--input<span class=w> </span>/wks/petset<span class=w> </span>--output<span class=w> </span>/wks/model_dataset
</code></pre></div> with results shown below:</p> <blockquote> <p><img alt src=../../../resources/datagen.jpg> <em>Figure 7: Pets data partitioned into training, validation, calibration, and test set</em></p> </blockquote> <h4 id=modelling-semantic-segmentation><a class=toclink href=../../2019/12/22/reproducible-ml-with-tensorflow/#modelling-semantic-segmentation>Modelling semantic segmentation</a></h4> <p>The model for pet segmentation is based on <a href="https://arxiv.org/abs/1505.04597">U-net</a> with backbone of either <a href="https://arxiv.org/abs/1801.04381">MobileNet-v2</a> or <a href="https://arxiv.org/abs/1409.1556">VGG-19</a> (defaults to VGG-19). As per this model's network architecture, 5 activation layers of pre-trained backbone network are chosen. These layers are: * MobileNet</p> <blockquote> <div class=highlight><pre><span></span><code>&#39;block_1_expand_relu&#39; 
&#39;block_3_expand_relu&#39;  
&#39;block_6_expand_relu&#39; 
&#39;block_13_expand_relu&#39;
&#39;block_16_project&#39;
</code></pre></div> </blockquote> <ul> <li>VGG<blockquote> <div class=highlight><pre><span></span><code>&#39;block1_pool&#39;
&#39;block2_pool&#39;
&#39;block3_pool&#39;
&#39;block4_pool&#39;
&#39;block5_pool&#39;
</code></pre></div> </blockquote> </li> </ul> <p>Each of these layers is then concatenated with a corresponding upsampling layer comprising of <a href="https://towardsdatascience.com/a-comprehensive-introduction-to-different-types-of-convolutions-in-deep-learning-669281e58215">Conv2DTranspose</a> layer forming what's known as skip connection. See <a href="https://github.com/suneeta-mall/e2e-ml-on-k8s/blob/master/pypkg/pylib/model.py#L40">model</a> code for more info.</p> <p>The training script <a href="https://github.com/suneeta-mall/e2e-ml-on-k8s/blob/master/app/train.py">train.py</a> can be used as following:</p> <div class=highlight><pre><span></span><code>python<span class=w> </span>train.py<span class=w> </span>--input<span class=w> </span>/wks/model_dataset<span class=w> </span>--output<span class=w> </span>/wks/model<span class=w> </span>--checkpoint_path<span class=w> </span>/wks/model/ckpts<span class=w> </span>--tensorboard_path<span class=w> </span>/wks/model
</code></pre></div> <h5 id=1-seeding-randomness><a class=toclink href=../../2019/12/22/reproducible-ml-with-tensorflow/#1-seeding-randomness>1. Seeding randomness</a></h5> <p>All methods exploiting randomness is used with appropriate seed.<br> - All random initialization is seeded e.g. <a href="https://github.com/suneeta-mall/e2e-ml-on-k8s/blob/master/pypkg/pylib/model.py#L27">tf.random_normal_initializer</a> - All dropout layers are seeded e.g. <a href="https://github.com/suneeta-mall/e2e-ml-on-k8s/blob/master/pypkg/pylib/model.py#L35">dropout</a></p> <p>Global seed is set for any hidden methods that may be using randomness by <a href="https://github.com/suneeta-mall/e2e-ml-on-k8s/blob/master/pypkg/pylib/model.py#L91">calling</a> in <code>set_seed(seed)</code> which sets seed for used libraries:</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>set_seeds</span><span class=p>(</span><span class=n>seed</span><span class=o>=</span><span class=n>SEED</span><span class=p>):</span>
    <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;PYTHONHASHSEED&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
    <span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
    <span class=n>tf</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>set_seed</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
    <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</code></pre></div> <h5 id=2-handing-library-behaviors><a class=toclink href=../../2019/12/22/reproducible-ml-with-tensorflow/#2-handing-library-behaviors>2. Handing library behaviors</a></h5> <h6 id=21-cudnn><a class=toclink href=../../2019/12/22/reproducible-ml-with-tensorflow/#21-cudnn>2.1 CuDNN</a></h6> <p><a href="https://docs.nvidia.com/deeplearning/sdk/cudnn-developer-guide/index.html#reproducibility">CuDNN</a> does not guarantee reproducibility in some of its routines. Environment variable <code>TF_DETERMINISTIC_OPS</code> &amp; <code>TF_CUDNN_DETERMINISTIC</code> can be used to control this behavior as per this snippet (figure 8) from cudnn <a href="https://docs.nvidia.com/deeplearning/frameworks/tensorflow-release-notes/rel_19.06.html">release page</a>. </p> <blockquote> <p><img alt src=../../../resources/envvar.jpg> <em>Figure 8: NVIDIA release page snippet reproducibility</em></p> </blockquote> <h5 id=22-cpu-thread-parallelism><a class=toclink href=../../2019/12/22/reproducible-ml-with-tensorflow/#22-cpu-thread-parallelism>2.2 CPU thread parallelism</a></h5> <p>As discussed in <a href=/2019/12/21/Reproducible-ml-research-n-industry.html>Part 1</a>, using high parallelism with compute intensive workflow may not be reproducible. Configurations for inter<sup><a href="https://www.tensorflow.org/api_docs/python/tf/config/threading/set_inter_op_parallelism_threads">ref</a></sup> and intra<sup><a href="https://www.tensorflow.org/api_docs/python/tf/config/threading/set_intra_op_parallelism_threads">ref</a></sup> operation parallelism should be set if 100% parallelism is desired.</p> <p>In this example, I have chosen <em>1</em> to avoid any non-determinism arising from inter-operation parallelism. <em>Warning</em> setting this will considerably slow down the training. </p> <div class=highlight><pre><span></span><code><span class=n>tf</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>threading</span><span class=o>.</span><span class=n>set_inter_op_parallelism_threads</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
<span class=n>tf</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>threading</span><span class=o>.</span><span class=n>set_intra_op_parallelism_threads</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div> <h5 id=23-tensorflow-determinism><a class=toclink href=../../2019/12/22/reproducible-ml-with-tensorflow/#23-tensorflow-determinism>2.3 Tensorflow determinism</a></h5> <p>Following are some of the application of <a href="https://tensorflow.org">Tensorflow</a> that are not reproducible: - Backward pass of broadcasting on GPU is non-deterministic<sup><a href="https://github.com/tensorflow/tensorflow/issues/2652">link</a></sup> - Mention that GPU reductions are nondeterministic in docs<sup><a href="https://github.com/tensorflow/tensorflow/issues/2732">link</a></sup> - Problems Getting TensorFlow to behave Deterministically<sup><a href="https://github.com/tensorflow/tensorflow/issues/16889">link</a></sup></p> <p><a href="https://github.com/duncanriach">Duncan Riach</a>, along with several other contributors have created <a href="https://github.com/NVIDIA/tensorflow-determinism">tensorflow_determinism</a> package that can be used to overcome non-reproducibility related challenges from TensorFlow. It should be used in addition to the above measures we have discussed so far.</p> <p>If we combine all the approaches discussed above (aside from using seeded randomness), they can be wrapped into a lightweight method like one below:<br> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>set_global_determinism</span><span class=p>(</span><span class=n>seed</span><span class=o>=</span><span class=n>SEED</span><span class=p>,</span> <span class=n>fast_n_close</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Enable 100% reproducibility on operations related to tensor and randomness.</span>
<span class=sd>        Parameters:</span>
<span class=sd>        seed (int): seed value for global randomness</span>
<span class=sd>        fast_n_close (bool): whether to achieve efficient at the cost of determinism/reproducibility</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>set_seeds</span><span class=p>(</span><span class=n>seed</span><span class=o>=</span><span class=n>seed</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>fast_n_close</span><span class=p>:</span>
        <span class=k>return</span>

    <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;*******************************************************************************&quot;</span><span class=p>)</span>
    <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;*** set_global_determinism is called,setting full determinism, will be slow ***&quot;</span><span class=p>)</span>
    <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;*******************************************************************************&quot;</span><span class=p>)</span>

    <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;TF_DETERMINISTIC_OPS&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;1&#39;</span>
    <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;TF_CUDNN_DETERMINISTIC&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;1&#39;</span>
    <span class=c1># https://www.tensorflow.org/api_docs/python/tf/config/threading/set_inter_op_parallelism_threads</span>
    <span class=n>tf</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>threading</span><span class=o>.</span><span class=n>set_inter_op_parallelism_threads</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
    <span class=n>tf</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>threading</span><span class=o>.</span><span class=n>set_intra_op_parallelism_threads</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
    <span class=kn>from</span><span class=w> </span><span class=nn>tfdeterminism</span><span class=w> </span><span class=kn>import</span> <span class=n>patch</span>
    <span class=n>patch</span><span class=p>()</span>
</code></pre></div> which can then be used on top of the ML algorithm/process code to generate a 100% reproducible code. </p> <h4 id=result><a class=toclink href=../../2019/12/22/reproducible-ml-with-tensorflow/#result>Result</a></h4> <p>What happens if we don't write reproducible ML? What kind of difference we are really talking about? The last two columns of figure 9 show results obtained by a model trained on the exact same dataset, exactly the same code with EXACTLY one exception. The dropout layer used in the network were unseeded. All other measures discussed above were taken into account. </p> <blockquote> <p><img alt src=../../../resources/repro-ml-result.jpg> <em>Figure 9: Effect of just forgetting to set one seed amidst many</em></p> </blockquote> <p>Looking at the result of the first pet which is a very simple case, we can see the subtle difference in the outcome of these two models. The second pet case is slightly complicated due to shadow and we can see obvious differences in the outcome. But what about the third case, this is a very hard case for pre-trained frozen backbone model we are using but we can see major differences in result between the two models.</p> <p>If we were to use all the measures discussed above then 100% reproducible ML can be obatined. This is shown in the following 2 logs obtained by running the following: <div class=highlight><pre><span></span><code>python<span class=w> </span>train.py<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--input<span class=w> </span>/wks/model_dataset<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--hyperparam_fn_path<span class=w> </span>best_hyper_parameters.json<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--output<span class=w> </span>logs<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--checkpoint_path<span class=w> </span><span class=s2>&quot;logs/ckpts&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>--tensorboard_path<span class=w> </span>logs
</code></pre></div> wherein content of <code>best_hyper_parameters.json</code> are: <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>   </span><span class=nt>&quot;batch_size&quot;</span><span class=p>:</span><span class=mi>60</span><span class=p>,</span>
<span class=w>   </span><span class=nt>&quot;epochs&quot;</span><span class=p>:</span><span class=mi>12</span><span class=p>,</span>
<span class=w>   </span><span class=nt>&quot;iterations&quot;</span><span class=p>:</span><span class=mi>100</span><span class=p>,</span>
<span class=w>   </span><span class=nt>&quot;learning_rate&quot;</span><span class=p>:</span><span class=mf>0.0018464290366223407</span><span class=p>,</span>
<span class=w>   </span><span class=nt>&quot;model_arch&quot;</span><span class=p>:</span><span class=s2>&quot;MobileNetV2&quot;</span><span class=p>,</span>
<span class=w>   </span><span class=nt>&quot;steps_per_epoch&quot;</span><span class=p>:</span><span class=mi>84</span>
<span class=p>}</span>
</code></pre></div> Run attempt 1: <div class=highlight><pre><span></span><code>WARNING:root:******* set_global_determinism is called, setting seeds and determinism *******
TensorFlow version 2.0.0 has been patched using tfdeterminism version 0.3.0
Input: tf-data, Model: MobileNetV2, Batch Size: 60, Epochs: 12, Learning Rate: 0.0018464290366223407, Steps Per Epoch: 84
Train for 84 steps, validate for 14 steps
Epoch 1/12
2019-11-07 12:48:27.576286: I tensorflow/core/profiler/lib/profiler_session.cc:184] Profiler session started.
84/84 [==============================] - 505s 6s/step - loss: 0.8187 - iou_score: 0.4867 - f1_score: 0.6092 - binary_accuracy: 0.8749 - val_loss: 1.0283 - val_iou_score: 0.4910 - val_f1_score: 0.6297 - val_binary_accuracy: 0.8393
Epoch 2/12
84/84 [==============================] - 533s 6s/step - loss: 0.6116 - iou_score: 0.6118 - f1_score: 0.7309 - binary_accuracy: 0.9150 - val_loss: 0.6965 - val_iou_score: 0.5817 - val_f1_score: 0.7079 - val_binary_accuracy: 0.8940
Epoch 3/12
84/84 [==============================] - 527s 6s/step - loss: 0.5829 - iou_score: 0.6301 - f1_score: 0.7466 - binary_accuracy: 0.9197 - val_loss: 0.6354 - val_iou_score: 0.6107 - val_f1_score: 0.7312 - val_binary_accuracy: 0.9038
Epoch 4/12
84/84 [==============================] - 503s 6s/step - loss: 0.5733 - iou_score: 0.6376 - f1_score: 0.7528 - binary_accuracy: 0.9213 - val_loss: 0.6192 - val_iou_score: 0.6227 - val_f1_score: 0.7411 - val_binary_accuracy: 0.9066
Epoch 5/12
84/84 [==============================] - 484s 6s/step - loss: 0.5566 - iou_score: 0.6461 - f1_score: 0.7599 - binary_accuracy: 0.9241 - val_loss: 0.5827 - val_iou_score: 0.6381 - val_f1_score: 0.7534 - val_binary_accuracy: 0.9156
Epoch 6/12
84/84 [==============================] - 509s 6s/step - loss: 0.5524 - iou_score: 0.6497 - f1_score: 0.7629 - binary_accuracy: 0.9247 - val_loss: 0.5732 - val_iou_score: 0.6477 - val_f1_score: 0.7605 - val_binary_accuracy: 0.9191
Epoch 7/12
84/84 [==============================] - 526s 6s/step - loss: 0.5439 - iou_score: 0.6544 - f1_score: 0.7669 - binary_accuracy: 0.9262 - val_loss: 0.5774 - val_iou_score: 0.6456 - val_f1_score: 0.7590 - val_binary_accuracy: 0.9170
Epoch 8/12
84/84 [==============================] - 523s 6s/step - loss: 0.5339 - iou_score: 0.6597 - f1_score: 0.7710 - binary_accuracy: 0.9279 - val_loss: 0.5533 - val_iou_score: 0.6554 - val_f1_score: 0.7672 - val_binary_accuracy: 0.9216
Epoch 9/12
84/84 [==============================] - 518s 6s/step - loss: 0.5287 - iou_score: 0.6620 - f1_score: 0.7730 - binary_accuracy: 0.9288 - val_loss: 0.5919 - val_iou_score: 0.6444 - val_f1_score: 0.7584 - val_binary_accuracy: 0.9148
Epoch 10/12
84/84 [==============================] - 506s 6s/step - loss: 0.5259 - iou_score: 0.6649 - f1_score: 0.7753 - binary_accuracy: 0.9292 - val_loss: 0.5532 - val_iou_score: 0.6554 - val_f1_score: 0.7674 - val_binary_accuracy: 0.9218
Epoch 11/12
84/84 [==============================] - 521s 6s/step - loss: 0.5146 - iou_score: 0.6695 - f1_score: 0.7789 - binary_accuracy: 0.9313 - val_loss: 0.5586 - val_iou_score: 0.6581 - val_f1_score: 0.7689 - val_binary_accuracy: 0.9221
Epoch 12/12
84/84 [==============================] - 507s 6s/step - loss: 0.5114 - iou_score: 0.6730 - f1_score: 0.7818 - binary_accuracy: 0.9317 - val_loss: 0.5732 - val_iou_score: 0.6501 - val_f1_score: 0.7626 - val_binary_accuracy: 0.9179
</code></pre></div></p> <p>Run attempt 2: <div class=highlight><pre><span></span><code>WARNING:root:******* set_global_determinism is called, setting seeds and determinism *******
TensorFlow version 2.0.0 has been patched using tfdeterminism version 0.3.0
Input: tf-data, Model: MobileNetV2, Batch Size: 60, Epochs: 12, Learning Rate: 0.0018464290366223407, Steps Per Epoch: 84
Train for 84 steps, validate for 14 steps

Epoch 1/12
2019-11-07 10:45:51.549715: I tensorflow/core/profiler/lib/profiler_session.cc:184] Profiler session started.
84/84 [==============================] - 549s 7s/step - loss: 0.8187 - iou_score: 0.4867 - f1_score: 0.6092 - binary_accuracy: 0.8749 - val_loss: 1.0283 - val_iou_score: 0.4910 - val_f1_score: 0.6297 - val_binary_accuracy: 0.8393
Epoch 2/12
84/84 [==============================] - 515s 6s/step - loss: 0.6116 - iou_score: 0.6118 - f1_score: 0.7309 - binary_accuracy: 0.9150 - val_loss: 0.6965 - val_iou_score: 0.5817 - val_f1_score: 0.7079 - val_binary_accuracy: 0.8940
Epoch 3/12
84/84 [==============================] - 492s 6s/step - loss: 0.5829 - iou_score: 0.6301 - f1_score: 0.7466 - binary_accuracy: 0.9197 - val_loss: 0.6354 - val_iou_score: 0.6107 - val_f1_score: 0.7312 - val_binary_accuracy: 0.9038
Epoch 4/12
84/84 [==============================] - 515s 6s/step - loss: 0.5733 - iou_score: 0.6376 - f1_score: 0.7528 - binary_accuracy: 0.9213 - val_loss: 0.6192 - val_iou_score: 0.6227 - val_f1_score: 0.7411 - val_binary_accuracy: 0.9066
Epoch 5/12
84/84 [==============================] - 534s 6s/step - loss: 0.5566 - iou_score: 0.6461 - f1_score: 0.7599 - binary_accuracy: 0.9241 - val_loss: 0.5827 - val_iou_score: 0.6381 - val_f1_score: 0.7534 - val_binary_accuracy: 0.9156
Epoch 6/12
84/84 [==============================] - 494s 6s/step - loss: 0.5524 - iou_score: 0.6497 - f1_score: 0.7629 - binary_accuracy: 0.9247 - val_loss: 0.5732 - val_iou_score: 0.6477 - val_f1_score: 0.7605 - val_binary_accuracy: 0.9191
Epoch 7/12
84/84 [==============================] - 506s 6s/step - loss: 0.5439 - iou_score: 0.6544 - f1_score: 0.7669 - binary_accuracy: 0.9262 - val_loss: 0.5774 - val_iou_score: 0.6456 - val_f1_score: 0.7590 - val_binary_accuracy: 0.9170
Epoch 8/12
84/84 [==============================] - 514s 6s/step - loss: 0.5339 - iou_score: 0.6597 - f1_score: 0.7710 - binary_accuracy: 0.9279 - val_loss: 0.5533 - val_iou_score: 0.6554 - val_f1_score: 0.7672 - val_binary_accuracy: 0.9216
Epoch 9/12
84/84 [==============================] - 518s 6s/step - loss: 0.5287 - iou_score: 0.6620 - f1_score: 0.7730 - binary_accuracy: 0.9288 - val_loss: 0.5919 - val_iou_score: 0.6444 - val_f1_score: 0.7584 - val_binary_accuracy: 0.9148
Epoch 10/12
84/84 [==============================] - 531s 6s/step - loss: 0.5259 - iou_score: 0.6649 - f1_score: 0.7753 - binary_accuracy: 0.9292 - val_loss: 0.5532 - val_iou_score: 0.6554 - val_f1_score: 0.7674 - val_binary_accuracy: 0.9218
Epoch 11/12
84/84 [==============================] - 495s 6s/step - loss: 0.5146 - iou_score: 0.6695 - f1_score: 0.7789 - binary_accuracy: 0.9313 - val_loss: 0.5586 - val_iou_score: 0.6581 - val_f1_score: 0.7689 - val_binary_accuracy: 0.9221
Epoch 12/12
84/84 [==============================] - 483s 6s/step - loss: 0.5114 - iou_score: 0.6730 - f1_score: 0.7818 - binary_accuracy: 0.9317 - val_loss: 0.5732 - val_iou_score: 0.6501 - val_f1_score: 0.7626 - val_binary_accuracy: 0.9179
</code></pre></div></p> <p>So we have 100% reproducible ML code now but saying <strong>training is snail-ish is an understatement</strong>. Training time has increased (CPU based measures) from 28 minutes vs 1 hr 45 minutes as we give away with inter-thread parallelism and also asynchronous computation optimization. This is not practical in reality. This is also why reproducibility in ML is more focussed around <em>having a road map to reach the same conclusions<sub>- <a href="https://www.wired.com/story/artificial-intelligence-confronts-reproducibility-crisis/">Dodge</a></sub></em>. This is realized by maintaining a system capable of capturing full provenance over everything involved in the ML process including data, code, processes, and infrastructure/environment. This will be the focus of <a href=/2019/12/23/Reproducible-ml-pipeline-k8s.html>part 3</a> of this blog series. </p> <hr> <p>The next part of the technical blog series, [Reproducibility in Machine Learning], is <a href=/2019/12/23/Reproducible-ml-pipeline-k8s.html>End-to-end reproducible Machine Learning pipelines on Kubernetes</a>. </p> <p>[Reproducibility in Machine Learning]: /2019/12/20/Reproducibility-in-Machine Learning.html</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=/resources/me.png alt="Suneeta Mall"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2019-12-21 00:00:00">December 21, 2019</time></li> <li class=md-meta__item> in <a href=./ class=md-meta__link>Machine Learning</a>, <a href=../ai/ class=md-meta__link>AI</a>, <a href=../reproducible-ml/ class=md-meta__link>Reproducible-ml</a></li> <li class=md-meta__item> 12 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=reproducibility-in-machine-learning-research-and-industry><a href=../../2019/12/21/reproducible-ml-research-in-industry/ class=toclink>Reproducibility in Machine Learning - Research and Industry</a></h2> <p>This is <a href=/2019/12/21/Reproducible-ml-research-n-industry.html>Part 1</a> - <strong>Reproducibility in Machine Learning - Research and Industry</strong> of technical blog series titled [Reproducibility in Machine Learning]. <a href=/2019/12/22/Reproducible-ml-tensorflow.html>Part 2</a> &amp; <a href=/2019/12/23/Reproducible-ml-pipeline-k8s.html>Part 3</a> can be found <a href=/2019/12/22/Reproducible-ml-tensorflow.html>here</a> &amp; <a href=/2019/12/23/Reproducible-ml-pipeline-k8s.html>here</a> respectively. </p> <hr> <p>Machine learning (ML) is an interesting field aimed at solving problems that can not be solved by applying deterministic logic. In fact, ML solves problems in logits [0, 1] with probabilities! ML is a highly iterative and fiddly field with much of its <strong><em>intelligence</em></strong> derived from data upon application of complex mathematics. Sometimes, even a slight change such as changing the order of input/data can change the outcome of ML processes drastically. Actually <a href="https://xkcd.com/1838">xkcd</a> quite aptly puts it:</p> <blockquote> <p><img alt src=../../../resources/xkcd_1838.png> <em>Figure 1: Machine Learning explained by XKCD</em></p> </blockquote> <p>This phenomenon is explained as <strong>C</strong>hange <strong>A</strong>nything <strong>C</strong>hanges <strong>E</strong>verything a.k.a. CAKE principle coined by Scully et. <em>al</em> in their NIPS 2015 paper titled ["<em>Hidden Technical Debt in Machine Learning Systems</em>"][scully_2015]. CAKE principle highlights that in ML - no input is ever really independent. </p> <h3 id=what-is-reproducibility-in-ml><a class=toclink href=../../2019/12/21/reproducible-ml-research-in-industry/#what-is-reproducibility-in-ml>What is reproducibility in ML</a></h3> <p>Reproducibility as per the Oxford dictionary is defined as something that can be <em>produced again in the same way</em>. <img alt src=../../../resources/reproducible-oxford.jpeg> <em>Figure 2: Reproducible defined</em></p> <p>In ML context, it relates to getting the same output on the same algorithm, (hyper)parameters, and data on every run. </p> <p>To demonstrate, let's take a simple linear regression example (shown below) on <a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_diabetes.html">Scikit Diabetes Dataset</a>. Linear regression is all about fitting a line i.e. <code>Y = a + bX</code> over data-points represented as X, with b being the slope and a being the intercept. <br> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>matplotlib.pyplot</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>plt</span>
<span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span>
<span class=kn>from</span><span class=w> </span><span class=nn>sklearn</span><span class=w> </span><span class=kn>import</span> <span class=n>datasets</span><span class=p>,</span> <span class=n>linear_model</span>
<span class=kn>from</span><span class=w> </span><span class=nn>sklearn.metrics</span><span class=w> </span><span class=kn>import</span> <span class=n>mean_squared_error</span><span class=p>,</span> <span class=n>r2_score</span>
<span class=kn>from</span><span class=w> </span><span class=nn>sklearn.model_selection</span><span class=w> </span><span class=kn>import</span> <span class=n>train_test_split</span>

<span class=n>diabetes</span> <span class=o>=</span> <span class=n>datasets</span><span class=o>.</span><span class=n>load_diabetes</span><span class=p>()</span>    
<span class=n>diabetes_X</span> <span class=o>=</span> <span class=n>diabetes</span><span class=o>.</span><span class=n>data</span><span class=p>[:,</span> <span class=n>np</span><span class=o>.</span><span class=n>newaxis</span><span class=p>,</span> <span class=mi>9</span><span class=p>]</span>
<span class=n>xtrain</span><span class=p>,</span> <span class=n>xtest</span><span class=p>,</span> <span class=n>ytrain</span><span class=p>,</span> <span class=n>ytest</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span><span class=n>diabetes_X</span><span class=p>,</span> <span class=n>diabetes</span><span class=o>.</span><span class=n>target</span><span class=p>,</span> <span class=n>test_size</span><span class=o>=</span><span class=mf>0.33</span><span class=p>)</span>
<span class=n>regr</span> <span class=o>=</span> <span class=n>linear_model</span><span class=o>.</span><span class=n>LinearRegression</span><span class=p>()</span>
<span class=n>regr</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>xtrain</span><span class=p>,</span> <span class=n>ytrain</span><span class=p>)</span>
<span class=n>diabetes_y_pred</span> <span class=o>=</span> <span class=n>regr</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>xtest</span><span class=p>)</span>

<span class=c1># The coefficients </span>
<span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Coefficients: </span><span class=si>{</span><span class=n>regr</span><span class=o>.</span><span class=n>coef_</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=se>\n</span><span class=s1>&#39;</span>
      <span class=sa>f</span><span class=s1>&#39;Mean squared error: </span><span class=si>{</span><span class=n>mean_squared_error</span><span class=p>(</span><span class=n>ytest</span><span class=p>,</span><span class=w> </span><span class=n>diabetes_y_pred</span><span class=p>)</span><span class=si>:</span><span class=s1>.2f</span><span class=si>}</span><span class=se>\n</span><span class=s1>&#39;</span>
      <span class=sa>f</span><span class=s1>&#39;Variance score: </span><span class=si>{</span><span class=n>r2_score</span><span class=p>(</span><span class=n>ytest</span><span class=p>,</span><span class=w> </span><span class=n>diabetes_y_pred</span><span class=p>)</span><span class=si>:</span><span class=s1>.2f</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
<span class=c1># Plot outputs </span>
<span class=n>plt</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xtest</span><span class=p>,</span> <span class=n>ytest</span><span class=p>,</span>  <span class=n>color</span><span class=o>=</span><span class=s1>&#39;green&#39;</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>xtest</span><span class=p>,</span> <span class=n>diabetes_y_pred</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;Quantitative measure of diabetes progression&#39;</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;One of six blood serum measurements of patients&#39;</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</code></pre></div> <em>A linear regression example on <a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_diabetes.html">Scikit Diabetes Dataset</a></em></p> <p>Above ML code is NOT reproducible. Every run will give different results: <strong>a)</strong> The data distribution will vary and <strong>b)</strong> Obtained slop and intercept will vary. See Figure 3.</p> <p><img alt src=../../../resources/scikit-repro.jpeg> <em>Figure 3: Repeated run of above linear regression code produces different results</em> </p> <p>In the above example, we are using the same dataset, same algorithm, same hyper-parameters. So why are we getting different results? Here the method <code>train_test_split</code> splits the diabetes dataset into training and test but while doing so, it performs a random shuffle of the dataset. The seed for this random shuffle is not set here. Because of this, every run produces different training dataset distribution. Due to this, the regression line slope and intercept ends up being different. In this simple example, if we were to set a random state for method <code>train_test_split</code> e.g. <code>random_state=42</code> then we will have a reproducible regression example over the diabetes dataset. The reproducible version of the above regression example is as follows:</p> <p><div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>matplotlib.pyplot</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>plt</span>
<span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span>
<span class=kn>from</span><span class=w> </span><span class=nn>sklearn</span><span class=w> </span><span class=kn>import</span> <span class=n>datasets</span><span class=p>,</span> <span class=n>linear_model</span>
<span class=kn>from</span><span class=w> </span><span class=nn>sklearn.metrics</span><span class=w> </span><span class=kn>import</span> <span class=n>mean_squared_error</span><span class=p>,</span> <span class=n>r2_score</span>
<span class=kn>from</span><span class=w> </span><span class=nn>sklearn.model_selection</span><span class=w> </span><span class=kn>import</span> <span class=n>train_test_split</span>

<span class=n>diabetes</span> <span class=o>=</span> <span class=n>datasets</span><span class=o>.</span><span class=n>load_diabetes</span><span class=p>()</span>    
<span class=n>diabetes_X</span> <span class=o>=</span> <span class=n>diabetes</span><span class=o>.</span><span class=n>data</span><span class=p>[:,</span> <span class=n>np</span><span class=o>.</span><span class=n>newaxis</span><span class=p>,</span> <span class=mi>9</span><span class=p>]</span>
<span class=n>xtrain</span><span class=p>,</span> <span class=n>xtest</span><span class=p>,</span> <span class=n>ytrain</span><span class=p>,</span> <span class=n>ytest</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span><span class=n>diabetes_X</span><span class=p>,</span> <span class=n>diabetes</span><span class=o>.</span><span class=n>target</span><span class=p>,</span> <span class=n>test_size</span><span class=o>=</span><span class=mf>0.33</span><span class=p>,</span>
                                                <span class=n>random_state</span><span class=o>=</span><span class=mi>42</span><span class=p>)</span>
<span class=n>regr</span> <span class=o>=</span> <span class=n>linear_model</span><span class=o>.</span><span class=n>LinearRegression</span><span class=p>()</span>
<span class=n>regr</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>xtrain</span><span class=p>,</span> <span class=n>ytrain</span><span class=p>)</span>
<span class=n>diabetes_y_pred</span> <span class=o>=</span> <span class=n>regr</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>xtest</span><span class=p>)</span>

<span class=c1># The coefficients </span>
<span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Coefficients: </span><span class=si>{</span><span class=n>regr</span><span class=o>.</span><span class=n>coef_</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=se>\n</span><span class=s1>&#39;</span>
      <span class=sa>f</span><span class=s1>&#39;Mean squared error: </span><span class=si>{</span><span class=n>mean_squared_error</span><span class=p>(</span><span class=n>ytest</span><span class=p>,</span><span class=w> </span><span class=n>diabetes_y_pred</span><span class=p>)</span><span class=si>:</span><span class=s1>.2f</span><span class=si>}</span><span class=se>\n</span><span class=s1>&#39;</span>
      <span class=sa>f</span><span class=s1>&#39;Variance score: </span><span class=si>{</span><span class=n>r2_score</span><span class=p>(</span><span class=n>ytest</span><span class=p>,</span><span class=w> </span><span class=n>diabetes_y_pred</span><span class=p>)</span><span class=si>:</span><span class=s1>.2f</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
<span class=c1># Plot outputs </span>
<span class=n>plt</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xtest</span><span class=p>,</span> <span class=n>ytest</span><span class=p>,</span>  <span class=n>color</span><span class=o>=</span><span class=s1>&#39;green&#39;</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>xtest</span><span class=p>,</span> <span class=n>diabetes_y_pred</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;Quantitative measure of diabetes progression&#39;</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;One of six blood serum measurements of patients&#39;</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</code></pre></div> <em>A reproducible linear regression example on <a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_diabetes.html">Scikit Diabetes Dataset</a></em></p> <p>Seeding random state is not the only challenge in writing reproducible ML. In fact, there are several reasons why reproducibility in ML is so hard to achieve. But I will go into that a bit later in section <code>Challenges in realizing reproducible ML</code>. The first question should be "why reproducibility matters in ML"? </p> <h3 id=importance-of-reproducibility-in-ml><a class=toclink href=../../2019/12/21/reproducible-ml-research-in-industry/#importance-of-reproducibility-in-ml>Importance of reproducibility in ML</a></h3> <blockquote> <p>Non-reproducible single occurrences are of no significance to science. <sub>- Popper (The Logic of Scientific Discovery)</sub></p> </blockquote> <p>The importance of reproducibility is increasingly getting recognized since <a href="https://www.nature.com/news/1-500-scientists-lift-the-lid-on-reproducibility-1.19970">Nature's Survey (2016)</a> reported a <code>reproducibility crisis</code>. As per this survey report, 70% of researchers have failed to reproduce another scientist's experiments, and more than 50% have failed to reproduce their own experiments. With more than half of participating scientist agreeing to the presence of reproducibility crisis is indeed very real. Dr. Joelle Pineau, an Associate Professor at McGill University and lead for Facebook's Artificial Intelligence Research lab, covered the reproducibility crisis in her talk at International Conference on Learning Representations (ICLR) 2018 <a href="https://www.youtube.com/watch?v=Vh4H0gOwdIg">you tube</a>. She is determined to nip<br> this crisis in bud from AI research<sup><a href="https://www.nature.com/articles/d41586-019-03895-5?utm_source=twt_nnc&amp;utm_medium=social&amp;utm_campaign=naturenews&amp;sf226569864=1">src</a></sup>. It's not just her, several AI research groups are coming up with measures to ensure reproducibility (example below): - <a href="https://arxiv.org/abs/1810.03993">Model Card</a> at Google - <a href="https://www.cs.mcgill.ca/~jpineau/ReproducibilityChecklist.pdf">Reproducibility Checklist</a> at NeurIPS - <a href="https://reproducibility-challenge.github.io/iclr_2019/">ICLR Reproducibility Challenge</a> at ICLR - <a href="https://arxiv.org/abs/1909.03004">Show your work</a> at Allen Institute of Artificial Intelligence</p> <p>Aside from being of <code>no use if can't be reproduced</code>, as Popper suggested in the above quote, why does reproducibility matter?</p> <h4 id=1-understanding-explaining-debugging-and-reverse-engineering><a class=toclink href=../../2019/12/21/reproducible-ml-research-in-industry/#1-understanding-explaining-debugging-and-reverse-engineering>1. Understanding, Explaining, Debugging, and Reverse Engineering</a></h4> <p>Reproducibility helps with <strong><em>understanding, explaining, and debugging</em></strong>. Reproducibility is also a crucial means to <strong><em>reverse engineering</em></strong>.</p> <p>Machine learning is inherently difficult to explain, understand, and also debug. Obtaining different output on the subsequent run just makes this whole understanding, explaining, debugging thing all the more challenging. How do we ever reverse engineer? As it is, understanding and explaining are hard with machine learning. It's increasingly harder with deep learning. For over a decade, researches are have been trying to understand what these deep networks learn and yet have not 100% succeeded in doing so. <img alt src=../../../resources/deep-net-understand.jpeg> </p> <p>From visualizing higher layer features of deep networks <a href="https://www.iro.umontreal.ca/~lisa/publications2/index.php/publications/show/247">year 2009</a> to activation-atlases i.e. what individual neurons in deep network do <a href="https://distill.pub/2017/feature-visualization">year 2017</a> to understanding how deep networks decides <a href="https://distill.pub/2018/building-blocks/">year 2018</a> - are all ongoing progressive efforts towards understanding. Meanwhile, explainability has morphed into a dedicated field 'Explainable Artificial Intelligence <a href="https://arxiv.org/abs/1910.10045">XAI</a>. </p> <h4 id=2-correctness><a class=toclink href=../../2019/12/21/reproducible-ml-research-in-industry/#2-correctness>2. Correctness</a></h4> <blockquote> <p>If anything can go wrong, it will <sub>-<a href="https://en.wikipedia.org/wiki/Murphy%27s_law">Murphy's law</a></sub></p> </blockquote> <p>Correctness is important as <a href="https://en.wikipedia.org/wiki/Murphy%27s_law">Murphy's law</a> rarely fails us. These are some of the examples of great AI failures of our times.<br> <img alt src=../../../resources/AI-failure.jpeg> <em>Figure 4: Example of some of the great AI failures of our times</em></p> <p>Google Photos launched AI capabilities with automatically tagging images. It was found to be tagging <a href="https://twitter.com/jackyalcine/status/615329515909156865">people of dark skin as gorillas</a>. Amazon's recruiting software exhibiting <a href="https://medium.com/syncedreview/2018-in-review-10-ai-failures-c18faadf5983">gender bias</a> or even IBM's Watson giving unsafe recommendations for <a href="https://www.theverge.com/2018/7/26/17619382/ibms-watson-cancer-ai-healthcare-science">cancer treatment</a>. </p> <p>ML output should be correct in addition to being explainable. Reproducibility helps to achieve correctness through understanding and debugging. </p> <h4 id=3-credibility><a class=toclink href=../../2019/12/21/reproducible-ml-research-in-industry/#3-credibility>3. Credibility</a></h4> <p>ML output must be credible. It's not just from a fairness, ethical viewpoint but also because they sometimes impact lives (e.g. mortgage approval). Also, end-users of ML output expect answers to verifiable, reliable, unbiased, and ethical. As Lecun said in his <a href="https://twitter.com/ylecun/status/1097532314614034433">International Solid State Circuit Conference in San Francisco, 2019</a> keynote:</p> <blockquote> <p>Good results are not enough, Making them easily reproducible also makes them credible. <sub>- Lecun, ISSCC 2019</sub></p> </blockquote> <h4 id=4-extensibility><a class=toclink href=../../2019/12/21/reproducible-ml-research-in-industry/#4-extensibility>4. Extensibility</a></h4> <p>Reproducibility in preceding layers is needed to build out and extend. Can we build a building outline model if we cant repeatedly generate roof semantics as shown in figure 5? What if we keep getting the different size for the same roof? <img alt src=../../../resources/extensibility.jpeg> <em>Figure 5: Extending ML</em></p> <p>Extensibility is essential to utilizing ML outputs for consumption. As it is, raw outputs from ML are rarely usable by end-user. Most ML outputs need to be post-processed and augmented to be consumption ready. </p> <h4 id=4-data-harvesting><a class=toclink href=../../2019/12/21/reproducible-ml-research-in-industry/#4-data-harvesting>4. Data harvesting</a></h4> <blockquote> <p>The world's most valuable resource is no longer oil, but data! <sub>- <a href="https://www.economist.com/leaders/2017/05/06/the-worlds-most-valuable-resource-is-no-longer-oil-but-data">economist.com</a></sub></p> </blockquote> <p>To train a successful ML algorithm large dataset is mostly needed - this is especially true for deep-learning. Obtaining large volumes of training data, however, is not always easy - it can be quite expensive. In some cases the occurrences of the scenario can be so rare that obtaining a large dataset will either take forever or is simply not possible. For eg. dataset for <a href="https://www.cancer.gov/types/skin/patient/merkel-cell-treatment-pdq">Merkel-cell carcinoma</a>, a type of skin cancer that's very rare, will be very challenging to procure.</p> <p>For this reason, data harvesting a.k.a. synthetic data generation is considered. Tirthajyoti Sarkar, the author of <a href="https://www.amazon.com.au/Data-Wrangling-Python-Creating-actionable-ebook/dp/B07JF26NGJ">Data Wrangling with Python: Creating actionable data from raw sources</a>, wrote an excellent post on <a href="https://towardsdatascience.com/synthetic-data-generation-a-must-have-skill-for-new-data-scientists-915896c0c1ae">data harvesting</a> using scikit that covers this topic in detail. However, more recently, Generative Adversarial Networks <a href="https://arxiv.org/abs/1406.2661">(GAN)</a> by <a href="https://en.wikipedia.org/wiki/Ian_Goodfellow">Ian Goodfellow</a> is being heavily used for this purpose. <a href="https://arxiv.org/abs/1909.11512">Synthetic Data for Deep Learning</a> is an excellent review article that covers this topic in detail for deep-learning.</p> <p>Give ML models e.g. <a href="https://arxiv.org/abs/1406.2661">(GAN)</a> are being used to generate training data now, it's all the more important that reproducibility in such application is ensured. Let's say, we trained a near-perfect golden goose model on data (including some synthetic). But the storage caught proverbial fire, and we lost this golden goose model along with data. Now, we have to regenerate the synthetic data and obtain the same model but the synthetic data generation process is not quite reproducible. Thus, we lost the golden goose! </p> <h3 id=challenges-in-realizing-reproducible-ml><a class=toclink href=../../2019/12/21/reproducible-ml-research-in-industry/#challenges-in-realizing-reproducible-ml>Challenges in realizing reproducible ML</a></h3> <p>Reproducible ML does not come in easy. A wise man once said:</p> <blockquote> <p>When you want something, all the universe conspires in helping you to achieve it. <sub>- <a href="https://www.amazon.com/Alchemist-Paulo-Coelho/dp/0061122416">The Alchemist</a> by Paulo Coelho</sub></p> </blockquote> <p>But when it comes to reproducible ML it's quite the contrary. Every single resource and techniques (Hardware, Software, Algorithms, Process &amp; Practice, Data) needed to realize ML poses some kind of challenge in meeting reproducibility (see figure 6).</p> <p><img alt src=../../../resources/reproducible-challenge.jpeg> <em>Figure 6: Overview of challenges in reproducible ML</em></p> <h4 id=1-hardware><a class=toclink href=../../2019/12/21/reproducible-ml-research-in-industry/#1-hardware>1. Hardware</a></h4> <p>ML algorithms are quite compute hungry. Complex computation needed by ML operation, now a day's runs in order of Giga/Tera floating-point operations (GFLOPS/TFLOPS). Thus needing high parallelism and multiple central processing Units <a href="https://en.wikipedia.org/wiki/Tensor_processing_unit">(CPU)</a> if not, specialized hardware such as (general purpose) graphics processing unit <a href="https://en.wikipedia.org/wiki/Graphics_processing_unit">(GPU)</a> or more specifically <a href="https://en.wikipedia.org/wiki/General-purpose_computing_on_graphics_processing_units">(GPGPU)</a>, tensor processing unit <a href="https://en.wikipedia.org/wiki/Tensor_processing_unit">(TPU)</a> etc. to complete in the reasonable time frame. </p> <p>But these efficiencies in floating-point computations both at CPU &amp; GPU level comes at a cost of reproducibility. </p> <ul> <li>CPU</li> </ul> <blockquote> <p>Using Intra-ops (within an operation) and inter-ops (amongst multiple operations) parallelism on CPU can sometimes give different results on each run. One such example is using OpenMP for (intra-ops) parallelization. See this excellent talk titled "Corden's Consistency of Floating Point Results or Why doesn't my application always give" <a href="https://www.nccs.nasa.gov../../resources/FloatingPoint_consistency.pdf">Corden 2018</a> for more in-depth insight into this. Also see wandering precision <a href="https://www.nag.co.uk/content/wandering-precision">blog</a>.</p> </blockquote> <ul> <li>GPU</li> </ul> <blockquote> <p>General purpose GPUs can perform vector operations due to stream multiprocessing (SEM) unit. The asynchronous computation performed by this unit may result in different results on different runs. Floating multiple adders (FMAD) or even reductions in floating-point operands are such examples. Some algorithms e.g. vector normalization, due to reduction operations, can also be non-reproducible. See <a href="https://people.eecs.berkeley.edu/~hdnguyen/public/papers/repsum.pdf">reproducible summation paper</a> for more info. </p> <p>Changing GPU architecture may lead to different results too. The differences in SEM, or architecture-specific optimizations are a couple of reasons why the differences may arise.</p> </blockquote> <p>See <a href="https://www.nccs.nasa.gov../../resources/FloatingPoint_consistency.pdf">Corden's Consistency of Floating-Point Results or Why doesn't my application always give the same answer</a> for more details.</p> <h4 id=2-software><a class=toclink href=../../2019/12/21/reproducible-ml-research-in-industry/#2-software>2. Software</a></h4> <p>It's not just hardware. Some software's offering high-level abstraction or APIs for performing intensive computation do not guarantee reproducibility in their routines. For instance NVIDIA's popular cuda based deep learning library <a href="https://developer.nvidia.com/cudnn">cudnn</a> do not guarantee reproducibility in some of their routines e.g. cudnnConvolutionBackwardFilter&gt;sup&gt;<a href="https://docs.nvidia.com/deeplearning/sdk/cudnn-developer-guide/index.html#reproducibility">ref</a></sup>. Popular deep learning libraries such as tensorflow<sup><a href="https://github.com/tensorflow/tensorflow/issues/26147">ref 1</a>,<a href="https://github.com/NVIDIA/tensorflow-determinism">ref 2</a></sup>, pytorch<sup><a href="https://pytorch.org/docs/stable/notes/randomness.html">ref</a></sup> also do not guarantee 100% reproducibility. </p> <p>There is an excellent talk <a href="https://github.com/duncanriach">Duncan Riach</a>, maintainer of <a href="https://github.com/NVIDIA/tensorflow-determinism">tensorflow_determinism</a> on <a href="https://drive.google.com/file/d/18pmjeiXWqzHWB8mM2mb3kjN4JSOZBV4A/view">Determinism in deep learning</a> presented at GPU technology conference by NVIDIA 2019</p> <p>Sometimes it's not just a trade-off for efficiency but simple software bugs that lead to non-reproducibility. One such example is this <a href="https://github.com/pyproj4/pyproj/issues/470">bug</a> that I ran into resulting in different geo-location upon same computation when a certain library version was upgraded. This is a clear case of software bug but underlines the fact that reproducibility goes beyond just computation, and precision.</p> <h4 id=3-algorithm><a class=toclink href=../../2019/12/21/reproducible-ml-research-in-industry/#3-algorithm>3. Algorithm</a></h4> <p>Several ML algorithms can be non-reproducible due to the expectation of randomness. Few examples of these algorithms are dropout layers, initialization. Some algorithms can be non-deterministic due to underlined computation complexity requiring non-reproducible measures similar to ones discussed in the software section. Some example of these are e.g. vector normalization, <a href="https://github.com/tensorflow/tensorflow/issues/2652">backward pass</a>.</p> <h4 id=4-process-practice><a class=toclink href=../../2019/12/21/reproducible-ml-research-in-industry/#4-process-practice>4. Process &amp; Practice</a></h4> <p>ML loves randomness! </p> <p><img alt src=../../../resources/random.png> <em>Figure 7: Randomness defined by <a href="https://xkcd.com/221">xkcd</a></em></p> <p>When things don't work with ML - we randomize (pun intended). We have randomness everywhere - from algorithms to process and practices for instance: - Random initializations - Random augmentations<br> - Random noise introduction (adversarial robustness) - Data Shuffles</p> <p>To to ensure that randomness is seeded and can be reproduced (much like earlier example of scikit linear regression), with python, a long list of seed setting ritual needs to be performed: <div class=highlight><pre><span></span><code><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;PYTHONHASHSEED&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
<span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
<span class=n>tensorflow</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>set_seed</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
<span class=n>numpy</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
<span class=n>tensorflow</span><span class=o>.</span><span class=n>keras</span><span class=o>.</span><span class=n>layers</span><span class=o>.</span><span class=n>Dropout</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=n>SEED</span><span class=p>)</span>
<span class=n>tensorflow</span><span class=o>.</span><span class=n>image</span><span class=o>.</span><span class=n>random_flip_left_right</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=n>seed</span><span class=p>)</span>
<span class=n>tensorflow</span><span class=o>.</span><span class=n>random_normal_initializer</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=n>seed</span><span class=p>)</span>
<span class=c1># many such algorithmic layers as aabove </span>
</code></pre></div></p> <p>Can we ever win with this seed setting? </p> <p><img alt src=../../../resources/seed_setting.gif> <em>Figure 8: Seed setting (image credit: google)</em></p> <h4 id=5-data><a class=toclink href=../../2019/12/21/reproducible-ml-research-in-industry/#5-data>5. Data</a></h4> <blockquote> <p>No input is ever really independent. <sub>[Scully et. al 2015][scully_2015]</sub></p> </blockquote> <p>Data is the main input to ML algorithms and these algorithms are just compute hungry but also <strong>data-hungry</strong>. So we are really talking about big data. When data volume is large, we are dealing with all sorts of challenges: - Data management - Data provenance<br> - Data poisoning - Under-represented data (inappropriate demographic) - Over-represented data (inappropriate demographic)</p> <p>One of the reasons why ML is so iterative because we need to evolve the ML algorithm with data whilst also continuously evolving data (e.g. data massaging, feature engineering, data augmentations). That's why data provenance is important but it's also important to maintain a linage with data provenance to ML processes. In short, an end to end provenance is needed with ML processes. </p> <h4 id=6-concept-drift><a class=toclink href=../../2019/12/21/reproducible-ml-research-in-industry/#6-concept-drift>6. Concept drift</a></h4> <blockquote> <p>A model is rarely deployed twice. <sub>[Talby, 2018][Talby]</sub></p> </blockquote> <p>One of the reason for why a model rarely gets deployed more than once <sup>[ref][Talby]</sup> is <code>Concept drift</code>. Our concept of <a href="https://arxiv.org/abs/1612.03716">things and stuff</a> keeps evolving. Don't believe me? figure 9 shows how we envisaged car 18's to now. Our current evolving impression of the car is solar power self-driving cars!</p> <p><img alt src=../../../resources/concept-drift.jpeg> <em>Figure 9: Our evolving concept of <code>car</code></em></p> <p>So, now we don't just have to manage reproducibility over one model but many! Because our model needs to continually keep learning in a more commonly known term in ML as <code>Continual learning</code> <a href="https://www.oreilly.com/radar/why-continuous-learning-is-key-to-ai/">more info</a>. An interesting review paper on this topic is <a href="https://arxiv.org/abs/1802.07569">here</a>.</p> <p><img alt src=../../../resources/dvs.jpg> <em>Figure 10: Top features - Dresner Advisory Services Data Science and Machine Learning <a href=//gumroad.com/l/dTfno>Market Study</a></em></p> <p>In fact, Continual learning is so recognized that support for easy iteration &amp; continuous improvement were the top two features industry voted as their main focus with ML as per Dresner Advisory Services'6<sup>th</sup> annual 2019 Data Science and Machine Learning <a href=//gumroad.com/l/dTfno>Market Study</a> (see figure 10).</p> <hr> <p>The next part of this technical blog series, [Reproducibility in Machine Learning], is <a href=/2019/12/22/Reproducible-ml-tensorflow.html>Realizing reproducible Machine Learning - with Tensorflow</a>. </p> <p>[Reproducibility in Machine Learning]: /2019/12/20/Reproducibility-in-Machine Learning.html</p> <p>[scully_2015]: https://papers.nips.cc/paper/5656-hidden-technical-debt-in-Machine Learning-systems.pdf</p> <p>[Talby]: https://www.oreilly.com/radar/lessons-learned-turning-Machine Learning-models-into-real-products-and-services/</p> </div> </article> <nav class=md-pagination> <span class=md-pagination__current>1</span> <a href=page/2/ class=md-pagination__link>2</a> </nav> </div> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../llm/ class="md-footer__link md-footer__link--prev" aria-label="Previous: LLM"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> LLM </div> </div> </a> <a href=../oom/ class="md-footer__link md-footer__link--next" aria-label="Next: OOM"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> OOM </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> </div> <div class=md-social> <a href="https://www.linkedin.com/in/suneeta-mall-a6a0507/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href="https://github.com/suneeta-mall" target="_blank" rel="noopener" title="github.com" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href="https://x.com/suneetamall/" target="_blank" rel="noopener" title="x.com" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9L389.2 48zm-24.8 373.8h39.1L151.1 88h-42l255.3 333.8z"/></svg> </a> <a href="https://www.medium.com/@suneetamall" target="_blank" rel="noopener" title="www.medium.com" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M180.5 74.262C80.813 74.262 0 155.633 0 256s80.819 181.738 180.5 181.738S361 356.373 361 256 280.191 74.262 180.5 74.262Zm288.25 10.646c-49.845 0-90.245 76.619-90.245 171.095s40.406 171.1 90.251 171.1 90.251-76.619 90.251-171.1H559c0-94.503-40.4-171.095-90.248-171.095Zm139.506 17.821c-17.526 0-31.735 68.628-31.735 153.274s14.2 153.274 31.735 153.274S640 340.631 640 256c0-84.649-14.215-153.271-31.742-153.271Z"/></svg> </a> <a href="https://scholar.google.com.au/citations?hl=en&amp;user=WD712CUAAAAJ" target="_blank" rel="noopener" title="scholar.google.com.au" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M390.9 298.5s0 .1.1.1c9.2 19.4 14.4 41.1 14.4 64C405.3 445.1 338.5 512 256 512s-149.3-66.9-149.3-149.3c0-22.9 5.2-44.6 14.4-64 1.7-3.6 3.6-7.2 5.6-10.7 4.4-7.6 9.4-14.7 15-21.3 27.4-32.6 68.5-53.3 114.4-53.3 33.6 0 64.6 11.1 89.6 29.9 9.1 6.9 17.4 14.7 24.8 23.5 5.6 6.6 10.6 13.8 15 21.3 2 3.4 3.8 7 5.5 10.5zm26.4-18.8c-30.1-58.4-91-98.4-161.3-98.4s-131.2 40-161.3 98.4L0 202.7 256 0l256 202.7-94.7 77.1z"/></svg> </a> <a href="https://www.researchgate.net/profile/Suneeta_Mall3" target="_blank" rel="noopener" title="www.researchgate.net" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 32v448h448V32H0zm262.2 334.4c-6.6 3-33.2 6-50-14.2-9.2-10.6-25.3-33.3-42.2-63.6-8.9 0-14.7 0-21.4-.6v46.4c0 23.5 6 21.2 25.8 23.9v8.1c-6.9-.3-23.1-.8-35.6-.8-13.1 0-26.1.6-33.6.8v-8.1c15.5-2.9 22-1.3 22-23.9V225c0-22.6-6.4-21-22-23.9V193c25.8 1 53.1-.6 70.9-.6 31.7 0 55.9 14.4 55.9 45.6 0 21.1-16.7 42.2-39.2 47.5 13.6 24.2 30 45.6 42.2 58.9 7.2 7.8 17.2 14.7 27.2 14.7v7.3zm22.9-135c-23.3 0-32.2-15.7-32.2-32.2V167c0-12.2 8.8-30.4 34-30.4s30.4 17.9 30.4 17.9l-10.7 7.2s-5.5-12.5-19.7-12.5c-7.9 0-19.7 7.3-19.7 19.7v26.8c0 13.4 6.6 23.3 17.9 23.3 14.1 0 21.5-10.9 21.5-26.8h-17.9v-10.7h30.4c0 20.5 4.7 49.9-34 49.9zm-116.5 44.7c-9.4 0-13.6-.3-20-.8v-69.7c6.4-.6 15-.6 22.5-.6 23.3 0 37.2 12.2 37.2 34.5 0 21.9-15 36.6-39.7 36.6z"/></svg> </a> <a href="https://suneeta-mall.github.io/feed_rss_created.xml" target="_blank" rel="noopener" title="suneeta-mall.github.io" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 64c0-17.7 14.3-32 32-32 229.8 0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7 0 64zm0 352a64 64 0 1 1 128 0 64 64 0 1 1-128 0zm32-256c159.1 0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7 0-32-14.3-32-32s14.3-32 32-32z"/></svg> </a> <a href=mailto:suneetamall@gmail.com target=_blank rel=noopener title class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48H48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0L0 176z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["content.code.annotate", "content.code.copy", "content.tooltips", "content.tabs.link", "navigation.indexes", "navigation.instant", "navigation.instant.preview", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "toc.follow", "header.autohide", "announce.dismiss", "navigation.footer", "navigation.breadcrumbs", "navigation.expand", "navigation.sections", "navigation.tracking", "navigation.top", "search.highlight", "search.share", "toc.follow", "toc.integrate", {"git-revision-date-localized": {"enable_creation_date": true, "type": "date"}}], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.3220b9d7.min.js></script> </body> </html>